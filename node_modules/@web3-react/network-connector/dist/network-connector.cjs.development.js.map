{"version":3,"file":"network-connector.cjs.development.js","sources":["../src/index.ts"],"sourcesContent":["import { ConnectorUpdate } from '@web3-react/types'\nimport { AbstractConnector } from '@web3-react/abstract-connector'\nimport Web3ProviderEngine from 'web3-provider-engine'\nimport { RPCSubprovider } from '@0x/subproviders/lib/src/subproviders/rpc_subprovider' // https://github.com/0xProject/0x-monorepo/issues/1400\nimport invariant from 'tiny-invariant'\n\ninterface NetworkConnectorArguments {\n  urls: { [chainId: number]: string }\n  defaultChainId?: number\n  pollingInterval?: number\n  requestTimeoutMs?: number\n}\n\nexport class NetworkConnector extends AbstractConnector {\n  private readonly providers: { [chainId: number]: any }\n  private currentChainId: number\n  private readonly pollingInterval?: number\n  private readonly requestTimeoutMs?: number\n  private active: boolean\n\n  constructor({ urls, defaultChainId, pollingInterval, requestTimeoutMs }: NetworkConnectorArguments) {\n    invariant(defaultChainId || Object.keys(urls).length === 1, 'defaultChainId is a required argument with >1 url')\n    super({ supportedChainIds: Object.keys(urls).map((k): number => Number(k)) })\n\n    this.providers = Object.keys(urls).reduce((accumulator, chainId) => {\n      const engine = new Web3ProviderEngine({ pollingInterval: this.pollingInterval })\n      engine.addProvider(new RPCSubprovider(urls[Number(chainId)], this.requestTimeoutMs))\n      return Object.assign(accumulator, { [Number(chainId)]: engine })\n    }, {})\n    this.currentChainId = defaultChainId || Number(Object.keys(urls)[0])\n    this.pollingInterval = pollingInterval\n    this.requestTimeoutMs = requestTimeoutMs\n    this.active = false\n  }\n\n  public async activate(): Promise<ConnectorUpdate> {\n    this.providers[this.currentChainId].start()\n    this.active = true\n    return { provider: this.providers[this.currentChainId], chainId: this.currentChainId, account: null }\n  }\n\n  public async getProvider(): Promise<Web3ProviderEngine> {\n    return this.providers[this.currentChainId]\n  }\n\n  public async getChainId(): Promise<number> {\n    return this.currentChainId\n  }\n\n  public async getAccount(): Promise<null> {\n    return null\n  }\n\n  public deactivate() {\n    this.providers[this.currentChainId].stop()\n    this.active = false\n  }\n\n  public changeChainId(chainId: number) {\n    invariant(Object.keys(this.providers).includes(chainId.toString()), `No url found for chainId ${chainId}`)\n    if (this.active) {\n      this.providers[this.currentChainId].stop()\n      this.currentChainId = chainId\n      this.providers[this.currentChainId].start()\n      this.emitUpdate({ provider: this.providers[this.currentChainId], chainId })\n    } else {\n      this.currentChainId = chainId\n    }\n  }\n}\n"],"names":["NetworkConnector","urls","defaultChainId","pollingInterval","requestTimeoutMs","Object","keys","length","invariant","supportedChainIds","map","k","Number","providers","reduce","accumulator","chainId","engine","Web3ProviderEngine","addProvider","RPCSubprovider","assign","currentChainId","active","activate","start","provider","account","getProvider","getChainId","getAccount","deactivate","stop","changeChainId","includes","toString","emitUpdate","AbstractConnector"],"mappings":";;;;;;;;;;;;;;;IAaaA,gBAAb;;AAAA;;;;;;QAOgBC,YAAAA;QAAMC,sBAAAA;QAAgBC,uBAAAA;QAAiBC,wBAAAA;MACzCF,cAAc,IAAIG,MAAM,CAACC,IAAP,CAAYL,IAAZ,EAAkBM,MAAlB,KAA6B,CAAzD,KAAAC,SAAS,QAAmD,mDAAnD,CAAT,CAAA;0CACM;MAAEC,iBAAiB,EAAEJ,MAAM,CAACC,IAAP,CAAYL,IAAZ,EAAkBS,GAAlB,CAAsB,UAACC,CAAD;eAAeC,MAAM,CAACD,CAAD,CAArB;OAAtB;KAA3B;UAEKE,SAAL,GAAiBR,MAAM,CAACC,IAAP,CAAYL,IAAZ,EAAkBa,MAAlB,CAAyB,UAACC,WAAD,EAAcC,OAAd;;;UAClCC,MAAM,GAAG,IAAIC,kBAAJ,CAAuB;QAAEf,eAAe,EAAE,MAAKA;OAA/C,CAAf;MACAc,MAAM,CAACE,WAAP,CAAmB,IAAIC,8BAAJ,CAAmBnB,IAAI,CAACW,MAAM,CAACI,OAAD,CAAP,CAAvB,EAA0C,MAAKZ,gBAA/C,CAAnB;aACOC,MAAM,CAACgB,MAAP,CAAcN,WAAd,uCAA8BH,MAAM,CAACI,OAAD,CAApC,IAAgDC,MAAhD,kBAAP;KAHe,EAId,EAJc,CAAjB;UAKKK,cAAL,GAAsBpB,cAAc,IAAIU,MAAM,CAACP,MAAM,CAACC,IAAP,CAAYL,IAAZ,EAAkB,CAAlB,CAAD,CAA9C;UACKE,eAAL,GAAuBA,eAAvB;UACKC,gBAAL,GAAwBA,gBAAxB;UACKmB,MAAL,GAAc,KAAd;;;;;;SAGWC,QAtBf;;mBAuBI;;aAAKX,SAAL,CAAe,OAAKS,cAApB,EAAoCG,KAApC;;aACKF,MAAL,GAAc,IAAd;6BACO;QAAEG,QAAQ,EAAE,OAAKb,SAAL,CAAe,OAAKS,cAApB,CAAZ;QAAiDN,OAAO,EAAE,OAAKM,cAA/D;QAA+EK,OAAO,EAAE;OAA/F;KAzBJ;;;;;SA4BeC,WA5Bf;;mBA6BW;;6BAAA,OAAKf,SAAL,CAAe,OAAKS,cAApB,CAAP;KA7BJ;;;;;SAgCeO,UAhCf;;mBAiCW;;6BAAA,OAAKP,cAAZ;KAjCJ;;;;;SAoCeQ,UApCf;2BAqCW,IAAP;GArCJ;;SAwCSC,UAxCT,GAwCS;SACAlB,SAAL,CAAe,KAAKS,cAApB,EAAoCU,IAApC;SACKT,MAAL,GAAc,KAAd;GA1CJ;;SA6CSU,aA7CT,GA6CS,uBAAcjB,OAAd;KACKX,MAAM,CAACC,IAAP,CAAY,KAAKO,SAAjB,EAA4BqB,QAA5B,CAAqClB,OAAO,CAACmB,QAAR,EAArC,CAAV,IAAA3B,SAAS,sCAAuFQ,OAAvF,CAAT,CAAA;;QACI,KAAKO,MAAT,EAAiB;WACVV,SAAL,CAAe,KAAKS,cAApB,EAAoCU,IAApC;WACKV,cAAL,GAAsBN,OAAtB;WACKH,SAAL,CAAe,KAAKS,cAApB,EAAoCG,KAApC;WACKW,UAAL,CAAgB;QAAEV,QAAQ,EAAE,KAAKb,SAAL,CAAe,KAAKS,cAApB,CAAZ;QAAiDN,OAAO,EAAPA;OAAjE;KAJF,MAKO;WACAM,cAAL,GAAsBN,OAAtB;;GArDN;;;EAAsCqB,mCAAtC;;;;"}