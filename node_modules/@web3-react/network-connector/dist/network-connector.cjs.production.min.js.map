{"version":3,"file":"network-connector.cjs.production.min.js","sources":["../src/index.ts"],"sourcesContent":["import { ConnectorUpdate } from '@web3-react/types'\nimport { AbstractConnector } from '@web3-react/abstract-connector'\nimport Web3ProviderEngine from 'web3-provider-engine'\nimport { RPCSubprovider } from '@0x/subproviders/lib/src/subproviders/rpc_subprovider' // https://github.com/0xProject/0x-monorepo/issues/1400\nimport invariant from 'tiny-invariant'\n\ninterface NetworkConnectorArguments {\n  urls: { [chainId: number]: string }\n  defaultChainId?: number\n  pollingInterval?: number\n  requestTimeoutMs?: number\n}\n\nexport class NetworkConnector extends AbstractConnector {\n  private readonly providers: { [chainId: number]: any }\n  private currentChainId: number\n  private readonly pollingInterval?: number\n  private readonly requestTimeoutMs?: number\n  private active: boolean\n\n  constructor({ urls, defaultChainId, pollingInterval, requestTimeoutMs }: NetworkConnectorArguments) {\n    invariant(defaultChainId || Object.keys(urls).length === 1, 'defaultChainId is a required argument with >1 url')\n    super({ supportedChainIds: Object.keys(urls).map((k): number => Number(k)) })\n\n    this.providers = Object.keys(urls).reduce((accumulator, chainId) => {\n      const engine = new Web3ProviderEngine({ pollingInterval: this.pollingInterval })\n      engine.addProvider(new RPCSubprovider(urls[Number(chainId)], this.requestTimeoutMs))\n      return Object.assign(accumulator, { [Number(chainId)]: engine })\n    }, {})\n    this.currentChainId = defaultChainId || Number(Object.keys(urls)[0])\n    this.pollingInterval = pollingInterval\n    this.requestTimeoutMs = requestTimeoutMs\n    this.active = false\n  }\n\n  public async activate(): Promise<ConnectorUpdate> {\n    this.providers[this.currentChainId].start()\n    this.active = true\n    return { provider: this.providers[this.currentChainId], chainId: this.currentChainId, account: null }\n  }\n\n  public async getProvider(): Promise<Web3ProviderEngine> {\n    return this.providers[this.currentChainId]\n  }\n\n  public async getChainId(): Promise<number> {\n    return this.currentChainId\n  }\n\n  public async getAccount(): Promise<null> {\n    return null\n  }\n\n  public deactivate() {\n    this.providers[this.currentChainId].stop()\n    this.active = false\n  }\n\n  public changeChainId(chainId: number) {\n    invariant(Object.keys(this.providers).includes(chainId.toString()), `No url found for chainId ${chainId}`)\n    if (this.active) {\n      this.providers[this.currentChainId].stop()\n      this.currentChainId = chainId\n      this.providers[this.currentChainId].start()\n      this.emitUpdate({ provider: this.providers[this.currentChainId], chainId })\n    } else {\n      this.currentChainId = chainId\n    }\n  }\n}\n"],"names":["urls","defaultChainId","pollingInterval","requestTimeoutMs","Object","keys","length","invariant","supportedChainIds","map","k","Number","providers","reduce","accumulator","chainId","engine","Web3ProviderEngine","_this","addProvider","RPCSubprovider","assign","currentChainId","active","activate","this","start","provider","account","getProvider","getChainId","getAccount","deactivate","stop","changeChainId","includes","toString","emitUpdate","AbstractConnector"],"mappings":"mSAaA,wCAOgBA,IAAAA,KAAMC,IAAAA,eAAgBC,IAAAA,gBAAiBC,IAAAA,wBACzCF,GAA+C,IAA7BG,OAAOC,KAAKL,GAAMM,QAA9CC,qBACM,CAAEC,kBAAmBJ,OAAOC,KAAKL,GAAMS,KAAI,SAACC,UAAcC,OAAOD,eAElEE,UAAYR,OAAOC,KAAKL,GAAMa,QAAO,SAACC,EAAaC,SAChDC,EAAS,IAAIC,EAAmB,CAAEf,gBAAiBgB,EAAKhB,yBAC9Dc,EAAOG,YAAY,IAAIC,iBAAepB,EAAKW,OAAOI,IAAWG,EAAKf,mBAC3DC,OAAOiB,OAAOP,UAAgBH,OAAOI,IAAWC,QACtD,MACEM,eAAiBrB,GAAkBU,OAAOP,OAAOC,KAAKL,GAAM,MAC5DE,gBAAkBA,IAClBC,iBAAmBA,IACnBoB,QAAS,sHAGHC,+BACXC,KAAKb,UAALa,KAAoBH,gBAAgBI,QAApCD,KACKF,QAAS,kBACP,CAAEI,SAFTF,KAEwBb,UAFxBa,KAEuCH,gBAAiBP,QAFxDU,KAEsEH,eAAgBM,QAAS,6CAGpFC,kDACJJ,KAAKb,UAALa,KAAoBH,uDAGhBQ,iDACJL,KAAKH,sDAGDS,6CACJ,SAGFC,WAAA,gBACApB,UAAUa,KAAKH,gBAAgBW,YAC/BV,QAAS,KAGTW,cAAA,SAAcnB,GACTX,OAAOC,KAAKoB,KAAKb,WAAWuB,SAASpB,EAAQqB,aAAvD7B,MACIkB,KAAKF,aACFX,UAAUa,KAAKH,gBAAgBW,YAC/BX,eAAiBP,OACjBH,UAAUa,KAAKH,gBAAgBI,aAC/BW,WAAW,CAAEV,SAAUF,KAAKb,UAAUa,KAAKH,gBAAiBP,QAAAA,UAE5DO,eAAiBP,KArD5B,CAAsCuB"}