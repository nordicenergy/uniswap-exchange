{"version":3,"file":"network-connector.esm.js","sources":["../src/index.ts"],"sourcesContent":["import { ConnectorUpdate } from '@web3-react/types'\nimport { AbstractConnector } from '@web3-react/abstract-connector'\nimport Web3ProviderEngine from 'web3-provider-engine'\nimport CacheSubprovider from 'web3-provider-engine/subproviders/cache.js'\nimport { RPCSubprovider } from '@0x/subproviders/lib/src/subproviders/rpc_subprovider' // https://github.com/0xProject/0x-monorepo/issues/1400\nimport invariant from 'tiny-invariant'\n\ninterface NetworkConnectorArguments {\n  urls: { [chainId: number]: string }\n  defaultChainId?: number\n  pollingInterval?: number\n  requestTimeoutMs?: number\n}\n\nexport class NetworkConnector extends AbstractConnector {\n  private readonly providers: { [chainId: number]: any }\n  private currentChainId: number\n  private readonly pollingInterval?: number\n  private readonly requestTimeoutMs?: number\n  private active: boolean\n\n  constructor({ urls, defaultChainId, pollingInterval, requestTimeoutMs }: NetworkConnectorArguments) {\n    invariant(defaultChainId || Object.keys(urls).length === 1, 'defaultChainId is a required argument with >1 url')\n    super({ supportedChainIds: Object.keys(urls).map((k): number => Number(k)) })\n\n    this.currentChainId = defaultChainId || Number(Object.keys(urls)[0])\n    this.pollingInterval = pollingInterval\n    this.requestTimeoutMs = requestTimeoutMs\n    this.providers = Object.keys(urls).reduce((accumulator, chainId) => {\n      const engine = new Web3ProviderEngine({ pollingInterval: this.pollingInterval })\n      engine.addProvider(new CacheSubprovider())\n      engine.addProvider(new RPCSubprovider(urls[Number(chainId)], this.requestTimeoutMs))\n      return Object.assign(accumulator, { [Number(chainId)]: engine })\n    }, {})\n    this.active = false\n  }\n\n  public async activate(): Promise<ConnectorUpdate> {\n    this.providers[this.currentChainId].start()\n    this.active = true\n    return { provider: this.providers[this.currentChainId], chainId: this.currentChainId, account: null }\n  }\n\n  public async getProvider(): Promise<Web3ProviderEngine> {\n    return this.providers[this.currentChainId]\n  }\n\n  public async getChainId(): Promise<number> {\n    return this.currentChainId\n  }\n\n  public async getAccount(): Promise<null> {\n    return null\n  }\n\n  public deactivate() {\n    this.providers[this.currentChainId].stop()\n    this.active = false\n  }\n\n  public changeChainId(chainId: number) {\n    invariant(Object.keys(this.providers).includes(chainId.toString()), `No url found for chainId ${chainId}`)\n    if (this.active) {\n      this.providers[this.currentChainId].stop()\n      this.currentChainId = chainId\n      this.providers[this.currentChainId].start()\n      this.emitUpdate({ provider: this.providers[this.currentChainId], chainId })\n    } else {\n      this.currentChainId = chainId\n    }\n  }\n}\n"],"names":["NetworkConnector","urls","defaultChainId","pollingInterval","requestTimeoutMs","Object","keys","length","invariant","supportedChainIds","map","k","Number","currentChainId","providers","reduce","accumulator","chainId","engine","Web3ProviderEngine","addProvider","CacheSubprovider","RPCSubprovider","assign","active","activate","start","provider","account","getProvider","getChainId","getAccount","deactivate","stop","changeChainId","includes","toString","emitUpdate","AbstractConnector"],"mappings":";;;;;;;;;;;;IAcaA,gBAAb;;AAAA;;;;;;QAOgBC,YAAAA;QAAMC,sBAAAA;QAAgBC,uBAAAA;QAAiBC,wBAAAA;MACzCF,cAAc,IAAIG,MAAM,CAACC,IAAP,CAAYL,IAAZ,EAAkBM,MAAlB,KAA6B,CAAzD,4CAAAC,SAAS,QAAmD,mDAAnD,CAAT,GAAAA,SAAS,OAAT;0CACM;MAAEC,iBAAiB,EAAEJ,MAAM,CAACC,IAAP,CAAYL,IAAZ,EAAkBS,GAAlB,CAAsB,UAACC,CAAD;eAAeC,MAAM,CAACD,CAAD,CAArB;OAAtB;KAA3B;UAEKE,cAAL,GAAsBX,cAAc,IAAIU,MAAM,CAACP,MAAM,CAACC,IAAP,CAAYL,IAAZ,EAAkB,CAAlB,CAAD,CAA9C;UACKE,eAAL,GAAuBA,eAAvB;UACKC,gBAAL,GAAwBA,gBAAxB;UACKU,SAAL,GAAiBT,MAAM,CAACC,IAAP,CAAYL,IAAZ,EAAkBc,MAAlB,CAAyB,UAACC,WAAD,EAAcC,OAAd;;;UAClCC,MAAM,GAAG,IAAIC,kBAAJ,CAAuB;QAAEhB,eAAe,EAAE,MAAKA;OAA/C,CAAf;MACAe,MAAM,CAACE,WAAP,CAAmB,IAAIC,gBAAJ,EAAnB;MACAH,MAAM,CAACE,WAAP,CAAmB,IAAIE,cAAJ,CAAmBrB,IAAI,CAACW,MAAM,CAACK,OAAD,CAAP,CAAvB,EAA0C,MAAKb,gBAA/C,CAAnB;aACOC,MAAM,CAACkB,MAAP,CAAcP,WAAd,uCAA8BJ,MAAM,CAACK,OAAD,CAApC,IAAgDC,MAAhD,kBAAP;KAJe,EAKd,EALc,CAAjB;UAMKM,MAAL,GAAc,KAAd;;;;;;SAGWC,QAvBf;;mBAwBI;;aAAKX,SAAL,CAAe,OAAKD,cAApB,EAAoCa,KAApC;;aACKF,MAAL,GAAc,IAAd;6BACO;QAAEG,QAAQ,EAAE,OAAKb,SAAL,CAAe,OAAKD,cAApB,CAAZ;QAAiDI,OAAO,EAAE,OAAKJ,cAA/D;QAA+Ee,OAAO,EAAE;OAA/F;KA1BJ;;;;;SA6BeC,WA7Bf;;mBA8BW;;6BAAA,OAAKf,SAAL,CAAe,OAAKD,cAApB,CAAP;KA9BJ;;;;;SAiCeiB,UAjCf;;mBAkCW;;6BAAA,OAAKjB,cAAZ;KAlCJ;;;;;SAqCekB,UArCf;2BAsCW,IAAP;GAtCJ;;SAyCSC,UAzCT,GAyCS;SACAlB,SAAL,CAAe,KAAKD,cAApB,EAAoCoB,IAApC;SACKT,MAAL,GAAc,KAAd;GA3CJ;;SA8CSU,aA9CT,GA8CS,uBAAcjB,OAAd;KACKZ,MAAM,CAACC,IAAP,CAAY,KAAKQ,SAAjB,EAA4BqB,QAA5B,CAAqClB,OAAO,CAACmB,QAAR,EAArC,CAAV,2CAAA5B,SAAS,sCAAuFS,OAAvF,CAAT,GAAAT,SAAS,OAAT;;QACI,KAAKgB,MAAT,EAAiB;WACVV,SAAL,CAAe,KAAKD,cAApB,EAAoCoB,IAApC;WACKpB,cAAL,GAAsBI,OAAtB;WACKH,SAAL,CAAe,KAAKD,cAApB,EAAoCa,KAApC;WACKW,UAAL,CAAgB;QAAEV,QAAQ,EAAE,KAAKb,SAAL,CAAe,KAAKD,cAApB,CAAZ;QAAiDI,OAAO,EAAPA;OAAjE;KAJF,MAKO;WACAJ,cAAL,GAAsBI,OAAtB;;GAtDN;;;EAAsCqB,iBAAtC;;;;"}