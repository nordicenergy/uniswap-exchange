{"ast":null,"code":"import _slicedToArray from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{createContext,useContext,useReducer,useMemo,useCallback,useEffect}from'react';import{useWeb3Context}from'web3-react';import{safeAccess,isAddress,getTokenAllowance}from'../utils';import{useBlockNumber}from'./Application';var UPDATE='UPDATE';var AllowancesContext=createContext();function useAllowancesContext(){return useContext(AllowancesContext);}function reducer(state,_ref){var type=_ref.type,payload=_ref.payload;switch(type){case UPDATE:{var networkId=payload.networkId,address=payload.address,tokenAddress=payload.tokenAddress,spenderAddress=payload.spenderAddress,value=payload.value,blockNumber=payload.blockNumber;return _objectSpread({},state,_defineProperty({},networkId,_objectSpread({},safeAccess(state,[networkId])||{},_defineProperty({},address,_objectSpread({},safeAccess(state,[networkId,address])||{},_defineProperty({},tokenAddress,_objectSpread({},safeAccess(state,[networkId,address,tokenAddress])||{},_defineProperty({},spenderAddress,{value:value,blockNumber:blockNumber}))))))));}default:{throw Error(\"Unexpected action type in AllowancesContext reducer: '\".concat(type,\"'.\"));}}}export default function Provider(_ref2){var children=_ref2.children;var _useReducer=useReducer(reducer,{}),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var update=useCallback(function(networkId,address,tokenAddress,spenderAddress,value,blockNumber){dispatch({type:UPDATE,payload:{networkId:networkId,address:address,tokenAddress:tokenAddress,spenderAddress:spenderAddress,value:value,blockNumber:blockNumber}});},[]);return React.createElement(AllowancesContext.Provider,{value:useMemo(function(){return[state,{update:update}];},[state,update])},children);}export function useAddressAllowance(address,tokenAddress,spenderAddress){var _useWeb3Context=useWeb3Context(),networkId=_useWeb3Context.networkId,library=_useWeb3Context.library;var globalBlockNumber=useBlockNumber();var _useAllowancesContext=useAllowancesContext(),_useAllowancesContext2=_slicedToArray(_useAllowancesContext,2),state=_useAllowancesContext2[0],update=_useAllowancesContext2[1].update;var _ref3=safeAccess(state,[networkId,address,tokenAddress,spenderAddress])||{},value=_ref3.value,blockNumber=_ref3.blockNumber;useEffect(function(){if(isAddress(address)&&isAddress(tokenAddress)&&isAddress(spenderAddress)&&(value===undefined||blockNumber!==globalBlockNumber)&&(networkId||networkId===0)&&library){var stale=false;getTokenAllowance(address,tokenAddress,spenderAddress,library).then(function(value){if(!stale){update(networkId,address,tokenAddress,spenderAddress,value,globalBlockNumber);}}).catch(function(){if(!stale){update(networkId,address,tokenAddress,spenderAddress,null,globalBlockNumber);}});return function(){stale=true;};}},[address,tokenAddress,spenderAddress,value,blockNumber,globalBlockNumber,networkId,library,update]);return value;}","map":{"version":3,"sources":["/workspace/uniswap-exchange/src/contexts/Allowances.js"],"names":["React","createContext","useContext","useReducer","useMemo","useCallback","useEffect","useWeb3Context","safeAccess","isAddress","getTokenAllowance","useBlockNumber","UPDATE","AllowancesContext","useAllowancesContext","reducer","state","type","payload","networkId","address","tokenAddress","spenderAddress","value","blockNumber","Error","Provider","children","dispatch","update","useAddressAllowance","library","globalBlockNumber","undefined","stale","then","catch"],"mappings":"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","sourcesContent":["import React, { createContext, useContext, useReducer, useMemo, useCallback, useEffect } from 'react'\nimport { useWeb3Context } from 'web3-react'\n\nimport { safeAccess, isAddress, getTokenAllowance } from '../utils'\nimport { useBlockNumber } from './Application'\n\nconst UPDATE = 'UPDATE'\n\nconst AllowancesContext = createContext()\n\nfunction useAllowancesContext() {\n  return useContext(AllowancesContext)\n}\n\nfunction reducer(state, { type, payload }) {\n  switch (type) {\n    case UPDATE: {\n      const { networkId, address, tokenAddress, spenderAddress, value, blockNumber } = payload\n      return {\n        ...state,\n        [networkId]: {\n          ...(safeAccess(state, [networkId]) || {}),\n          [address]: {\n            ...(safeAccess(state, [networkId, address]) || {}),\n            [tokenAddress]: {\n              ...(safeAccess(state, [networkId, address, tokenAddress]) || {}),\n              [spenderAddress]: {\n                value,\n                blockNumber\n              }\n            }\n          }\n        }\n      }\n    }\n    default: {\n      throw Error(`Unexpected action type in AllowancesContext reducer: '${type}'.`)\n    }\n  }\n}\n\nexport default function Provider({ children }) {\n  const [state, dispatch] = useReducer(reducer, {})\n\n  const update = useCallback((networkId, address, tokenAddress, spenderAddress, value, blockNumber) => {\n    dispatch({ type: UPDATE, payload: { networkId, address, tokenAddress, spenderAddress, value, blockNumber } })\n  }, [])\n\n  return (\n    <AllowancesContext.Provider value={useMemo(() => [state, { update }], [state, update])}>\n      {children}\n    </AllowancesContext.Provider>\n  )\n}\n\nexport function useAddressAllowance(address, tokenAddress, spenderAddress) {\n  const { networkId, library } = useWeb3Context()\n\n  const globalBlockNumber = useBlockNumber()\n\n  const [state, { update }] = useAllowancesContext()\n  const { value, blockNumber } = safeAccess(state, [networkId, address, tokenAddress, spenderAddress]) || {}\n\n  useEffect(() => {\n    if (\n      isAddress(address) &&\n      isAddress(tokenAddress) &&\n      isAddress(spenderAddress) &&\n      (value === undefined || blockNumber !== globalBlockNumber) &&\n      (networkId || networkId === 0) &&\n      library\n    ) {\n      let stale = false\n\n      getTokenAllowance(address, tokenAddress, spenderAddress, library)\n        .then(value => {\n          if (!stale) {\n            update(networkId, address, tokenAddress, spenderAddress, value, globalBlockNumber)\n          }\n        })\n        .catch(() => {\n          if (!stale) {\n            update(networkId, address, tokenAddress, spenderAddress, null, globalBlockNumber)\n          }\n        })\n\n      return () => {\n        stale = true\n      }\n    }\n  }, [address, tokenAddress, spenderAddress, value, blockNumber, globalBlockNumber, networkId, library, update])\n\n  return value\n}\n"]},"metadata":{},"sourceType":"module"}