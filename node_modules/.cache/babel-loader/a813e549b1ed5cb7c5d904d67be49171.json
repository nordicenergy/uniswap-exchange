{"ast":null,"code":"import _regeneratorRuntime from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _objectWithoutProperties from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _taggedTemplateLiteral from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject5(){var data=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: center;\\n  padding: 2rem;\\n\\n  button {\\n    max-width: 20rem;\\n  }\\n\"]);_templateObject5=function _templateObject5(){return data;};return data;}function _templateObject4(){var data=_taggedTemplateLiteral([\"\\n  flex: 1 1 auto;\\n  width: 0;\\n  color: \",\";\\n\"]);_templateObject4=function _templateObject4(){return data;};return data;}function _templateObject3(){var data=_taggedTemplateLiteral([\"\\n  \",\";\\n  align-items: center;\\n  color: \",\";\\n  font-size: 0.75rem;\\n  padding: 0.5rem 1rem;\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n  color: \",\";\\n  width: 0.625rem;\\n  height: 0.625rem;\\n  position: relative;\\n  padding: 0.875rem;\\n  cursor: \",\";\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  justify-content: center;\\n  align-items: center;\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useState,useReducer,useEffect}from'react';import ReactGA from'react-ga';import{createBrowserHistory}from'history';import{ethers}from'ethers';import styled from'styled-components';import{useTranslation}from'react-i18next';import{useWeb3React}from'../../hooks';import{brokenTokens}from'../../constants';import{amountFormatter,calculateGasMargin,isAddress}from'../../utils';import{useExchangeContract}from'../../hooks';import{useTokenDetails,INITIAL_TOKENS_CONTEXT}from'../../contexts/Tokens';import{useTransactionAdder}from'../../contexts/Transactions';import{useAddressBalance,useExchangeReserves}from'../../contexts/Balances';import{useAddressAllowance}from'../../contexts/Allowances';import{useWalletModalToggle}from'../../contexts/Application';import{useETHPriceInUSD}from'../../contexts/Balances';import{Button}from'../../theme';import CurrencyInputPanel from'../CurrencyInputPanel';import AddressInputPanel from'../AddressInputPanel';import OversizedPanel from'../OversizedPanel';import TransactionDetails from'../TransactionDetails';import ArrowDown from'../../assets/svg/SVGArrowDown';import WarningCard from'../WarningCard';var INPUT=0;var OUTPUT=1;var ETH_TO_TOKEN=0;var TOKEN_TO_ETH=1;var TOKEN_TO_TOKEN=2;// denominated in bips\nvar ALLOWED_SLIPPAGE_DEFAULT=50;var TOKEN_ALLOWED_SLIPPAGE_DEFAULT=50;// 15 minutes, denominated in seconds\nvar DEFAULT_DEADLINE_FROM_NOW=60*15;// % above the calculated gas cost that we actually send, denominated in bips\nvar GAS_MARGIN=ethers.utils.bigNumberify(1000);var DownArrowBackground=styled.div(_templateObject(),function(_ref){var theme=_ref.theme;return theme.flexRowNoWrap;});var WrappedArrowDown=function WrappedArrowDown(_ref2){var clickable=_ref2.clickable,active=_ref2.active,rest=_objectWithoutProperties(_ref2,[\"clickable\",\"active\"]);return React.createElement(ArrowDown,rest);};var DownArrow=styled(WrappedArrowDown)(_templateObject2(),function(_ref3){var theme=_ref3.theme,active=_ref3.active;return active?theme.royalBlue:theme.chaliceGray;},function(_ref4){var clickable=_ref4.clickable;return clickable&&'pointer';});var ExchangeRateWrapper=styled.div(_templateObject3(),function(_ref5){var theme=_ref5.theme;return theme.flexRowNoWrap;},function(_ref6){var theme=_ref6.theme;return theme.doveGray;});var ExchangeRate=styled.span(_templateObject4(),function(_ref7){var theme=_ref7.theme;return theme.doveGray;});var Flex=styled.div(_templateObject5());function calculateSlippageBounds(value){var token=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var tokenAllowedSlippage=arguments.length>2?arguments[2]:undefined;var allowedSlippage=arguments.length>3?arguments[3]:undefined;if(value){var offset=value.mul(token?tokenAllowedSlippage:allowedSlippage).div(ethers.utils.bigNumberify(10000));var minimum=value.sub(offset);var maximum=value.add(offset);return{minimum:minimum.lt(ethers.constants.Zero)?ethers.constants.Zero:minimum,maximum:maximum.gt(ethers.constants.MaxUint256)?ethers.constants.MaxUint256:maximum};}else{return{};}}function getSwapType(inputCurrency,outputCurrency){if(!inputCurrency||!outputCurrency){return null;}else if(inputCurrency==='ETH'){return ETH_TO_TOKEN;}else if(outputCurrency==='ETH'){return TOKEN_TO_ETH;}else{return TOKEN_TO_TOKEN;}}// this mocks the getInputPrice function, and calculates the required output\nfunction calculateEtherTokenOutputFromInput(inputAmount,inputReserve,outputReserve){var inputAmountWithFee=inputAmount.mul(ethers.utils.bigNumberify(997));var numerator=inputAmountWithFee.mul(outputReserve);var denominator=inputReserve.mul(ethers.utils.bigNumberify(1000)).add(inputAmountWithFee);return numerator.div(denominator);}// this mocks the getOutputPrice function, and calculates the required input\nfunction calculateEtherTokenInputFromOutput(outputAmount,inputReserve,outputReserve){var numerator=inputReserve.mul(outputAmount).mul(ethers.utils.bigNumberify(1000));var denominator=outputReserve.sub(outputAmount).mul(ethers.utils.bigNumberify(997));return numerator.div(denominator).add(ethers.constants.One);}function getInitialSwapState(state){return{independentValue:state.exactFieldURL&&state.exactAmountURL?state.exactAmountURL:'',// this is a user input\ndependentValue:'',// this is a calculated number\nindependentField:state.exactFieldURL==='output'?OUTPUT:INPUT,inputCurrency:state.inputCurrencyURL?state.inputCurrencyURL:'ETH',outputCurrency:state.outputCurrencyURL?state.outputCurrencyURL==='ETH'?state.inputCurrencyURL&&state.inputCurrencyURL!=='ETH'?'ETH':'':state.outputCurrencyURL:state.initialCurrency?state.initialCurrency:''};}function swapStateReducer(state,action){switch(action.type){case'FLIP_INDEPENDENT':{var independentField=state.independentField,inputCurrency=state.inputCurrency,outputCurrency=state.outputCurrency;return _objectSpread({},state,{dependentValue:'',independentField:independentField===INPUT?OUTPUT:INPUT,inputCurrency:outputCurrency,outputCurrency:inputCurrency});}case'SELECT_CURRENCY':{var _inputCurrency=state.inputCurrency,_outputCurrency=state.outputCurrency;var _action$payload=action.payload,field=_action$payload.field,currency=_action$payload.currency;var newInputCurrency=field===INPUT?currency:_inputCurrency;var newOutputCurrency=field===OUTPUT?currency:_outputCurrency;if(newInputCurrency===newOutputCurrency){return _objectSpread({},state,{inputCurrency:field===INPUT?currency:'',outputCurrency:field===OUTPUT?currency:''});}else{return _objectSpread({},state,{inputCurrency:newInputCurrency,outputCurrency:newOutputCurrency});}}case'UPDATE_INDEPENDENT':{var _action$payload2=action.payload,_field=_action$payload2.field,value=_action$payload2.value;var dependentValue=state.dependentValue,independentValue=state.independentValue;return _objectSpread({},state,{independentValue:value,dependentValue:value===independentValue?dependentValue:'',independentField:_field});}case'UPDATE_DEPENDENT':{return _objectSpread({},state,{dependentValue:action.payload});}default:{return getInitialSwapState();}}}function getExchangeRate(inputValue,inputDecimals,outputValue,outputDecimals){var invert=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;try{if(inputValue&&(inputDecimals||inputDecimals===0)&&outputValue&&(outputDecimals||outputDecimals===0)){var factor=ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18));if(invert){return inputValue.mul(factor).mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals))).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals))).div(outputValue);}else{return outputValue.mul(factor).mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals))).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals))).div(inputValue);}}}catch(_unused){}}function getMarketRate(swapType,inputReserveETH,inputReserveToken,inputDecimals,outputReserveETH,outputReserveToken,outputDecimals){var invert=arguments.length>7&&arguments[7]!==undefined?arguments[7]:false;if(swapType===ETH_TO_TOKEN){return getExchangeRate(outputReserveETH,18,outputReserveToken,outputDecimals,invert);}else if(swapType===TOKEN_TO_ETH){return getExchangeRate(inputReserveToken,inputDecimals,inputReserveETH,18,invert);}else if(swapType===TOKEN_TO_TOKEN){var factor=ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18));var firstRate=getExchangeRate(inputReserveToken,inputDecimals,inputReserveETH,18);var secondRate=getExchangeRate(outputReserveETH,18,outputReserveToken,outputDecimals);try{return!!(firstRate&&secondRate)?firstRate.mul(secondRate).div(factor):undefined;}catch(_unused2){}}}export default function ExchangePage(_ref8){var initialCurrency=_ref8.initialCurrency,_ref8$sending=_ref8.sending,sending=_ref8$sending===void 0?false:_ref8$sending,params=_ref8.params;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useWeb3React=useWeb3React(),account=_useWeb3React.account,chainId=_useWeb3React.chainId,error=_useWeb3React.error;var urlAddedTokens={};if(params.inputCurrency){urlAddedTokens[params.inputCurrency]=true;}if(params.outputCurrency){urlAddedTokens[params.outputCurrency]=true;}if(isAddress(initialCurrency)){urlAddedTokens[initialCurrency]=true;}// BigNumber.js instance\nvar ethPrice=useETHPriceInUSD();var addTransaction=useTransactionAdder();// check if URL specifies valid slippage, if so use as default\nvar initialSlippage=function initialSlippage(){var token=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var slippage=Number.parseInt(params.slippage);if(!isNaN(slippage)&&(slippage===0||slippage>=1)){return slippage;// round to match custom input availability\n}// check for token <-> token slippage option\nreturn token?TOKEN_ALLOWED_SLIPPAGE_DEFAULT:ALLOWED_SLIPPAGE_DEFAULT;};// check URL params for recipient, only on send page\nvar initialRecipient=function initialRecipient(){if(sending&&params.recipient){return params.recipient;}return'';};var _useState=useState(),_useState2=_slicedToArray(_useState,2),brokenTokenWarning=_useState2[0],setBrokenTokenWarning=_useState2[1];var _useState3=useState(DEFAULT_DEADLINE_FROM_NOW),_useState4=_slicedToArray(_useState3,2),deadlineFromNow=_useState4[0],setDeadlineFromNow=_useState4[1];var _useState5=useState(function(){return initialSlippage();}),_useState6=_slicedToArray(_useState5,2),rawSlippage=_useState6[0],setRawSlippage=_useState6[1];var _useState7=useState(function(){return initialSlippage(true);}),_useState8=_slicedToArray(_useState7,2),rawTokenSlippage=_useState8[0],setRawTokenSlippage=_useState8[1];var allowedSlippageBig=ethers.utils.bigNumberify(rawSlippage);var tokenAllowedSlippageBig=ethers.utils.bigNumberify(rawTokenSlippage);// analytics\nuseEffect(function(){ReactGA.pageview(window.location.pathname+window.location.search);},[]);// core swap state\nvar _useReducer=useReducer(swapStateReducer,{initialCurrency:initialCurrency,inputCurrencyURL:params.inputCurrency,outputCurrencyURL:params.outputCurrency,exactFieldURL:params.exactField,exactAmountURL:params.exactAmount},getInitialSwapState),_useReducer2=_slicedToArray(_useReducer,2),swapState=_useReducer2[0],dispatchSwapState=_useReducer2[1];var independentValue=swapState.independentValue,dependentValue=swapState.dependentValue,independentField=swapState.independentField,inputCurrency=swapState.inputCurrency,outputCurrency=swapState.outputCurrency;useEffect(function(){setBrokenTokenWarning(false);for(var i=0;i<brokenTokens.length;i++){if(brokenTokens[i].toLowerCase()===outputCurrency.toLowerCase()||brokenTokens[i].toLowerCase()===inputCurrency.toLowerCase()){setBrokenTokenWarning(true);}}},[outputCurrency,inputCurrency]);var _useState9=useState({address:initialRecipient(),name:''}),_useState10=_slicedToArray(_useState9,2),recipient=_useState10[0],setRecipient=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),recipientError=_useState12[0],setRecipientError=_useState12[1];// get swap type from the currency types\nvar swapType=getSwapType(inputCurrency,outputCurrency);// get decimals and exchange address for each of the currency types\nvar _useTokenDetails=useTokenDetails(inputCurrency),inputSymbol=_useTokenDetails.symbol,inputDecimals=_useTokenDetails.decimals,inputExchangeAddress=_useTokenDetails.exchangeAddress;var _useTokenDetails2=useTokenDetails(outputCurrency),outputSymbol=_useTokenDetails2.symbol,outputDecimals=_useTokenDetails2.decimals,outputExchangeAddress=_useTokenDetails2.exchangeAddress;var inputExchangeContract=useExchangeContract(inputExchangeAddress);var outputExchangeContract=useExchangeContract(outputExchangeAddress);var contract=swapType===ETH_TO_TOKEN?outputExchangeContract:inputExchangeContract;// get input allowance\nvar inputAllowance=useAddressAllowance(account,inputCurrency,inputExchangeAddress);// fetch reserves for each of the currency types\nvar _useExchangeReserves=useExchangeReserves(inputCurrency),inputReserveETH=_useExchangeReserves.reserveETH,inputReserveToken=_useExchangeReserves.reserveToken;var _useExchangeReserves2=useExchangeReserves(outputCurrency),outputReserveETH=_useExchangeReserves2.reserveETH,outputReserveToken=_useExchangeReserves2.reserveToken;// get balances for each of the currency types\nvar inputBalance=useAddressBalance(account,inputCurrency);var outputBalance=useAddressBalance(account,outputCurrency);var inputBalanceFormatted=!!(inputBalance&&Number.isInteger(inputDecimals))?amountFormatter(inputBalance,inputDecimals,Math.min(4,inputDecimals)):'';var outputBalanceFormatted=!!(outputBalance&&Number.isInteger(outputDecimals))?amountFormatter(outputBalance,outputDecimals,Math.min(4,outputDecimals)):'';// compute useful transforms of the data above\nvar independentDecimals=independentField===INPUT?inputDecimals:outputDecimals;var dependentDecimals=independentField===OUTPUT?inputDecimals:outputDecimals;// declare/get parsed and formatted versions of input/output values\nvar _useState13=useState(),_useState14=_slicedToArray(_useState13,2),independentValueParsed=_useState14[0],setIndependentValueParsed=_useState14[1];var dependentValueFormatted=!!(dependentValue&&(dependentDecimals||dependentDecimals===0))?amountFormatter(dependentValue,dependentDecimals,Math.min(4,dependentDecimals),false):'';var inputValueParsed=independentField===INPUT?independentValueParsed:dependentValue;var inputValueFormatted=independentField===INPUT?independentValue:dependentValueFormatted;var outputValueParsed=independentField===OUTPUT?independentValueParsed:dependentValue;var outputValueFormatted=independentField===OUTPUT?independentValue:dependentValueFormatted;// validate + parse independent value\nvar _useState15=useState(),_useState16=_slicedToArray(_useState15,2),independentError=_useState16[0],setIndependentError=_useState16[1];useEffect(function(){if(independentValue&&(independentDecimals||independentDecimals===0)){try{var parsedValue=ethers.utils.parseUnits(independentValue,independentDecimals);if(parsedValue.lte(ethers.constants.Zero)||parsedValue.gte(ethers.constants.MaxUint256)){throw Error();}else{setIndependentValueParsed(parsedValue);setIndependentError(null);}}catch(_unused3){setIndependentError(t('inputNotValid'));}return function(){setIndependentValueParsed();setIndependentError();};}},[independentValue,independentDecimals,t]);// calculate slippage from target rate\nvar _calculateSlippageBou=calculateSlippageBounds(dependentValue,swapType===TOKEN_TO_TOKEN,tokenAllowedSlippageBig,allowedSlippageBig),dependentValueMinumum=_calculateSlippageBou.minimum,dependentValueMaximum=_calculateSlippageBou.maximum;// validate input allowance + balance\nvar _useState17=useState(),_useState18=_slicedToArray(_useState17,2),inputError=_useState18[0],setInputError=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),showUnlock=_useState20[0],setShowUnlock=_useState20[1];useEffect(function(){var inputValueCalculation=independentField===INPUT?independentValueParsed:dependentValueMaximum;if(inputBalance&&(inputAllowance||inputCurrency==='ETH')&&inputValueCalculation){if(inputBalance.lt(inputValueCalculation)){setInputError(t('insufficientBalance'));}else if(inputCurrency!=='ETH'&&inputAllowance.lt(inputValueCalculation)){setInputError(t('unlockTokenCont'));setShowUnlock(true);}else{setInputError(null);setShowUnlock(false);}return function(){setInputError();setShowUnlock(false);};}},[independentField,independentValueParsed,dependentValueMaximum,inputBalance,inputCurrency,inputAllowance,t]);// calculate dependent value\nuseEffect(function(){var amount=independentValueParsed;if(swapType===ETH_TO_TOKEN){var reserveETH=outputReserveETH;var reserveToken=outputReserveToken;if(amount&&reserveETH&&reserveToken){try{var calculatedDependentValue=independentField===INPUT?calculateEtherTokenOutputFromInput(amount,reserveETH,reserveToken):calculateEtherTokenInputFromOutput(amount,reserveETH,reserveToken);if(calculatedDependentValue.lte(ethers.constants.Zero)){throw Error();}dispatchSwapState({type:'UPDATE_DEPENDENT',payload:calculatedDependentValue});}catch(_unused4){setIndependentError(t('insufficientLiquidity'));}return function(){dispatchSwapState({type:'UPDATE_DEPENDENT',payload:''});};}}else if(swapType===TOKEN_TO_ETH){var _reserveETH=inputReserveETH;var _reserveToken=inputReserveToken;if(amount&&_reserveETH&&_reserveToken){try{var _calculatedDependentValue=independentField===INPUT?calculateEtherTokenOutputFromInput(amount,_reserveToken,_reserveETH):calculateEtherTokenInputFromOutput(amount,_reserveToken,_reserveETH);if(_calculatedDependentValue.lte(ethers.constants.Zero)){throw Error();}dispatchSwapState({type:'UPDATE_DEPENDENT',payload:_calculatedDependentValue});}catch(_unused5){setIndependentError(t('insufficientLiquidity'));}return function(){dispatchSwapState({type:'UPDATE_DEPENDENT',payload:''});};}}else if(swapType===TOKEN_TO_TOKEN){var reserveETHFirst=inputReserveETH;var reserveTokenFirst=inputReserveToken;var reserveETHSecond=outputReserveETH;var reserveTokenSecond=outputReserveToken;if(amount&&reserveETHFirst&&reserveTokenFirst&&reserveETHSecond&&reserveTokenSecond){try{if(independentField===INPUT){var intermediateValue=calculateEtherTokenOutputFromInput(amount,reserveTokenFirst,reserveETHFirst);if(intermediateValue.lte(ethers.constants.Zero)){throw Error();}var _calculatedDependentValue2=calculateEtherTokenOutputFromInput(intermediateValue,reserveETHSecond,reserveTokenSecond);if(_calculatedDependentValue2.lte(ethers.constants.Zero)){throw Error();}dispatchSwapState({type:'UPDATE_DEPENDENT',payload:_calculatedDependentValue2});}else{var _intermediateValue=calculateEtherTokenInputFromOutput(amount,reserveETHSecond,reserveTokenSecond);if(_intermediateValue.lte(ethers.constants.Zero)){throw Error();}var _calculatedDependentValue3=calculateEtherTokenInputFromOutput(_intermediateValue,reserveTokenFirst,reserveETHFirst);if(_calculatedDependentValue3.lte(ethers.constants.Zero)){throw Error();}dispatchSwapState({type:'UPDATE_DEPENDENT',payload:_calculatedDependentValue3});}}catch(_unused6){setIndependentError(t('insufficientLiquidity'));}return function(){dispatchSwapState({type:'UPDATE_DEPENDENT',payload:''});};}}},[independentValueParsed,swapType,outputReserveETH,outputReserveToken,inputReserveETH,inputReserveToken,independentField,t]);useEffect(function(){var history=createBrowserHistory();history.push(window.location.pathname+'');},[]);var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),inverted=_useState22[0],setInverted=_useState22[1];var exchangeRate=getExchangeRate(inputValueParsed,inputDecimals,outputValueParsed,outputDecimals);var exchangeRateInverted=getExchangeRate(inputValueParsed,inputDecimals,outputValueParsed,outputDecimals,true);var marketRate=getMarketRate(swapType,inputReserveETH,inputReserveToken,inputDecimals,outputReserveETH,outputReserveToken,outputDecimals);var percentSlippage=exchangeRate&&marketRate&&!marketRate.isZero()?exchangeRate.sub(marketRate).abs().mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(marketRate).sub(ethers.utils.bigNumberify(3).mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(15)))):undefined;var percentSlippageFormatted=percentSlippage&&amountFormatter(percentSlippage,16,2);var slippageWarning=percentSlippage&&percentSlippage.gte(ethers.utils.parseEther('.05'))&&percentSlippage.lt(ethers.utils.parseEther('.2'));// [5% - 20%)\nvar highSlippageWarning=percentSlippage&&percentSlippage.gte(ethers.utils.parseEther('.2'));// [20+%\nvar isValid=sending?exchangeRate&&inputError===null&&independentError===null&&recipientError===null&&deadlineFromNow:exchangeRate&&inputError===null&&independentError===null&&deadlineFromNow;var estimatedText=\"(\".concat(t('estimated'),\")\");function formatBalance(value){return\"Balance: \".concat(value);}function onSwap(){return _onSwap.apply(this,arguments);}function _onSwap(){_onSwap=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var deadline,estimate,method,args,value,inputEthPerToken,usdTransactionSize,estimatedGasLimit;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0://if user changed deadline, log new one in minutes\nif(deadlineFromNow!==DEFAULT_DEADLINE_FROM_NOW){ReactGA.event({category:'Advanced Interaction',action:'Set Custom Deadline',value:deadlineFromNow/60});}deadline=Math.ceil(Date.now()/1000)+deadlineFromNow;// if user has changed slippage, log\nif(swapType===TOKEN_TO_TOKEN){if(parseInt(tokenAllowedSlippageBig.toString())!==TOKEN_ALLOWED_SLIPPAGE_DEFAULT){ReactGA.event({category:'Advanced Interaction',action:'Set Custom Slippage',value:parseInt(tokenAllowedSlippageBig.toString())});}}else{if(parseInt(allowedSlippageBig.toString())!==ALLOWED_SLIPPAGE_DEFAULT){ReactGA.event({category:'Advanced Interaction',action:'Set Custom Slippage',value:parseInt(allowedSlippageBig.toString())});}}inputEthPerToken=1;if(inputCurrency!=='ETH'){inputEthPerToken=inputReserveToken&&inputReserveETH?inputReserveETH/inputReserveToken:null;}usdTransactionSize=ethPrice*inputEthPerToken*inputValueFormatted;if(independentField===INPUT){// general details about transaction\nReactGA.event({category:'Transaction',action:sending?'SendInput':'SwapInput',label:outputCurrency,value:usdTransactionSize});if(swapType===ETH_TO_TOKEN){estimate=sending?contract.estimate.ethToTokenTransferInput:contract.estimate.ethToTokenSwapInput;method=sending?contract.ethToTokenTransferInput:contract.ethToTokenSwapInput;args=sending?[dependentValueMinumum,deadline,recipient.address]:[dependentValueMinumum,deadline];value=independentValueParsed;}else if(swapType===TOKEN_TO_ETH){estimate=sending?contract.estimate.tokenToEthTransferInput:contract.estimate.tokenToEthSwapInput;method=sending?contract.tokenToEthTransferInput:contract.tokenToEthSwapInput;args=sending?[independentValueParsed,dependentValueMinumum,deadline,recipient.address]:[independentValueParsed,dependentValueMinumum,deadline];value=ethers.constants.Zero;}else if(swapType===TOKEN_TO_TOKEN){estimate=sending?contract.estimate.tokenToTokenTransferInput:contract.estimate.tokenToTokenSwapInput;method=sending?contract.tokenToTokenTransferInput:contract.tokenToTokenSwapInput;args=sending?[independentValueParsed,dependentValueMinumum,ethers.constants.One,deadline,recipient.address,outputCurrency]:[independentValueParsed,dependentValueMinumum,ethers.constants.One,deadline,outputCurrency];value=ethers.constants.Zero;}}else if(independentField===OUTPUT){// general details about transaction\nReactGA.event({category:'Transaction',action:sending?'SendOutput':'SwapOutput',label:outputCurrency,value:usdTransactionSize});if(swapType===ETH_TO_TOKEN){estimate=sending?contract.estimate.ethToTokenTransferOutput:contract.estimate.ethToTokenSwapOutput;method=sending?contract.ethToTokenTransferOutput:contract.ethToTokenSwapOutput;args=sending?[independentValueParsed,deadline,recipient.address]:[independentValueParsed,deadline];value=dependentValueMaximum;}else if(swapType===TOKEN_TO_ETH){estimate=sending?contract.estimate.tokenToEthTransferOutput:contract.estimate.tokenToEthSwapOutput;method=sending?contract.tokenToEthTransferOutput:contract.tokenToEthSwapOutput;args=sending?[independentValueParsed,dependentValueMaximum,deadline,recipient.address]:[independentValueParsed,dependentValueMaximum,deadline];value=ethers.constants.Zero;}else if(swapType===TOKEN_TO_TOKEN){estimate=sending?contract.estimate.tokenToTokenTransferOutput:contract.estimate.tokenToTokenSwapOutput;method=sending?contract.tokenToTokenTransferOutput:contract.tokenToTokenSwapOutput;args=sending?[independentValueParsed,dependentValueMaximum,ethers.constants.MaxUint256,deadline,recipient.address,outputCurrency]:[independentValueParsed,dependentValueMaximum,ethers.constants.MaxUint256,deadline,outputCurrency];value=ethers.constants.Zero;}}_context.next=9;return estimate.apply(void 0,_toConsumableArray(args).concat([{value:value}]));case 9:estimatedGasLimit=_context.sent;method.apply(void 0,_toConsumableArray(args).concat([{value:value,gasLimit:calculateGasMargin(estimatedGasLimit,GAS_MARGIN)}])).then(function(response){addTransaction(response);});case 11:case\"end\":return _context.stop();}}},_callee);}));return _onSwap.apply(this,arguments);}var _useState23=useState(''),_useState24=_slicedToArray(_useState23,2),customSlippageError=_useState24[0],setcustomSlippageError=_useState24[1];var toggleWalletModal=useWalletModalToggle();var newInputDetected=inputCurrency!=='ETH'&&inputCurrency&&!INITIAL_TOKENS_CONTEXT[chainId].hasOwnProperty(inputCurrency);var newOutputDetected=outputCurrency!=='ETH'&&outputCurrency&&!INITIAL_TOKENS_CONTEXT[chainId].hasOwnProperty(outputCurrency);var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),showInputWarning=_useState26[0],setShowInputWarning=_useState26[1];var _useState27=useState(false),_useState28=_slicedToArray(_useState27,2),showOutputWarning=_useState28[0],setShowOutputWarning=_useState28[1];useEffect(function(){if(newInputDetected){setShowInputWarning(true);}else{setShowInputWarning(false);}},[newInputDetected,setShowInputWarning]);useEffect(function(){if(newOutputDetected){setShowOutputWarning(true);}else{setShowOutputWarning(false);}},[newOutputDetected,setShowOutputWarning]);return React.createElement(React.Fragment,null,showInputWarning&&React.createElement(WarningCard,{onDismiss:function onDismiss(){setShowInputWarning(false);},urlAddedTokens:urlAddedTokens,currency:inputCurrency}),showOutputWarning&&React.createElement(WarningCard,{onDismiss:function onDismiss(){setShowOutputWarning(false);},urlAddedTokens:urlAddedTokens,currency:outputCurrency}),React.createElement(CurrencyInputPanel,{title:t('input'),urlAddedTokens:urlAddedTokens,description:inputValueFormatted&&independentField===OUTPUT?estimatedText:'',extraText:inputBalanceFormatted&&formatBalance(inputBalanceFormatted),extraTextClickHander:function extraTextClickHander(){if(inputBalance&&inputDecimals){var valueToSet=inputCurrency==='ETH'?inputBalance.sub(ethers.utils.parseEther('.1')):inputBalance;if(valueToSet.gt(ethers.constants.Zero)){dispatchSwapState({type:'UPDATE_INDEPENDENT',payload:{value:amountFormatter(valueToSet,inputDecimals,inputDecimals,false),field:INPUT}});}}},onCurrencySelected:function onCurrencySelected(inputCurrency){dispatchSwapState({type:'SELECT_CURRENCY',payload:{currency:inputCurrency,field:INPUT}});},onValueChange:function onValueChange(inputValue){dispatchSwapState({type:'UPDATE_INDEPENDENT',payload:{value:inputValue,field:INPUT}});},showUnlock:showUnlock,selectedTokens:[inputCurrency,outputCurrency],selectedTokenAddress:inputCurrency,value:inputValueFormatted,errorMessage:inputError?inputError:independentField===INPUT?independentError:''}),React.createElement(OversizedPanel,null,React.createElement(DownArrowBackground,null,React.createElement(DownArrow,{onClick:function onClick(){dispatchSwapState({type:'FLIP_INDEPENDENT'});},clickable:true,alt:\"swap\",active:isValid}))),React.createElement(CurrencyInputPanel,{title:t('output'),description:outputValueFormatted&&independentField===INPUT?estimatedText:'',extraText:outputBalanceFormatted&&formatBalance(outputBalanceFormatted),urlAddedTokens:urlAddedTokens,onCurrencySelected:function onCurrencySelected(outputCurrency){dispatchSwapState({type:'SELECT_CURRENCY',payload:{currency:outputCurrency,field:OUTPUT}});},onValueChange:function onValueChange(outputValue){dispatchSwapState({type:'UPDATE_INDEPENDENT',payload:{value:outputValue,field:OUTPUT}});},selectedTokens:[inputCurrency,outputCurrency],selectedTokenAddress:outputCurrency,value:outputValueFormatted,errorMessage:independentField===OUTPUT?independentError:'',disableUnlock:true}),sending?React.createElement(React.Fragment,null,React.createElement(OversizedPanel,null,React.createElement(DownArrowBackground,null,React.createElement(DownArrow,{active:isValid,alt:\"arrow\"}))),React.createElement(AddressInputPanel,{onChange:setRecipient,onError:setRecipientError,initialInput:recipient})):'',React.createElement(OversizedPanel,{hideBottom:true},React.createElement(ExchangeRateWrapper,{onClick:function onClick(){setInverted(function(inverted){return!inverted;});}},React.createElement(ExchangeRate,null,t('exchangeRate')),inverted?React.createElement(\"span\",null,exchangeRate?\"1 \".concat(inputSymbol,\" = \").concat(amountFormatter(exchangeRate,18,6,false),\" \").concat(outputSymbol):' - '):React.createElement(\"span\",null,exchangeRate?\"1 \".concat(outputSymbol,\" = \").concat(amountFormatter(exchangeRateInverted,18,6,false),\" \").concat(inputSymbol):' - '))),React.createElement(TransactionDetails,{account:account,setRawSlippage:setRawSlippage,setRawTokenSlippage:setRawTokenSlippage,rawSlippage:rawSlippage,slippageWarning:slippageWarning,highSlippageWarning:highSlippageWarning,brokenTokenWarning:brokenTokenWarning,setDeadline:setDeadlineFromNow,deadline:deadlineFromNow,inputError:inputError,independentError:independentError,inputCurrency:inputCurrency,outputCurrency:outputCurrency,independentValue:independentValue,independentValueParsed:independentValueParsed,independentField:independentField,INPUT:INPUT,inputValueParsed:inputValueParsed,outputValueParsed:outputValueParsed,inputSymbol:inputSymbol,outputSymbol:outputSymbol,dependentValueMinumum:dependentValueMinumum,dependentValueMaximum:dependentValueMaximum,dependentDecimals:dependentDecimals,independentDecimals:independentDecimals,percentSlippageFormatted:percentSlippageFormatted,setcustomSlippageError:setcustomSlippageError,recipientAddress:recipient.address,sending:sending}),React.createElement(Flex,null,React.createElement(Button,{disabled:brokenTokenWarning?true:!account&&!error?false:!isValid||customSlippageError==='invalid',onClick:account&&!error?onSwap:toggleWalletModal,warning:highSlippageWarning||customSlippageError==='warning',loggedOut:!account},brokenTokenWarning?'Swap':!account?'Connect to a Wallet':sending?highSlippageWarning||customSlippageError==='warning'?t('sendAnyway'):t('send'):highSlippageWarning||customSlippageError==='warning'?t('swapAnyway'):t('swap'))));}","map":{"version":3,"sources":["/workspace/uniswap-exchange/src/components/ExchangePage/index.jsx"],"names":["React","useState","useReducer","useEffect","ReactGA","createBrowserHistory","ethers","styled","useTranslation","useWeb3React","brokenTokens","amountFormatter","calculateGasMargin","isAddress","useExchangeContract","useTokenDetails","INITIAL_TOKENS_CONTEXT","useTransactionAdder","useAddressBalance","useExchangeReserves","useAddressAllowance","useWalletModalToggle","useETHPriceInUSD","Button","CurrencyInputPanel","AddressInputPanel","OversizedPanel","TransactionDetails","ArrowDown","WarningCard","INPUT","OUTPUT","ETH_TO_TOKEN","TOKEN_TO_ETH","TOKEN_TO_TOKEN","ALLOWED_SLIPPAGE_DEFAULT","TOKEN_ALLOWED_SLIPPAGE_DEFAULT","DEFAULT_DEADLINE_FROM_NOW","GAS_MARGIN","utils","bigNumberify","DownArrowBackground","div","theme","flexRowNoWrap","WrappedArrowDown","clickable","active","rest","DownArrow","royalBlue","chaliceGray","ExchangeRateWrapper","doveGray","ExchangeRate","span","Flex","calculateSlippageBounds","value","token","tokenAllowedSlippage","allowedSlippage","offset","mul","minimum","sub","maximum","add","lt","constants","Zero","gt","MaxUint256","getSwapType","inputCurrency","outputCurrency","calculateEtherTokenOutputFromInput","inputAmount","inputReserve","outputReserve","inputAmountWithFee","numerator","denominator","calculateEtherTokenInputFromOutput","outputAmount","One","getInitialSwapState","state","independentValue","exactFieldURL","exactAmountURL","dependentValue","independentField","inputCurrencyURL","outputCurrencyURL","initialCurrency","swapStateReducer","action","type","payload","field","currency","newInputCurrency","newOutputCurrency","getExchangeRate","inputValue","inputDecimals","outputValue","outputDecimals","invert","factor","pow","getMarketRate","swapType","inputReserveETH","inputReserveToken","outputReserveETH","outputReserveToken","firstRate","secondRate","undefined","ExchangePage","sending","params","t","account","chainId","error","urlAddedTokens","ethPrice","addTransaction","initialSlippage","slippage","Number","parseInt","isNaN","initialRecipient","recipient","brokenTokenWarning","setBrokenTokenWarning","deadlineFromNow","setDeadlineFromNow","rawSlippage","setRawSlippage","rawTokenSlippage","setRawTokenSlippage","allowedSlippageBig","tokenAllowedSlippageBig","pageview","window","location","pathname","search","exactField","exactAmount","swapState","dispatchSwapState","i","length","toLowerCase","address","name","setRecipient","recipientError","setRecipientError","inputSymbol","symbol","decimals","inputExchangeAddress","exchangeAddress","outputSymbol","outputExchangeAddress","inputExchangeContract","outputExchangeContract","contract","inputAllowance","reserveETH","reserveToken","inputBalance","outputBalance","inputBalanceFormatted","isInteger","Math","min","outputBalanceFormatted","independentDecimals","dependentDecimals","independentValueParsed","setIndependentValueParsed","dependentValueFormatted","inputValueParsed","inputValueFormatted","outputValueParsed","outputValueFormatted","independentError","setIndependentError","parsedValue","parseUnits","lte","gte","Error","dependentValueMinumum","dependentValueMaximum","inputError","setInputError","showUnlock","setShowUnlock","inputValueCalculation","amount","calculatedDependentValue","reserveETHFirst","reserveTokenFirst","reserveETHSecond","reserveTokenSecond","intermediateValue","history","push","inverted","setInverted","exchangeRate","exchangeRateInverted","marketRate","percentSlippage","isZero","abs","percentSlippageFormatted","slippageWarning","parseEther","highSlippageWarning","isValid","estimatedText","formatBalance","onSwap","event","category","deadline","ceil","Date","now","toString","inputEthPerToken","usdTransactionSize","label","estimate","ethToTokenTransferInput","ethToTokenSwapInput","method","args","tokenToEthTransferInput","tokenToEthSwapInput","tokenToTokenTransferInput","tokenToTokenSwapInput","ethToTokenTransferOutput","ethToTokenSwapOutput","tokenToEthTransferOutput","tokenToEthSwapOutput","tokenToTokenTransferOutput","tokenToTokenSwapOutput","estimatedGasLimit","gasLimit","then","response","customSlippageError","setcustomSlippageError","toggleWalletModal","newInputDetected","hasOwnProperty","newOutputDetected","showInputWarning","setShowInputWarning","showOutputWarning","setShowOutputWarning","valueToSet"],"mappings":"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","sourcesContent":["import React, { useState, useReducer, useEffect } from 'react'\nimport ReactGA from 'react-ga'\nimport { createBrowserHistory } from 'history'\nimport { ethers } from 'ethers'\nimport styled from 'styled-components'\nimport { useTranslation } from 'react-i18next'\n\nimport { useWeb3React } from '../../hooks'\nimport { brokenTokens } from '../../constants'\nimport { amountFormatter, calculateGasMargin, isAddress } from '../../utils'\n\nimport { useExchangeContract } from '../../hooks'\nimport { useTokenDetails, INITIAL_TOKENS_CONTEXT } from '../../contexts/Tokens'\nimport { useTransactionAdder } from '../../contexts/Transactions'\nimport { useAddressBalance, useExchangeReserves } from '../../contexts/Balances'\nimport { useAddressAllowance } from '../../contexts/Allowances'\nimport { useWalletModalToggle } from '../../contexts/Application'\nimport { useETHPriceInUSD } from '../../contexts/Balances'\n\nimport { Button } from '../../theme'\nimport CurrencyInputPanel from '../CurrencyInputPanel'\nimport AddressInputPanel from '../AddressInputPanel'\nimport OversizedPanel from '../OversizedPanel'\nimport TransactionDetails from '../TransactionDetails'\nimport ArrowDown from '../../assets/svg/SVGArrowDown'\nimport WarningCard from '../WarningCard'\n\nconst INPUT = 0\nconst OUTPUT = 1\n\nconst ETH_TO_TOKEN = 0\nconst TOKEN_TO_ETH = 1\nconst TOKEN_TO_TOKEN = 2\n\n// denominated in bips\nconst ALLOWED_SLIPPAGE_DEFAULT = 50\nconst TOKEN_ALLOWED_SLIPPAGE_DEFAULT = 50\n\n// 15 minutes, denominated in seconds\nconst DEFAULT_DEADLINE_FROM_NOW = 60 * 15\n\n// % above the calculated gas cost that we actually send, denominated in bips\nconst GAS_MARGIN = ethers.utils.bigNumberify(1000)\n\nconst DownArrowBackground = styled.div`\n  ${({ theme }) => theme.flexRowNoWrap}\n  justify-content: center;\n  align-items: center;\n`\n\nconst WrappedArrowDown = ({ clickable, active, ...rest }) => <ArrowDown {...rest} />\nconst DownArrow = styled(WrappedArrowDown)`\n  color: ${({ theme, active }) => (active ? theme.royalBlue : theme.chaliceGray)};\n  width: 0.625rem;\n  height: 0.625rem;\n  position: relative;\n  padding: 0.875rem;\n  cursor: ${({ clickable }) => clickable && 'pointer'};\n`\n\nconst ExchangeRateWrapper = styled.div`\n  ${({ theme }) => theme.flexRowNoWrap};\n  align-items: center;\n  color: ${({ theme }) => theme.doveGray};\n  font-size: 0.75rem;\n  padding: 0.5rem 1rem;\n`\n\nconst ExchangeRate = styled.span`\n  flex: 1 1 auto;\n  width: 0;\n  color: ${({ theme }) => theme.doveGray};\n`\n\nconst Flex = styled.div`\n  display: flex;\n  justify-content: center;\n  padding: 2rem;\n\n  button {\n    max-width: 20rem;\n  }\n`\n\nfunction calculateSlippageBounds(value, token = false, tokenAllowedSlippage, allowedSlippage) {\n  if (value) {\n    const offset = value.mul(token ? tokenAllowedSlippage : allowedSlippage).div(ethers.utils.bigNumberify(10000))\n    const minimum = value.sub(offset)\n    const maximum = value.add(offset)\n    return {\n      minimum: minimum.lt(ethers.constants.Zero) ? ethers.constants.Zero : minimum,\n      maximum: maximum.gt(ethers.constants.MaxUint256) ? ethers.constants.MaxUint256 : maximum\n    }\n  } else {\n    return {}\n  }\n}\n\nfunction getSwapType(inputCurrency, outputCurrency) {\n  if (!inputCurrency || !outputCurrency) {\n    return null\n  } else if (inputCurrency === 'ETH') {\n    return ETH_TO_TOKEN\n  } else if (outputCurrency === 'ETH') {\n    return TOKEN_TO_ETH\n  } else {\n    return TOKEN_TO_TOKEN\n  }\n}\n\n// this mocks the getInputPrice function, and calculates the required output\nfunction calculateEtherTokenOutputFromInput(inputAmount, inputReserve, outputReserve) {\n  const inputAmountWithFee = inputAmount.mul(ethers.utils.bigNumberify(997))\n  const numerator = inputAmountWithFee.mul(outputReserve)\n  const denominator = inputReserve.mul(ethers.utils.bigNumberify(1000)).add(inputAmountWithFee)\n  return numerator.div(denominator)\n}\n\n// this mocks the getOutputPrice function, and calculates the required input\nfunction calculateEtherTokenInputFromOutput(outputAmount, inputReserve, outputReserve) {\n  const numerator = inputReserve.mul(outputAmount).mul(ethers.utils.bigNumberify(1000))\n  const denominator = outputReserve.sub(outputAmount).mul(ethers.utils.bigNumberify(997))\n  return numerator.div(denominator).add(ethers.constants.One)\n}\n\nfunction getInitialSwapState(state) {\n  return {\n    independentValue: state.exactFieldURL && state.exactAmountURL ? state.exactAmountURL : '', // this is a user input\n    dependentValue: '', // this is a calculated number\n    independentField: state.exactFieldURL === 'output' ? OUTPUT : INPUT,\n    inputCurrency: state.inputCurrencyURL ? state.inputCurrencyURL : 'ETH',\n    outputCurrency: state.outputCurrencyURL\n      ? state.outputCurrencyURL === 'ETH'\n        ? state.inputCurrencyURL && state.inputCurrencyURL !== 'ETH'\n          ? 'ETH'\n          : ''\n        : state.outputCurrencyURL\n      : state.initialCurrency\n      ? state.initialCurrency\n      : ''\n  }\n}\n\nfunction swapStateReducer(state, action) {\n  switch (action.type) {\n    case 'FLIP_INDEPENDENT': {\n      const { independentField, inputCurrency, outputCurrency } = state\n      return {\n        ...state,\n        dependentValue: '',\n        independentField: independentField === INPUT ? OUTPUT : INPUT,\n        inputCurrency: outputCurrency,\n        outputCurrency: inputCurrency\n      }\n    }\n    case 'SELECT_CURRENCY': {\n      const { inputCurrency, outputCurrency } = state\n      const { field, currency } = action.payload\n\n      const newInputCurrency = field === INPUT ? currency : inputCurrency\n      const newOutputCurrency = field === OUTPUT ? currency : outputCurrency\n\n      if (newInputCurrency === newOutputCurrency) {\n        return {\n          ...state,\n          inputCurrency: field === INPUT ? currency : '',\n          outputCurrency: field === OUTPUT ? currency : ''\n        }\n      } else {\n        return {\n          ...state,\n          inputCurrency: newInputCurrency,\n          outputCurrency: newOutputCurrency\n        }\n      }\n    }\n    case 'UPDATE_INDEPENDENT': {\n      const { field, value } = action.payload\n      const { dependentValue, independentValue } = state\n      return {\n        ...state,\n        independentValue: value,\n        dependentValue: value === independentValue ? dependentValue : '',\n        independentField: field\n      }\n    }\n    case 'UPDATE_DEPENDENT': {\n      return {\n        ...state,\n        dependentValue: action.payload\n      }\n    }\n    default: {\n      return getInitialSwapState()\n    }\n  }\n}\n\nfunction getExchangeRate(inputValue, inputDecimals, outputValue, outputDecimals, invert = false) {\n  try {\n    if (\n      inputValue &&\n      (inputDecimals || inputDecimals === 0) &&\n      outputValue &&\n      (outputDecimals || outputDecimals === 0)\n    ) {\n      const factor = ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))\n\n      if (invert) {\n        return inputValue\n          .mul(factor)\n          .mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals)))\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals)))\n          .div(outputValue)\n      } else {\n        return outputValue\n          .mul(factor)\n          .mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals)))\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals)))\n          .div(inputValue)\n      }\n    }\n  } catch {}\n}\n\nfunction getMarketRate(\n  swapType,\n  inputReserveETH,\n  inputReserveToken,\n  inputDecimals,\n  outputReserveETH,\n  outputReserveToken,\n  outputDecimals,\n  invert = false\n) {\n  if (swapType === ETH_TO_TOKEN) {\n    return getExchangeRate(outputReserveETH, 18, outputReserveToken, outputDecimals, invert)\n  } else if (swapType === TOKEN_TO_ETH) {\n    return getExchangeRate(inputReserveToken, inputDecimals, inputReserveETH, 18, invert)\n  } else if (swapType === TOKEN_TO_TOKEN) {\n    const factor = ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))\n    const firstRate = getExchangeRate(inputReserveToken, inputDecimals, inputReserveETH, 18)\n    const secondRate = getExchangeRate(outputReserveETH, 18, outputReserveToken, outputDecimals)\n    try {\n      return !!(firstRate && secondRate) ? firstRate.mul(secondRate).div(factor) : undefined\n    } catch {}\n  }\n}\n\nexport default function ExchangePage({ initialCurrency, sending = false, params }) {\n  const { t } = useTranslation()\n  const { account, chainId, error } = useWeb3React()\n\n  const urlAddedTokens = {}\n  if (params.inputCurrency) {\n    urlAddedTokens[params.inputCurrency] = true\n  }\n  if (params.outputCurrency) {\n    urlAddedTokens[params.outputCurrency] = true\n  }\n  if (isAddress(initialCurrency)) {\n    urlAddedTokens[initialCurrency] = true\n  }\n\n  // BigNumber.js instance\n  const ethPrice = useETHPriceInUSD()\n\n  const addTransaction = useTransactionAdder()\n\n  // check if URL specifies valid slippage, if so use as default\n  const initialSlippage = (token = false) => {\n    let slippage = Number.parseInt(params.slippage)\n    if (!isNaN(slippage) && (slippage === 0 || slippage >= 1)) {\n      return slippage // round to match custom input availability\n    }\n    // check for token <-> token slippage option\n    return token ? TOKEN_ALLOWED_SLIPPAGE_DEFAULT : ALLOWED_SLIPPAGE_DEFAULT\n  }\n\n  // check URL params for recipient, only on send page\n  const initialRecipient = () => {\n    if (sending && params.recipient) {\n      return params.recipient\n    }\n    return ''\n  }\n\n  const [brokenTokenWarning, setBrokenTokenWarning] = useState()\n\n  const [deadlineFromNow, setDeadlineFromNow] = useState(DEFAULT_DEADLINE_FROM_NOW)\n\n  const [rawSlippage, setRawSlippage] = useState(() => initialSlippage())\n  const [rawTokenSlippage, setRawTokenSlippage] = useState(() => initialSlippage(true))\n\n  const allowedSlippageBig = ethers.utils.bigNumberify(rawSlippage)\n  const tokenAllowedSlippageBig = ethers.utils.bigNumberify(rawTokenSlippage)\n\n  // analytics\n  useEffect(() => {\n    ReactGA.pageview(window.location.pathname + window.location.search)\n  }, [])\n\n  // core swap state\n  const [swapState, dispatchSwapState] = useReducer(\n    swapStateReducer,\n    {\n      initialCurrency: initialCurrency,\n      inputCurrencyURL: params.inputCurrency,\n      outputCurrencyURL: params.outputCurrency,\n      exactFieldURL: params.exactField,\n      exactAmountURL: params.exactAmount\n    },\n    getInitialSwapState\n  )\n\n  const { independentValue, dependentValue, independentField, inputCurrency, outputCurrency } = swapState\n\n  useEffect(() => {\n    setBrokenTokenWarning(false)\n    for (let i = 0; i < brokenTokens.length; i++) {\n      if (\n        brokenTokens[i].toLowerCase() === outputCurrency.toLowerCase() ||\n        brokenTokens[i].toLowerCase() === inputCurrency.toLowerCase()\n      ) {\n        setBrokenTokenWarning(true)\n      }\n    }\n  }, [outputCurrency, inputCurrency])\n\n  const [recipient, setRecipient] = useState({\n    address: initialRecipient(),\n    name: ''\n  })\n  const [recipientError, setRecipientError] = useState()\n\n  // get swap type from the currency types\n  const swapType = getSwapType(inputCurrency, outputCurrency)\n\n  // get decimals and exchange address for each of the currency types\n  const { symbol: inputSymbol, decimals: inputDecimals, exchangeAddress: inputExchangeAddress } = useTokenDetails(\n    inputCurrency\n  )\n  const { symbol: outputSymbol, decimals: outputDecimals, exchangeAddress: outputExchangeAddress } = useTokenDetails(\n    outputCurrency\n  )\n\n  const inputExchangeContract = useExchangeContract(inputExchangeAddress)\n  const outputExchangeContract = useExchangeContract(outputExchangeAddress)\n  const contract = swapType === ETH_TO_TOKEN ? outputExchangeContract : inputExchangeContract\n\n  // get input allowance\n  const inputAllowance = useAddressAllowance(account, inputCurrency, inputExchangeAddress)\n\n  // fetch reserves for each of the currency types\n  const { reserveETH: inputReserveETH, reserveToken: inputReserveToken } = useExchangeReserves(inputCurrency)\n  const { reserveETH: outputReserveETH, reserveToken: outputReserveToken } = useExchangeReserves(outputCurrency)\n\n  // get balances for each of the currency types\n  const inputBalance = useAddressBalance(account, inputCurrency)\n  const outputBalance = useAddressBalance(account, outputCurrency)\n  const inputBalanceFormatted = !!(inputBalance && Number.isInteger(inputDecimals))\n    ? amountFormatter(inputBalance, inputDecimals, Math.min(4, inputDecimals))\n    : ''\n  const outputBalanceFormatted = !!(outputBalance && Number.isInteger(outputDecimals))\n    ? amountFormatter(outputBalance, outputDecimals, Math.min(4, outputDecimals))\n    : ''\n\n  // compute useful transforms of the data above\n  const independentDecimals = independentField === INPUT ? inputDecimals : outputDecimals\n  const dependentDecimals = independentField === OUTPUT ? inputDecimals : outputDecimals\n\n  // declare/get parsed and formatted versions of input/output values\n  const [independentValueParsed, setIndependentValueParsed] = useState()\n  const dependentValueFormatted = !!(dependentValue && (dependentDecimals || dependentDecimals === 0))\n    ? amountFormatter(dependentValue, dependentDecimals, Math.min(4, dependentDecimals), false)\n    : ''\n  const inputValueParsed = independentField === INPUT ? independentValueParsed : dependentValue\n  const inputValueFormatted = independentField === INPUT ? independentValue : dependentValueFormatted\n  const outputValueParsed = independentField === OUTPUT ? independentValueParsed : dependentValue\n  const outputValueFormatted = independentField === OUTPUT ? independentValue : dependentValueFormatted\n\n  // validate + parse independent value\n  const [independentError, setIndependentError] = useState()\n  useEffect(() => {\n    if (independentValue && (independentDecimals || independentDecimals === 0)) {\n      try {\n        const parsedValue = ethers.utils.parseUnits(independentValue, independentDecimals)\n\n        if (parsedValue.lte(ethers.constants.Zero) || parsedValue.gte(ethers.constants.MaxUint256)) {\n          throw Error()\n        } else {\n          setIndependentValueParsed(parsedValue)\n          setIndependentError(null)\n        }\n      } catch {\n        setIndependentError(t('inputNotValid'))\n      }\n\n      return () => {\n        setIndependentValueParsed()\n        setIndependentError()\n      }\n    }\n  }, [independentValue, independentDecimals, t])\n\n  // calculate slippage from target rate\n  const { minimum: dependentValueMinumum, maximum: dependentValueMaximum } = calculateSlippageBounds(\n    dependentValue,\n    swapType === TOKEN_TO_TOKEN,\n    tokenAllowedSlippageBig,\n    allowedSlippageBig\n  )\n\n  // validate input allowance + balance\n  const [inputError, setInputError] = useState()\n  const [showUnlock, setShowUnlock] = useState(false)\n  useEffect(() => {\n    const inputValueCalculation = independentField === INPUT ? independentValueParsed : dependentValueMaximum\n    if (inputBalance && (inputAllowance || inputCurrency === 'ETH') && inputValueCalculation) {\n      if (inputBalance.lt(inputValueCalculation)) {\n        setInputError(t('insufficientBalance'))\n      } else if (inputCurrency !== 'ETH' && inputAllowance.lt(inputValueCalculation)) {\n        setInputError(t('unlockTokenCont'))\n        setShowUnlock(true)\n      } else {\n        setInputError(null)\n        setShowUnlock(false)\n      }\n      return () => {\n        setInputError()\n        setShowUnlock(false)\n      }\n    }\n  }, [independentField, independentValueParsed, dependentValueMaximum, inputBalance, inputCurrency, inputAllowance, t])\n\n  // calculate dependent value\n  useEffect(() => {\n    const amount = independentValueParsed\n\n    if (swapType === ETH_TO_TOKEN) {\n      const reserveETH = outputReserveETH\n      const reserveToken = outputReserveToken\n\n      if (amount && reserveETH && reserveToken) {\n        try {\n          const calculatedDependentValue =\n            independentField === INPUT\n              ? calculateEtherTokenOutputFromInput(amount, reserveETH, reserveToken)\n              : calculateEtherTokenInputFromOutput(amount, reserveETH, reserveToken)\n\n          if (calculatedDependentValue.lte(ethers.constants.Zero)) {\n            throw Error()\n          }\n\n          dispatchSwapState({\n            type: 'UPDATE_DEPENDENT',\n            payload: calculatedDependentValue\n          })\n        } catch {\n          setIndependentError(t('insufficientLiquidity'))\n        }\n        return () => {\n          dispatchSwapState({ type: 'UPDATE_DEPENDENT', payload: '' })\n        }\n      }\n    } else if (swapType === TOKEN_TO_ETH) {\n      const reserveETH = inputReserveETH\n      const reserveToken = inputReserveToken\n\n      if (amount && reserveETH && reserveToken) {\n        try {\n          const calculatedDependentValue =\n            independentField === INPUT\n              ? calculateEtherTokenOutputFromInput(amount, reserveToken, reserveETH)\n              : calculateEtherTokenInputFromOutput(amount, reserveToken, reserveETH)\n\n          if (calculatedDependentValue.lte(ethers.constants.Zero)) {\n            throw Error()\n          }\n\n          dispatchSwapState({\n            type: 'UPDATE_DEPENDENT',\n            payload: calculatedDependentValue\n          })\n        } catch {\n          setIndependentError(t('insufficientLiquidity'))\n        }\n        return () => {\n          dispatchSwapState({ type: 'UPDATE_DEPENDENT', payload: '' })\n        }\n      }\n    } else if (swapType === TOKEN_TO_TOKEN) {\n      const reserveETHFirst = inputReserveETH\n      const reserveTokenFirst = inputReserveToken\n\n      const reserveETHSecond = outputReserveETH\n      const reserveTokenSecond = outputReserveToken\n\n      if (amount && reserveETHFirst && reserveTokenFirst && reserveETHSecond && reserveTokenSecond) {\n        try {\n          if (independentField === INPUT) {\n            const intermediateValue = calculateEtherTokenOutputFromInput(amount, reserveTokenFirst, reserveETHFirst)\n            if (intermediateValue.lte(ethers.constants.Zero)) {\n              throw Error()\n            }\n            const calculatedDependentValue = calculateEtherTokenOutputFromInput(\n              intermediateValue,\n              reserveETHSecond,\n              reserveTokenSecond\n            )\n            if (calculatedDependentValue.lte(ethers.constants.Zero)) {\n              throw Error()\n            }\n            dispatchSwapState({\n              type: 'UPDATE_DEPENDENT',\n              payload: calculatedDependentValue\n            })\n          } else {\n            const intermediateValue = calculateEtherTokenInputFromOutput(amount, reserveETHSecond, reserveTokenSecond)\n            if (intermediateValue.lte(ethers.constants.Zero)) {\n              throw Error()\n            }\n            const calculatedDependentValue = calculateEtherTokenInputFromOutput(\n              intermediateValue,\n              reserveTokenFirst,\n              reserveETHFirst\n            )\n            if (calculatedDependentValue.lte(ethers.constants.Zero)) {\n              throw Error()\n            }\n            dispatchSwapState({\n              type: 'UPDATE_DEPENDENT',\n              payload: calculatedDependentValue\n            })\n          }\n        } catch {\n          setIndependentError(t('insufficientLiquidity'))\n        }\n        return () => {\n          dispatchSwapState({ type: 'UPDATE_DEPENDENT', payload: '' })\n        }\n      }\n    }\n  }, [\n    independentValueParsed,\n    swapType,\n    outputReserveETH,\n    outputReserveToken,\n    inputReserveETH,\n    inputReserveToken,\n    independentField,\n    t\n  ])\n\n  useEffect(() => {\n    const history = createBrowserHistory()\n    history.push(window.location.pathname + '')\n  }, [])\n\n  const [inverted, setInverted] = useState(false)\n  const exchangeRate = getExchangeRate(inputValueParsed, inputDecimals, outputValueParsed, outputDecimals)\n  const exchangeRateInverted = getExchangeRate(inputValueParsed, inputDecimals, outputValueParsed, outputDecimals, true)\n\n  const marketRate = getMarketRate(\n    swapType,\n    inputReserveETH,\n    inputReserveToken,\n    inputDecimals,\n    outputReserveETH,\n    outputReserveToken,\n    outputDecimals\n  )\n\n  const percentSlippage =\n    exchangeRate && marketRate && !marketRate.isZero()\n      ? exchangeRate\n          .sub(marketRate)\n          .abs()\n          .mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n          .div(marketRate)\n          .sub(ethers.utils.bigNumberify(3).mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(15))))\n      : undefined\n  const percentSlippageFormatted = percentSlippage && amountFormatter(percentSlippage, 16, 2)\n  const slippageWarning =\n    percentSlippage &&\n    percentSlippage.gte(ethers.utils.parseEther('.05')) &&\n    percentSlippage.lt(ethers.utils.parseEther('.2')) // [5% - 20%)\n  const highSlippageWarning = percentSlippage && percentSlippage.gte(ethers.utils.parseEther('.2')) // [20+%\n\n  const isValid = sending\n    ? exchangeRate && inputError === null && independentError === null && recipientError === null && deadlineFromNow\n    : exchangeRate && inputError === null && independentError === null && deadlineFromNow\n\n  const estimatedText = `(${t('estimated')})`\n  function formatBalance(value) {\n    return `Balance: ${value}`\n  }\n\n  async function onSwap() {\n    //if user changed deadline, log new one in minutes\n    if (deadlineFromNow !== DEFAULT_DEADLINE_FROM_NOW) {\n      ReactGA.event({\n        category: 'Advanced Interaction',\n        action: 'Set Custom Deadline',\n        value: deadlineFromNow / 60\n      })\n    }\n\n    const deadline = Math.ceil(Date.now() / 1000) + deadlineFromNow\n\n    // if user has changed slippage, log\n    if (swapType === TOKEN_TO_TOKEN) {\n      if (parseInt(tokenAllowedSlippageBig.toString()) !== TOKEN_ALLOWED_SLIPPAGE_DEFAULT) {\n        ReactGA.event({\n          category: 'Advanced Interaction',\n          action: 'Set Custom Slippage',\n          value: parseInt(tokenAllowedSlippageBig.toString())\n        })\n      }\n    } else {\n      if (parseInt(allowedSlippageBig.toString()) !== ALLOWED_SLIPPAGE_DEFAULT) {\n        ReactGA.event({\n          category: 'Advanced Interaction',\n          action: 'Set Custom Slippage',\n          value: parseInt(allowedSlippageBig.toString())\n        })\n      }\n    }\n\n    let estimate, method, args, value\n\n    let inputEthPerToken = 1\n    if (inputCurrency !== 'ETH') {\n      inputEthPerToken = inputReserveToken && inputReserveETH ? inputReserveETH / inputReserveToken : null\n    }\n    let usdTransactionSize = ethPrice * inputEthPerToken * inputValueFormatted\n\n    if (independentField === INPUT) {\n      // general details about transaction\n      ReactGA.event({\n        category: 'Transaction',\n        action: sending ? 'SendInput' : 'SwapInput',\n        label: outputCurrency,\n        value: usdTransactionSize\n      })\n\n      if (swapType === ETH_TO_TOKEN) {\n        estimate = sending ? contract.estimate.ethToTokenTransferInput : contract.estimate.ethToTokenSwapInput\n        method = sending ? contract.ethToTokenTransferInput : contract.ethToTokenSwapInput\n        args = sending ? [dependentValueMinumum, deadline, recipient.address] : [dependentValueMinumum, deadline]\n        value = independentValueParsed\n      } else if (swapType === TOKEN_TO_ETH) {\n        estimate = sending ? contract.estimate.tokenToEthTransferInput : contract.estimate.tokenToEthSwapInput\n        method = sending ? contract.tokenToEthTransferInput : contract.tokenToEthSwapInput\n        args = sending\n          ? [independentValueParsed, dependentValueMinumum, deadline, recipient.address]\n          : [independentValueParsed, dependentValueMinumum, deadline]\n        value = ethers.constants.Zero\n      } else if (swapType === TOKEN_TO_TOKEN) {\n        estimate = sending ? contract.estimate.tokenToTokenTransferInput : contract.estimate.tokenToTokenSwapInput\n        method = sending ? contract.tokenToTokenTransferInput : contract.tokenToTokenSwapInput\n        args = sending\n          ? [\n              independentValueParsed,\n              dependentValueMinumum,\n              ethers.constants.One,\n              deadline,\n              recipient.address,\n              outputCurrency\n            ]\n          : [independentValueParsed, dependentValueMinumum, ethers.constants.One, deadline, outputCurrency]\n        value = ethers.constants.Zero\n      }\n    } else if (independentField === OUTPUT) {\n      // general details about transaction\n      ReactGA.event({\n        category: 'Transaction',\n        action: sending ? 'SendOutput' : 'SwapOutput',\n        label: outputCurrency,\n        value: usdTransactionSize\n      })\n\n      if (swapType === ETH_TO_TOKEN) {\n        estimate = sending ? contract.estimate.ethToTokenTransferOutput : contract.estimate.ethToTokenSwapOutput\n        method = sending ? contract.ethToTokenTransferOutput : contract.ethToTokenSwapOutput\n        args = sending ? [independentValueParsed, deadline, recipient.address] : [independentValueParsed, deadline]\n        value = dependentValueMaximum\n      } else if (swapType === TOKEN_TO_ETH) {\n        estimate = sending ? contract.estimate.tokenToEthTransferOutput : contract.estimate.tokenToEthSwapOutput\n        method = sending ? contract.tokenToEthTransferOutput : contract.tokenToEthSwapOutput\n        args = sending\n          ? [independentValueParsed, dependentValueMaximum, deadline, recipient.address]\n          : [independentValueParsed, dependentValueMaximum, deadline]\n        value = ethers.constants.Zero\n      } else if (swapType === TOKEN_TO_TOKEN) {\n        estimate = sending ? contract.estimate.tokenToTokenTransferOutput : contract.estimate.tokenToTokenSwapOutput\n        method = sending ? contract.tokenToTokenTransferOutput : contract.tokenToTokenSwapOutput\n        args = sending\n          ? [\n              independentValueParsed,\n              dependentValueMaximum,\n              ethers.constants.MaxUint256,\n              deadline,\n              recipient.address,\n              outputCurrency\n            ]\n          : [independentValueParsed, dependentValueMaximum, ethers.constants.MaxUint256, deadline, outputCurrency]\n        value = ethers.constants.Zero\n      }\n    }\n\n    const estimatedGasLimit = await estimate(...args, { value })\n    method(...args, {\n      value,\n      gasLimit: calculateGasMargin(estimatedGasLimit, GAS_MARGIN)\n    }).then(response => {\n      addTransaction(response)\n    })\n  }\n\n  const [customSlippageError, setcustomSlippageError] = useState('')\n\n  const toggleWalletModal = useWalletModalToggle()\n\n  const newInputDetected =\n    inputCurrency !== 'ETH' && inputCurrency && !INITIAL_TOKENS_CONTEXT[chainId].hasOwnProperty(inputCurrency)\n\n  const newOutputDetected =\n    outputCurrency !== 'ETH' && outputCurrency && !INITIAL_TOKENS_CONTEXT[chainId].hasOwnProperty(outputCurrency)\n\n  const [showInputWarning, setShowInputWarning] = useState(false)\n  const [showOutputWarning, setShowOutputWarning] = useState(false)\n\n  useEffect(() => {\n    if (newInputDetected) {\n      setShowInputWarning(true)\n    } else {\n      setShowInputWarning(false)\n    }\n  }, [newInputDetected, setShowInputWarning])\n\n  useEffect(() => {\n    if (newOutputDetected) {\n      setShowOutputWarning(true)\n    } else {\n      setShowOutputWarning(false)\n    }\n  }, [newOutputDetected, setShowOutputWarning])\n\n  return (\n    <>\n      {showInputWarning && (\n        <WarningCard\n          onDismiss={() => {\n            setShowInputWarning(false)\n          }}\n          urlAddedTokens={urlAddedTokens}\n          currency={inputCurrency}\n        />\n      )}\n      {showOutputWarning && (\n        <WarningCard\n          onDismiss={() => {\n            setShowOutputWarning(false)\n          }}\n          urlAddedTokens={urlAddedTokens}\n          currency={outputCurrency}\n        />\n      )}\n      <CurrencyInputPanel\n        title={t('input')}\n        urlAddedTokens={urlAddedTokens}\n        description={inputValueFormatted && independentField === OUTPUT ? estimatedText : ''}\n        extraText={inputBalanceFormatted && formatBalance(inputBalanceFormatted)}\n        extraTextClickHander={() => {\n          if (inputBalance && inputDecimals) {\n            const valueToSet = inputCurrency === 'ETH' ? inputBalance.sub(ethers.utils.parseEther('.1')) : inputBalance\n            if (valueToSet.gt(ethers.constants.Zero)) {\n              dispatchSwapState({\n                type: 'UPDATE_INDEPENDENT',\n                payload: {\n                  value: amountFormatter(valueToSet, inputDecimals, inputDecimals, false),\n                  field: INPUT\n                }\n              })\n            }\n          }\n        }}\n        onCurrencySelected={inputCurrency => {\n          dispatchSwapState({\n            type: 'SELECT_CURRENCY',\n            payload: { currency: inputCurrency, field: INPUT }\n          })\n        }}\n        onValueChange={inputValue => {\n          dispatchSwapState({\n            type: 'UPDATE_INDEPENDENT',\n            payload: { value: inputValue, field: INPUT }\n          })\n        }}\n        showUnlock={showUnlock}\n        selectedTokens={[inputCurrency, outputCurrency]}\n        selectedTokenAddress={inputCurrency}\n        value={inputValueFormatted}\n        errorMessage={inputError ? inputError : independentField === INPUT ? independentError : ''}\n      />\n      <OversizedPanel>\n        <DownArrowBackground>\n          <DownArrow\n            onClick={() => {\n              dispatchSwapState({ type: 'FLIP_INDEPENDENT' })\n            }}\n            clickable\n            alt=\"swap\"\n            active={isValid}\n          />\n        </DownArrowBackground>\n      </OversizedPanel>\n      <CurrencyInputPanel\n        title={t('output')}\n        description={outputValueFormatted && independentField === INPUT ? estimatedText : ''}\n        extraText={outputBalanceFormatted && formatBalance(outputBalanceFormatted)}\n        urlAddedTokens={urlAddedTokens}\n        onCurrencySelected={outputCurrency => {\n          dispatchSwapState({\n            type: 'SELECT_CURRENCY',\n            payload: { currency: outputCurrency, field: OUTPUT }\n          })\n        }}\n        onValueChange={outputValue => {\n          dispatchSwapState({\n            type: 'UPDATE_INDEPENDENT',\n            payload: { value: outputValue, field: OUTPUT }\n          })\n        }}\n        selectedTokens={[inputCurrency, outputCurrency]}\n        selectedTokenAddress={outputCurrency}\n        value={outputValueFormatted}\n        errorMessage={independentField === OUTPUT ? independentError : ''}\n        disableUnlock\n      />\n      {sending ? (\n        <>\n          <OversizedPanel>\n            <DownArrowBackground>\n              <DownArrow active={isValid} alt=\"arrow\" />\n            </DownArrowBackground>\n          </OversizedPanel>\n          <AddressInputPanel onChange={setRecipient} onError={setRecipientError} initialInput={recipient} />\n        </>\n      ) : (\n        ''\n      )}\n      <OversizedPanel hideBottom>\n        <ExchangeRateWrapper\n          onClick={() => {\n            setInverted(inverted => !inverted)\n          }}\n        >\n          <ExchangeRate>{t('exchangeRate')}</ExchangeRate>\n          {inverted ? (\n            <span>\n              {exchangeRate\n                ? `1 ${inputSymbol} = ${amountFormatter(exchangeRate, 18, 6, false)} ${outputSymbol}`\n                : ' - '}\n            </span>\n          ) : (\n            <span>\n              {exchangeRate\n                ? `1 ${outputSymbol} = ${amountFormatter(exchangeRateInverted, 18, 6, false)} ${inputSymbol}`\n                : ' - '}\n            </span>\n          )}\n        </ExchangeRateWrapper>\n      </OversizedPanel>\n      <TransactionDetails\n        account={account}\n        setRawSlippage={setRawSlippage}\n        setRawTokenSlippage={setRawTokenSlippage}\n        rawSlippage={rawSlippage}\n        slippageWarning={slippageWarning}\n        highSlippageWarning={highSlippageWarning}\n        brokenTokenWarning={brokenTokenWarning}\n        setDeadline={setDeadlineFromNow}\n        deadline={deadlineFromNow}\n        inputError={inputError}\n        independentError={independentError}\n        inputCurrency={inputCurrency}\n        outputCurrency={outputCurrency}\n        independentValue={independentValue}\n        independentValueParsed={independentValueParsed}\n        independentField={independentField}\n        INPUT={INPUT}\n        inputValueParsed={inputValueParsed}\n        outputValueParsed={outputValueParsed}\n        inputSymbol={inputSymbol}\n        outputSymbol={outputSymbol}\n        dependentValueMinumum={dependentValueMinumum}\n        dependentValueMaximum={dependentValueMaximum}\n        dependentDecimals={dependentDecimals}\n        independentDecimals={independentDecimals}\n        percentSlippageFormatted={percentSlippageFormatted}\n        setcustomSlippageError={setcustomSlippageError}\n        recipientAddress={recipient.address}\n        sending={sending}\n      />\n      <Flex>\n        <Button\n          disabled={\n            brokenTokenWarning ? true : !account && !error ? false : !isValid || customSlippageError === 'invalid'\n          }\n          onClick={account && !error ? onSwap : toggleWalletModal}\n          warning={highSlippageWarning || customSlippageError === 'warning'}\n          loggedOut={!account}\n        >\n          {brokenTokenWarning\n            ? 'Swap'\n            : !account\n            ? 'Connect to a Wallet'\n            : sending\n            ? highSlippageWarning || customSlippageError === 'warning'\n              ? t('sendAnyway')\n              : t('send')\n            : highSlippageWarning || customSlippageError === 'warning'\n            ? t('swapAnyway')\n            : t('swap')}\n        </Button>\n      </Flex>\n    </>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}