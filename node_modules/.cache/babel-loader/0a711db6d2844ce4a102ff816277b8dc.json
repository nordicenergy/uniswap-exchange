{"ast":null,"code":"import _regeneratorRuntime from\"/workspace/uniswap-exchange/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/workspace/uniswap-exchange/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/workspace/uniswap-exchange/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"/workspace/uniswap-exchange/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/workspace/uniswap-exchange/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{createContext,useContext,useReducer,useMemo,useCallback,useEffect,useRef,useState}from\"react\";import{BigNumber}from\"@uniswap/sdk\";import{useWeb3React}from\"../hooks\";import{safeAccess,isAddress,getEtherBalance,getTokenBalance}from\"../utils\";import{useBlockNumber}from\"./Application\";import{useTokenDetails,useAllTokenDetails}from\"./Tokens\";import{getUSDPrice}from\"../utils/price\";var UPDATE=\"UPDATE\";var UPDATE_ALL_FOR_ACCOUNT=\"UPDATE_ALL_FOR_ACCOUNT\";var UPDATE_ALL_FOR_EXCHANGES=\"UPDATE_ALL_FOR_EXCHANGES\";var BalancesContext=createContext();function useBalancesContext(){return useContext(BalancesContext);}function reducer(state,_ref){var type=_ref.type,payload=_ref.payload;switch(type){case UPDATE:{var networkId=payload.networkId,address=payload.address,tokenAddress=payload.tokenAddress,value=payload.value,blockNumber=payload.blockNumber;return _objectSpread({},state,_defineProperty({},networkId,_objectSpread({},safeAccess(state,[networkId])||{},_defineProperty({},address,_objectSpread({},safeAccess(state,[networkId,address])||{},_defineProperty({},tokenAddress,{value:value,blockNumber:blockNumber}))))));}case UPDATE_ALL_FOR_ACCOUNT:{var _networkId=payload.networkId,_address=payload.address,tokenAddresses=payload.tokenAddresses,values=payload.values;return _objectSpread({},state,_defineProperty({},_networkId,_objectSpread({},safeAccess(state,[_networkId])||{},_defineProperty({},_address,_objectSpread({},tokenAddresses.reduce(function(accumulator,currentValue,i){accumulator[currentValue]={value:values[i]};return accumulator;},{}),{},safeAccess(state,[_networkId,_address])||{})))));}case UPDATE_ALL_FOR_EXCHANGES:{var _networkId2=payload.networkId,exchangeAddresses=payload.exchangeAddresses,_tokenAddresses=payload.tokenAddresses,_values=payload.values;return _objectSpread({},state,_defineProperty({},_networkId2,_objectSpread({},safeAccess(state,[_networkId2])||{},{},exchangeAddresses.reduce(function(accumulator,currentValue,i){accumulator[currentValue]=_objectSpread({},safeAccess(state,[_networkId2,currentValue]),_defineProperty({},_tokenAddresses[i],{value:_values[i]}));return accumulator;},{}))));}default:{throw Error(\"Unexpected action type in BalancesContext reducer: '\".concat(type,\"'.\"));}}}export default function Provider(_ref2){var children=_ref2.children;var _useReducer=useReducer(reducer,{}),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var update=useCallback(function(networkId,address,tokenAddress,value,blockNumber){dispatch({type:UPDATE,payload:{networkId:networkId,address:address,tokenAddress:tokenAddress,value:value,blockNumber:blockNumber}});},[]);var updateAllForAccount=useCallback(function(networkId,address,tokenAddresses,values){dispatch({type:UPDATE_ALL_FOR_ACCOUNT,payload:{networkId:networkId,address:address,tokenAddresses:tokenAddresses,values:values}});},[]);var updateAllForExchanges=useCallback(function(networkId,exchangeAddresses,tokenAddresses,values){dispatch({type:UPDATE_ALL_FOR_EXCHANGES,payload:{networkId:networkId,exchangeAddresses:exchangeAddresses,tokenAddresses:tokenAddresses,values:values}});},[]);return React.createElement(BalancesContext.Provider,{value:useMemo(function(){return[state,{update:update,updateAllForAccount:updateAllForAccount,updateAllForExchanges:updateAllForExchanges}];},[state,update,updateAllForAccount,updateAllForExchanges])},children);}var STAGGER_TIME=2500;export function Updater(){var _useWeb3React=useWeb3React(),library=_useWeb3React.library,chainId=_useWeb3React.chainId,account=_useWeb3React.account;var allTokens=useAllTokenDetails();var _useBalancesContext=useBalancesContext(),_useBalancesContext2=_slicedToArray(_useBalancesContext,2),state=_useBalancesContext2[0],_useBalancesContext2$=_useBalancesContext2[1],updateAllForAccount=_useBalancesContext2$.updateAllForAccount,updateAllForExchanges=_useBalancesContext2$.updateAllForExchanges;var stateRef=useRef(state);stateRef.current=state;useEffect(function(){var getData=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var allTokensWithAnExchange;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(chainId&&library&&account){// get 1 eth + all token balances for the account\nPromise.all(Object.keys(allTokens).map(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(tokenAddress){var _ref5,existingValue;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return new Promise(function(resolve){return setTimeout(resolve,STAGGER_TIME*Math.random());});case 2:_ref5=safeAccess(stateRef.current,[chainId,account,tokenAddress])||{},existingValue=_ref5.value;_context.t0=existingValue;if(_context.t0){_context.next=8;break;}_context.next=7;return tokenAddress===\"ETH\"?getEtherBalance(account,library).catch(function(){return null;}):getTokenBalance(tokenAddress,account,library).catch(function(){return null;});case 7:_context.t0=_context.sent;case 8:return _context.abrupt(\"return\",_context.t0);case 9:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref4.apply(this,arguments);};}())).then(function(balances){updateAllForAccount(chainId,account,Object.keys(allTokens),balances);});allTokensWithAnExchange=Object.keys(allTokens).filter(function(tokenAddress){return tokenAddress!==\"ETH\";});// get all eth balances for all exchanges\nPromise.all(allTokensWithAnExchange.map(/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(tokenAddress){var exchangeAddress,_ref7,existingValue;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return new Promise(function(resolve){return setTimeout(resolve,STAGGER_TIME*Math.random());});case 2:exchangeAddress=allTokens[tokenAddress].exchangeAddress;_ref7=safeAccess(stateRef.current,[chainId,exchangeAddress,\"ETH\"])||{},existingValue=_ref7.value;_context2.t0=existingValue;if(_context2.t0){_context2.next=9;break;}_context2.next=8;return getEtherBalance(exchangeAddress,library).catch(function(){return null;});case 8:_context2.t0=_context2.sent;case 9:return _context2.abrupt(\"return\",_context2.t0);case 10:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref6.apply(this,arguments);};}())).then(function(ethBalances){updateAllForExchanges(chainId,allTokensWithAnExchange.map(function(tokenAddress){return allTokens[tokenAddress].exchangeAddress;}),Array(allTokensWithAnExchange.length).fill(\"ETH\"),ethBalances);});// get all token balances for all exchanges\nPromise.all(allTokensWithAnExchange.map(/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(tokenAddress){var exchangeAddress,_ref9,existingValue;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return new Promise(function(resolve){return setTimeout(resolve,STAGGER_TIME*Math.random());});case 2:exchangeAddress=allTokens[tokenAddress].exchangeAddress;_ref9=safeAccess(stateRef.current,[chainId,exchangeAddress,tokenAddress])||{},existingValue=_ref9.value;_context3.t0=existingValue;if(_context3.t0){_context3.next=9;break;}_context3.next=8;return getTokenBalance(tokenAddress,exchangeAddress,library).catch(function(){return null;});case 8:_context3.t0=_context3.sent;case 9:return _context3.abrupt(\"return\",_context3.t0);case 10:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref8.apply(this,arguments);};}())).then(function(tokenBalances){updateAllForExchanges(chainId,allTokensWithAnExchange.map(function(tokenAddress){return allTokens[tokenAddress].exchangeAddress;}),allTokensWithAnExchange.map(function(tokenAddress){return tokenAddress;}),tokenBalances);});}case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function getData(){return _ref3.apply(this,arguments);};}();getData();},[chainId,library,account,allTokens,updateAllForAccount,updateAllForExchanges]);return null;}export function useAllBalances(){var _useWeb3React2=useWeb3React(),chainId=_useWeb3React2.chainId;var _useBalancesContext3=useBalancesContext(),_useBalancesContext4=_slicedToArray(_useBalancesContext3,1),state=_useBalancesContext4[0];var balances=safeAccess(state,[chainId])||{};return balances;}export function useAddressBalance(address,tokenAddress){var _useWeb3React3=useWeb3React(),library=_useWeb3React3.library,chainId=_useWeb3React3.chainId;var globalBlockNumber=useBlockNumber();var _useBalancesContext5=useBalancesContext(),_useBalancesContext6=_slicedToArray(_useBalancesContext5,2),state=_useBalancesContext6[0],update=_useBalancesContext6[1].update;var _ref10=safeAccess(state,[chainId,address,tokenAddress])||{},value=_ref10.value,blockNumber=_ref10.blockNumber;useEffect(function(){if(isAddress(address)&&(tokenAddress===\"ETH\"||isAddress(tokenAddress))&&(value===undefined||blockNumber!==globalBlockNumber)&&(chainId||chainId===0)&&library){var stale=false;(tokenAddress===\"ETH\"?getEtherBalance(address,library):getTokenBalance(tokenAddress,address,library)).then(function(value){if(!stale){update(chainId,address,tokenAddress,value,globalBlockNumber);}}).catch(function(){if(!stale){update(chainId,address,tokenAddress,null,globalBlockNumber);}});return function(){stale=true;};}},[address,tokenAddress,value,blockNumber,globalBlockNumber,chainId,library,update]);return value;}export function useExchangeReserves(tokenAddress){var _useTokenDetails=useTokenDetails(tokenAddress),exchangeAddress=_useTokenDetails.exchangeAddress;var reserveETH=useAddressBalance(exchangeAddress,\"ETH\");var reserveToken=useAddressBalance(exchangeAddress,tokenAddress);return{reserveETH:reserveETH,reserveToken:reserveToken};}var buildReserveObject=function buildReserveObject(chainId,tokenAddress,ethReserveAmount,tokenReserveAmount,decimals){return{token:{chainId:chainId,address:tokenAddress,decimals:decimals},ethReserve:{token:{chainId:chainId,decimals:18},amount:ethReserveAmount},tokenReserve:{token:{chainId:chainId,address:tokenAddress,decimals:decimals},amount:tokenReserveAmount}};};var daiTokenAddress=\"0x6B175474E89094C44Da98b954EedeAC495271d0F\";var daiExchangeAddress=\"0x2a1530C4C41db0B0b2bB646CB5Eb1A67b7158667\";var usdcTokenAddress=\"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48\";var usdcExchangeAddress=\"0x97deC872013f6B5fB443861090ad931542878126\";var tusdTokenAddress=\"0x0000000000085d4780B73119b644AE5ecd22b376\";var tusdExchangeAddress=\"0x5048b9d01097498Fd72F3F14bC9Bc74A5aAc8fA7\";var nescTokenAddress=\"0x97D8383CfC757E4844d30bcd5f06F2d153F245F7\";var nescExchangeAddress=\"0x97D8383CfC757E4844d30bcd5f06F2d153F245F7\";export function useETHPriceInUSD(){var _useWeb3React4=useWeb3React(),chainId=_useWeb3React4.chainId;var daiReserveETH=useAddressBalance(daiExchangeAddress,\"ETH\");var daiReserveToken=useAddressBalance(daiExchangeAddress,daiTokenAddress);var usdcReserveETH=useAddressBalance(usdcExchangeAddress,\"ETH\");var usdcReserveToken=useAddressBalance(usdcExchangeAddress,usdcTokenAddress);var tusdReserveETH=useAddressBalance(tusdExchangeAddress,\"ETH\");var tusdReserveToken=useAddressBalance(tusdExchangeAddress,nescTokenAddress);var nescReserveETH=useAddressBalance(nescExchangeAddress,\"ETH\");var nescReserveToken=useAddressBalance(nescExchangeAddress,nescTokenAddress);var _useState=useState(),_useState2=_slicedToArray(_useState,2),price=_useState2[0],setPrice=_useState2[1];useEffect(function(){if(daiReserveETH&&daiReserveToken&&usdcReserveETH&&usdcReserveToken&&nescReserveETH&&nescReserveToken&&tusdReserveETH&&tusdReserveToken){var daiReservesObject=buildReserveObject(chainId,daiTokenAddress,new BigNumber(daiReserveETH.toString()),new BigNumber(daiReserveToken.toString()),18);var tusdReservesObject=buildReserveObject(chainId,tusdTokenAddress,new BigNumber(tusdReserveETH.toString()),new BigNumber(tusdReserveToken.toString()),18);var nescReservesObject=buildReserveObject(chainId,nescTokenAddress,new BigNumber(nescReserveETH.toString()),new BigNumber(nescReserveToken.toString()),18);var usdcReservesObject=buildReserveObject(chainId,usdcTokenAddress,new BigNumber(usdcReserveETH.toString()),new BigNumber(usdcReserveToken.toString()),6);var stablecoinReserves=[daiReservesObject,usdcReservesObject,nescReservesObject,tusdReservesObject];try{setPrice(getUSDPrice(stablecoinReserves));}catch(_unused){setPrice(null);}}},[daiReserveETH,daiReserveToken,usdcReserveETH,usdcReserveToken,nescReserveETH,nescReserveToken,tusdReserveETH,tusdReserveToken,chainId]);return price;}","map":{"version":3,"sources":["/workspace/uniswap-exchange/src/contexts/Balances.js"],"names":["React","createContext","useContext","useReducer","useMemo","useCallback","useEffect","useRef","useState","BigNumber","useWeb3React","safeAccess","isAddress","getEtherBalance","getTokenBalance","useBlockNumber","useTokenDetails","useAllTokenDetails","getUSDPrice","UPDATE","UPDATE_ALL_FOR_ACCOUNT","UPDATE_ALL_FOR_EXCHANGES","BalancesContext","useBalancesContext","reducer","state","type","payload","networkId","address","tokenAddress","value","blockNumber","tokenAddresses","values","reduce","accumulator","currentValue","i","exchangeAddresses","Error","Provider","children","dispatch","update","updateAllForAccount","updateAllForExchanges","STAGGER_TIME","Updater","library","chainId","account","allTokens","stateRef","current","getData","Promise","all","Object","keys","map","resolve","setTimeout","Math","random","existingValue","catch","then","balances","allTokensWithAnExchange","filter","exchangeAddress","ethBalances","Array","length","fill","tokenBalances","useAllBalances","useAddressBalance","globalBlockNumber","undefined","stale","useExchangeReserves","reserveETH","reserveToken","buildReserveObject","ethReserveAmount","tokenReserveAmount","decimals","token","ethReserve","amount","tokenReserve","daiTokenAddress","daiExchangeAddress","usdcTokenAddress","usdcExchangeAddress","tusdTokenAddress","tusdExchangeAddress","nescTokenAddress","nescExchangeAddress","useETHPriceInUSD","daiReserveETH","daiReserveToken","usdcReserveETH","usdcReserveToken","tusdReserveETH","tusdReserveToken","nescReserveETH","nescReserveToken","price","setPrice","daiReservesObject","toString","tusdReservesObject","nescReservesObject","usdcReservesObject","stablecoinReserves"],"mappings":"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","sourcesContent":["import React, {\n  createContext,\n  useContext,\n  useReducer,\n  useMemo,\n  useCallback,\n  useEffect,\n  useRef,\n  useState\n} from \"react\";\nimport { BigNumber } from \"@uniswap/sdk\";\n\nimport { useWeb3React } from \"../hooks\";\nimport {\n  safeAccess,\n  isAddress,\n  getEtherBalance,\n  getTokenBalance\n} from \"../utils\";\nimport { useBlockNumber } from \"./Application\";\nimport { useTokenDetails, useAllTokenDetails } from \"./Tokens\";\nimport { getUSDPrice } from \"../utils/price\";\n\nconst UPDATE = \"UPDATE\";\nconst UPDATE_ALL_FOR_ACCOUNT = \"UPDATE_ALL_FOR_ACCOUNT\";\nconst UPDATE_ALL_FOR_EXCHANGES = \"UPDATE_ALL_FOR_EXCHANGES\";\n\nconst BalancesContext = createContext();\n\nfunction useBalancesContext() {\n  return useContext(BalancesContext);\n}\n\nfunction reducer(state, { type, payload }) {\n  switch (type) {\n    case UPDATE: {\n      const { networkId, address, tokenAddress, value, blockNumber } = payload;\n      return {\n        ...state,\n        [networkId]: {\n          ...(safeAccess(state, [networkId]) || {}),\n          [address]: {\n            ...(safeAccess(state, [networkId, address]) || {}),\n            [tokenAddress]: {\n              value,\n              blockNumber\n            }\n          }\n        }\n      };\n    }\n    case UPDATE_ALL_FOR_ACCOUNT: {\n      const { networkId, address, tokenAddresses, values } = payload;\n      return {\n        ...state,\n        [networkId]: {\n          ...(safeAccess(state, [networkId]) || {}),\n          [address]: {\n            ...tokenAddresses.reduce((accumulator, currentValue, i) => {\n              accumulator[currentValue] = { value: values[i] };\n              return accumulator;\n            }, {}),\n            ...(safeAccess(state, [networkId, address]) || {})\n          }\n        }\n      };\n    }\n    case UPDATE_ALL_FOR_EXCHANGES: {\n      const { networkId, exchangeAddresses, tokenAddresses, values } = payload;\n      return {\n        ...state,\n        [networkId]: {\n          ...(safeAccess(state, [networkId]) || {}),\n          ...exchangeAddresses.reduce((accumulator, currentValue, i) => {\n            accumulator[currentValue] = {\n              ...safeAccess(state, [networkId, currentValue]),\n              [tokenAddresses[i]]: {\n                value: values[i]\n              }\n            };\n            return accumulator;\n          }, {})\n        }\n      };\n    }\n    default: {\n      throw Error(\n        `Unexpected action type in BalancesContext reducer: '${type}'.`\n      );\n    }\n  }\n}\n\nexport default function Provider({ children }) {\n  const [state, dispatch] = useReducer(reducer, {});\n\n  const update = useCallback(\n    (networkId, address, tokenAddress, value, blockNumber) => {\n      dispatch({\n        type: UPDATE,\n        payload: { networkId, address, tokenAddress, value, blockNumber }\n      });\n    },\n    []\n  );\n\n  const updateAllForAccount = useCallback(\n    (networkId, address, tokenAddresses, values) => {\n      dispatch({\n        type: UPDATE_ALL_FOR_ACCOUNT,\n        payload: { networkId, address, tokenAddresses, values }\n      });\n    },\n    []\n  );\n\n  const updateAllForExchanges = useCallback(\n    (networkId, exchangeAddresses, tokenAddresses, values) => {\n      dispatch({\n        type: UPDATE_ALL_FOR_EXCHANGES,\n        payload: { networkId, exchangeAddresses, tokenAddresses, values }\n      });\n    },\n    []\n  );\n\n  return (\n    <BalancesContext.Provider\n      value={useMemo(\n        () => [state, { update, updateAllForAccount, updateAllForExchanges }],\n        [state, update, updateAllForAccount, updateAllForExchanges]\n      )}\n    >\n      {children}\n    </BalancesContext.Provider>\n  );\n}\n\nconst STAGGER_TIME = 2500;\nexport function Updater() {\n  const { library, chainId, account } = useWeb3React();\n\n  const allTokens = useAllTokenDetails();\n\n  const [\n    state,\n    { updateAllForAccount, updateAllForExchanges }\n  ] = useBalancesContext();\n  const stateRef = useRef(state);\n  stateRef.current = state;\n\n  useEffect(() => {\n    const getData = async () => {\n      if (chainId && library && account) {\n        // get 1 eth + all token balances for the account\n        Promise.all(\n          Object.keys(allTokens).map(async tokenAddress => {\n            await new Promise(resolve =>\n              setTimeout(resolve, STAGGER_TIME * Math.random())\n            );\n\n            const { value: existingValue } =\n              safeAccess(stateRef.current, [chainId, account, tokenAddress]) ||\n              {};\n            return (\n              existingValue ||\n              (await (tokenAddress === \"ETH\"\n                ? getEtherBalance(account, library).catch(() => null)\n                : getTokenBalance(tokenAddress, account, library).catch(\n                    () => null\n                  )))\n            );\n          })\n        ).then(balances => {\n          updateAllForAccount(\n            chainId,\n            account,\n            Object.keys(allTokens),\n            balances\n          );\n        });\n\n        const allTokensWithAnExchange = Object.keys(allTokens).filter(\n          tokenAddress => tokenAddress !== \"ETH\"\n        );\n        // get all eth balances for all exchanges\n        Promise.all(\n          allTokensWithAnExchange.map(async tokenAddress => {\n            await new Promise(resolve =>\n              setTimeout(resolve, STAGGER_TIME * Math.random())\n            );\n\n            const exchangeAddress = allTokens[tokenAddress].exchangeAddress;\n            const { value: existingValue } =\n              safeAccess(stateRef.current, [chainId, exchangeAddress, \"ETH\"]) ||\n              {};\n            return (\n              existingValue ||\n              (await getEtherBalance(exchangeAddress, library).catch(\n                () => null\n              ))\n            );\n          })\n        ).then(ethBalances => {\n          updateAllForExchanges(\n            chainId,\n            allTokensWithAnExchange.map(\n              tokenAddress => allTokens[tokenAddress].exchangeAddress\n            ),\n            Array(allTokensWithAnExchange.length).fill(\"ETH\"),\n            ethBalances\n          );\n        });\n\n        // get all token balances for all exchanges\n        Promise.all(\n          allTokensWithAnExchange.map(async tokenAddress => {\n            await new Promise(resolve =>\n              setTimeout(resolve, STAGGER_TIME * Math.random())\n            );\n\n            const exchangeAddress = allTokens[tokenAddress].exchangeAddress;\n            const { value: existingValue } =\n              safeAccess(stateRef.current, [\n                chainId,\n                exchangeAddress,\n                tokenAddress\n              ]) || {};\n            return (\n              existingValue ||\n              (await getTokenBalance(\n                tokenAddress,\n                exchangeAddress,\n                library\n              ).catch(() => null))\n            );\n          })\n        ).then(tokenBalances => {\n          updateAllForExchanges(\n            chainId,\n            allTokensWithAnExchange.map(\n              tokenAddress => allTokens[tokenAddress].exchangeAddress\n            ),\n            allTokensWithAnExchange.map(tokenAddress => tokenAddress),\n            tokenBalances\n          );\n        });\n      }\n    };\n\n    getData();\n  }, [\n    chainId,\n    library,\n    account,\n    allTokens,\n    updateAllForAccount,\n    updateAllForExchanges\n  ]);\n\n  return null;\n}\n\nexport function useAllBalances() {\n  const { chainId } = useWeb3React();\n  const [state] = useBalancesContext();\n  const balances = safeAccess(state, [chainId]) || {};\n  return balances;\n}\n\nexport function useAddressBalance(address, tokenAddress) {\n  const { library, chainId } = useWeb3React();\n\n  const globalBlockNumber = useBlockNumber();\n\n  const [state, { update }] = useBalancesContext();\n  const { value, blockNumber } =\n    safeAccess(state, [chainId, address, tokenAddress]) || {};\n\n  useEffect(() => {\n    if (\n      isAddress(address) &&\n      (tokenAddress === \"ETH\" || isAddress(tokenAddress)) &&\n      (value === undefined || blockNumber !== globalBlockNumber) &&\n      (chainId || chainId === 0) &&\n      library\n    ) {\n      let stale = false;\n      (tokenAddress === \"ETH\"\n        ? getEtherBalance(address, library)\n        : getTokenBalance(tokenAddress, address, library)\n      )\n        .then(value => {\n          if (!stale) {\n            update(chainId, address, tokenAddress, value, globalBlockNumber);\n          }\n        })\n        .catch(() => {\n          if (!stale) {\n            update(chainId, address, tokenAddress, null, globalBlockNumber);\n          }\n        });\n      return () => {\n        stale = true;\n      };\n    }\n  }, [\n    address,\n    tokenAddress,\n    value,\n    blockNumber,\n    globalBlockNumber,\n    chainId,\n    library,\n    update\n  ]);\n\n  return value;\n}\n\nexport function useExchangeReserves(tokenAddress) {\n  const { exchangeAddress } = useTokenDetails(tokenAddress);\n\n  const reserveETH = useAddressBalance(exchangeAddress, \"ETH\");\n  const reserveToken = useAddressBalance(exchangeAddress, tokenAddress);\n\n  return { reserveETH, reserveToken };\n}\n\nconst buildReserveObject = (\n  chainId,\n  tokenAddress,\n  ethReserveAmount,\n  tokenReserveAmount,\n  decimals\n) => ({\n  token: {\n    chainId,\n    address: tokenAddress,\n    decimals\n  },\n  ethReserve: {\n    token: {\n      chainId,\n      decimals: 18\n    },\n    amount: ethReserveAmount\n  },\n  tokenReserve: {\n    token: {\n      chainId,\n      address: tokenAddress,\n      decimals\n    },\n    amount: tokenReserveAmount\n  }\n});\nconst daiTokenAddress = \"0x6B175474E89094C44Da98b954EedeAC495271d0F\";\nconst daiExchangeAddress = \"0x2a1530C4C41db0B0b2bB646CB5Eb1A67b7158667\";\nconst usdcTokenAddress = \"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48\";\nconst usdcExchangeAddress = \"0x97deC872013f6B5fB443861090ad931542878126\";\nconst tusdTokenAddress = \"0x0000000000085d4780B73119b644AE5ecd22b376\";\nconst tusdExchangeAddress = \"0x5048b9d01097498Fd72F3F14bC9Bc74A5aAc8fA7\";\nconst nescTokenAddress = \"0x97D8383CfC757E4844d30bcd5f06F2d153F245F7\";\nconst nescExchangeAddress = \"0x97D8383CfC757E4844d30bcd5f06F2d153F245F7\";\nexport function useETHPriceInUSD() {\n  const { chainId } = useWeb3React();\n\n  let daiReserveETH = useAddressBalance(daiExchangeAddress, \"ETH\");\n  let daiReserveToken = useAddressBalance(daiExchangeAddress, daiTokenAddress);\n  let usdcReserveETH = useAddressBalance(usdcExchangeAddress, \"ETH\");\n  let usdcReserveToken = useAddressBalance(\n    usdcExchangeAddress,\n    usdcTokenAddress\n  );\n  let tusdReserveETH = useAddressBalance(tusdExchangeAddress, \"ETH\");\n  let tusdReserveToken = useAddressBalance(\n    tusdExchangeAddress,\n    nescTokenAddress\n  );\n  let nescReserveETH = useAddressBalance(nescExchangeAddress, \"ETH\");\n  let nescReserveToken = useAddressBalance(\n    nescExchangeAddress,\n    nescTokenAddress\n  );\n\n  const [price, setPrice] = useState();\n  useEffect(() => {\n    if (\n      daiReserveETH &&\n      daiReserveToken &&\n      usdcReserveETH &&\n      usdcReserveToken &&\n      nescReserveETH &&\n      nescReserveToken &&\n      tusdReserveETH &&\n      tusdReserveToken\n    ) {\n      const daiReservesObject = buildReserveObject(\n        chainId,\n        daiTokenAddress,\n        new BigNumber(daiReserveETH.toString()),\n        new BigNumber(daiReserveToken.toString()),\n        18\n      );\n      const tusdReservesObject = buildReserveObject(\n        chainId,\n        tusdTokenAddress,\n        new BigNumber(tusdReserveETH.toString()),\n        new BigNumber(tusdReserveToken.toString()),\n        18\n      );\n      const nescReservesObject = buildReserveObject(\n        chainId,\n        nescTokenAddress,\n        new BigNumber(nescReserveETH.toString()),\n        new BigNumber(nescReserveToken.toString()),\n        18\n      );\n      const usdcReservesObject = buildReserveObject(\n        chainId,\n        usdcTokenAddress,\n        new BigNumber(usdcReserveETH.toString()),\n        new BigNumber(usdcReserveToken.toString()),\n        6\n      );\n\n      const stablecoinReserves = [\n        daiReservesObject,\n        usdcReservesObject,\n        nescReservesObject,\n        tusdReservesObject\n      ];\n\n      try {\n        setPrice(getUSDPrice(stablecoinReserves));\n      } catch {\n        setPrice(null);\n      }\n    }\n  }, [\n    daiReserveETH,\n    daiReserveToken,\n    usdcReserveETH,\n    usdcReserveToken,\n    nescReserveETH,\n    nescReserveToken,\n    tusdReserveETH,\n    tusdReserveToken,\n    chainId\n  ]);\n\n  return price;\n}\n"]},"metadata":{},"sourceType":"module"}