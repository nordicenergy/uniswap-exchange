{"ast":null,"code":"import _regeneratorRuntime from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _objectWithoutProperties from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _taggedTemplateLiteral from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject10(){var data=_taggedTemplateLiteral([\"\\n  width: 0.625rem;\\n  height: 0.625rem;\\n  position: relative;\\n  padding: 0.875rem;\\n  path {\\n    stroke: \",\";\\n  }\\n\"]);_templateObject10=function _templateObject10(){return data;};return data;}function _templateObject9(){var data=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: center;\\n  padding: 2rem;\\n\\n  button {\\n    max-width: 20rem;\\n  }\\n\"]);_templateObject9=function _templateObject9(){return data;};return data;}function _templateObject8(){var data=_taggedTemplateLiteral([\"\\n  flex: 1 1 auto;\\n  width: 0;\\n  color: \",\";\\n\"]);_templateObject8=function _templateObject8(){return data;};return data;}function _templateObject7(){var data=_taggedTemplateLiteral([\"\\n  \",\";\\n  align-items: center;\\n  color: \",\";\\n  font-size: 0.75rem;\\n  padding: 0.25rem 1rem 0;\\n\"]);_templateObject7=function _templateObject7(){return data;};return data;}function _templateObject6(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  padding: 1rem 0;\\n\"]);_templateObject6=function _templateObject6(){return data;};return data;}function _templateObject5(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  justify-content: center;\\n  align-items: center;\\n\"]);_templateObject5=function _templateObject5(){return data;};return data;}function _templateObject4(){var data=_taggedTemplateLiteral([\"\\n  margin-top: 1rem;\\n\"]);_templateObject4=function _templateObject4(){return data;};return data;}function _templateObject3(){var data=_taggedTemplateLiteral([\"\\n  font-size: 0.75rem;\\n  line-height: 1rem;\\n  text-align: center;\\n\\n  :first-child {\\n    padding-bottom: 0.3rem;\\n    font-weight: 500;\\n  }\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n  margin-top: 1rem;\\n  padding: 1rem;\\n  margin-bottom: 2rem;\\n  border: 1px solid rgba($pizazz-orange, 0.4);\\n  background-color: rgba($pizazz-orange, 0.1);\\n  border-radius: 1rem;\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  color: \",\";\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useReducer,useState,useCallback,useEffect,useMemo}from'react';import{useTranslation}from'react-i18next';import{createBrowserHistory}from'history';import{ethers}from'ethers';import ReactGA from'react-ga';import styled from'styled-components';import{Button}from'../../theme';import CurrencyInputPanel from'../../components/CurrencyInputPanel';import OversizedPanel from'../../components/OversizedPanel';import ContextualInfo from'../../components/ContextualInfo';import{ReactComponent as Plus}from\"@svgr/webpack?-svgo,+titleProp,+ref!../../assets/images/plus-blue.svg\";import WarningCard from'../../components/WarningCard';import{useWeb3React,useExchangeContract}from'../../hooks';import{brokenTokens}from'../../constants';import{amountFormatter,calculateGasMargin}from'../../utils';import{useTransactionAdder}from'../../contexts/Transactions';import{useTokenDetails,INITIAL_TOKENS_CONTEXT}from'../../contexts/Tokens';import{useAddressBalance,useExchangeReserves,useETHPriceInUSD}from'../../contexts/Balances';import{useAddressAllowance}from'../../contexts/Allowances';var INPUT=0;var OUTPUT=1;// denominated in bips\nvar ALLOWED_SLIPPAGE=ethers.utils.bigNumberify(200);// denominated in seconds\nvar DEADLINE_FROM_NOW=60*15;// denominated in bips\nvar GAS_MARGIN=ethers.utils.bigNumberify(1000);var BlueSpan=styled.span(_templateObject(),function(_ref){var theme=_ref.theme;return theme.royalBlue;});var NewExchangeWarning=styled.div(_templateObject2());var NewExchangeWarningText=styled.div(_templateObject3());var LastSummaryText=styled.div(_templateObject4());var DownArrowBackground=styled.div(_templateObject5(),function(_ref2){var theme=_ref2.theme;return theme.flexRowNoWrap;});var SummaryPanel=styled.div(_templateObject6(),function(_ref3){var theme=_ref3.theme;return theme.flexColumnNoWrap;});var ExchangeRateWrapper=styled.div(_templateObject7(),function(_ref4){var theme=_ref4.theme;return theme.flexRowNoWrap;},function(_ref5){var theme=_ref5.theme;return theme.doveGray;});var ExchangeRate=styled.span(_templateObject8(),function(_ref6){var theme=_ref6.theme;return theme.doveGray;});var Flex=styled.div(_templateObject9());var WrappedPlus=function WrappedPlus(_ref7){var isError=_ref7.isError,highSlippageWarning=_ref7.highSlippageWarning,rest=_objectWithoutProperties(_ref7,[\"isError\",\"highSlippageWarning\"]);return React.createElement(Plus,rest);};var ColoredWrappedPlus=styled(WrappedPlus)(_templateObject10(),function(_ref8){var active=_ref8.active,theme=_ref8.theme;return active?theme.royalBlue:theme.chaliceGray;});function calculateSlippageBounds(value){if(value){var offset=value.mul(ALLOWED_SLIPPAGE).div(ethers.utils.bigNumberify(10000));var minimum=value.sub(offset);var maximum=value.add(offset);return{minimum:minimum.lt(ethers.constants.Zero)?ethers.constants.Zero:minimum,maximum:maximum.gt(ethers.constants.MaxUint256)?ethers.constants.MaxUint256:maximum};}else{return{};}}function calculateMaxOutputVal(value){if(value){return value.mul(ethers.utils.bigNumberify(10000)).div(ALLOWED_SLIPPAGE.add(ethers.utils.bigNumberify(10000)));}}function initialAddLiquidityState(state){return{inputValue:state.ethAmountURL?state.ethAmountURL:'',outputValue:state.tokenAmountURL&&!state.ethAmountURL?state.tokenAmountURL:'',lastEditedField:state.tokenAmountURL&&state.ethAmountURL===''?OUTPUT:INPUT,outputCurrency:state.tokenURL?state.tokenURL:''};}function addLiquidityStateReducer(state,action){switch(action.type){case'SELECT_CURRENCY':{return _objectSpread({},state,{outputCurrency:action.payload});}case'UPDATE_VALUE':{var inputValue=state.inputValue,outputValue=state.outputValue;var _action$payload=action.payload,field=_action$payload.field,value=_action$payload.value;return _objectSpread({},state,{inputValue:field===INPUT?value:inputValue,outputValue:field===OUTPUT?value:outputValue,lastEditedField:field});}case'UPDATE_DEPENDENT_VALUE':{var _inputValue=state.inputValue,_outputValue=state.outputValue;var _action$payload2=action.payload,_field=_action$payload2.field,_value=_action$payload2.value;return _objectSpread({},state,{inputValue:_field===INPUT?_value:_inputValue,outputValue:_field===OUTPUT?_value:_outputValue});}default:{return initialAddLiquidityState();}}}function getExchangeRate(inputValue,inputDecimals,outputValue,outputDecimals){var invert=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;try{if(inputValue&&(inputDecimals||inputDecimals===0)&&outputValue&&(outputDecimals||outputDecimals===0)){var factor=ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18));if(invert){return inputValue.mul(factor).mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals))).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals))).div(outputValue);}else{return outputValue.mul(factor).mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals))).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals))).div(inputValue);}}}catch(_unused){}}function getMarketRate(reserveETH,reserveToken,decimals){var invert=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return getExchangeRate(reserveETH,18,reserveToken,decimals,invert);}export default function AddLiquidity(_ref9){var params=_ref9.params;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useWeb3React=useWeb3React(),library=_useWeb3React.library,account=_useWeb3React.account,active=_useWeb3React.active,chainId=_useWeb3React.chainId;// BigNumber.js instance\nvar ethPrice=useETHPriceInUSD();var urlAddedTokens={};if(params.token){urlAddedTokens[params.token]=true;}// clear url of query\nuseEffect(function(){var history=createBrowserHistory();history.push(window.location.pathname+'');},[]);var _useReducer=useReducer(addLiquidityStateReducer,{ethAmountURL:params.ethAmount,tokenAmountURL:params.tokenAmount,tokenURL:params.token},initialAddLiquidityState),_useReducer2=_slicedToArray(_useReducer,2),addLiquidityState=_useReducer2[0],dispatchAddLiquidityState=_useReducer2[1];var inputValue=addLiquidityState.inputValue,outputValue=addLiquidityState.outputValue,lastEditedField=addLiquidityState.lastEditedField,outputCurrency=addLiquidityState.outputCurrency;var inputCurrency='ETH';var _useState=useState(),_useState2=_slicedToArray(_useState,2),inputValueParsed=_useState2[0],setInputValueParsed=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),outputValueParsed=_useState4[0],setOutputValueParsed=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),inputError=_useState6[0],setInputError=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),outputError=_useState8[0],setOutputError=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),zeroDecimalError=_useState10[0],setZeroDecimalError=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),brokenTokenWarning=_useState12[0],setBrokenTokenWarning=_useState12[1];var _useTokenDetails=useTokenDetails(outputCurrency),symbol=_useTokenDetails.symbol,decimals=_useTokenDetails.decimals,exchangeAddress=_useTokenDetails.exchangeAddress;var exchangeContract=useExchangeContract(exchangeAddress);var _useState13=useState(),_useState14=_slicedToArray(_useState13,2),totalPoolTokens=_useState14[0],setTotalPoolTokens=_useState14[1];var fetchPoolTokens=useCallback(function(){if(exchangeContract){exchangeContract.totalSupply().then(function(totalSupply){setTotalPoolTokens(totalSupply);});}},[exchangeContract]);useEffect(function(){fetchPoolTokens();library.on('block',fetchPoolTokens);return function(){library.removeListener('block',fetchPoolTokens);};},[fetchPoolTokens,library]);var poolTokenBalance=useAddressBalance(account,exchangeAddress);var exchangeETHBalance=useAddressBalance(exchangeAddress,'ETH');var exchangeTokenBalance=useAddressBalance(exchangeAddress,outputCurrency);var _useExchangeReserves=useExchangeReserves(outputCurrency),reserveETH=_useExchangeReserves.reserveETH,reserveToken=_useExchangeReserves.reserveToken;var isNewExchange=!!(reserveETH&&reserveToken&&reserveETH.isZero()&&reserveToken.isZero());// 18 decimals\nvar poolTokenPercentage=poolTokenBalance&&totalPoolTokens&&isNewExchange===false&&!totalPoolTokens.isZero()?poolTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens):undefined;var ethShare=exchangeETHBalance&&poolTokenPercentage?exchangeETHBalance.mul(poolTokenPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))):undefined;var tokenShare=exchangeTokenBalance&&poolTokenPercentage?exchangeTokenBalance.mul(poolTokenPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))):undefined;var liquidityMinted=isNewExchange?inputValueParsed:totalPoolTokens&&inputValueParsed&&exchangeETHBalance&&!exchangeETHBalance.isZero()?totalPoolTokens.mul(inputValueParsed).div(exchangeETHBalance):undefined;// user balances\nvar inputBalance=useAddressBalance(account,inputCurrency);var outputBalance=useAddressBalance(account,outputCurrency);var ethPerLiquidityToken=exchangeETHBalance&&totalPoolTokens&&isNewExchange===false&&!totalPoolTokens.isZero()?exchangeETHBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens):undefined;var tokenPerLiquidityToken=exchangeTokenBalance&&totalPoolTokens&&isNewExchange===false&&!totalPoolTokens.isZero()?exchangeTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens):undefined;var outputValueMax=outputValueParsed&&calculateSlippageBounds(outputValueParsed).maximum;var liquidityTokensMin=liquidityMinted&&calculateSlippageBounds(liquidityMinted).minimum;var marketRate=useMemo(function(){return getMarketRate(reserveETH,reserveToken,decimals);},[reserveETH,reserveToken,decimals]);var marketRateInverted=useMemo(function(){return getMarketRate(reserveETH,reserveToken,decimals,true);},[reserveETH,reserveToken,decimals]);function renderTransactionDetails(){var b=function b(text){return React.createElement(BlueSpan,null,text);};if(isNewExchange){return React.createElement(\"div\",null,React.createElement(\"div\",null,t('youAreAdding'),\" \",b(\"\".concat(inputValue,\" ETH\")),\" \",t('and'),\" \",b(\"\".concat(outputValue,\" \").concat(symbol)),\" \",t('intoPool')),React.createElement(LastSummaryText,null,t('youAreSettingExRate'),' ',b(\"1 ETH = \".concat(amountFormatter(getMarketRate(inputValueParsed,outputValueParsed,decimals),18,4,false),\" \").concat(symbol)),\".\"),React.createElement(LastSummaryText,null,t('youWillMint'),\" \",b(\"\".concat(inputValue)),\" \",t('liquidityTokens')),React.createElement(LastSummaryText,null,t('totalSupplyIs0')));}else{return React.createElement(React.Fragment,null,React.createElement(\"div\",null,t('youAreAdding'),\" \",b(\"\".concat(amountFormatter(inputValueParsed,18,4),\" ETH\")),\" \",t('and'),\" \",'at most',' ',b(\"\".concat(amountFormatter(outputValueMax,decimals,Math.min(decimals,4)),\" \").concat(symbol)),\" \",t('intoPool')),React.createElement(LastSummaryText,null,t('youWillMint'),\" \",b(amountFormatter(liquidityMinted,18,4)),\" \",t('liquidityTokens')),React.createElement(LastSummaryText,null,t('totalSupplyIs'),\" \",b(amountFormatter(totalPoolTokens,18,4))),React.createElement(LastSummaryText,null,t('tokenWorth'),\" \",b(amountFormatter(ethPerLiquidityToken,18,4)),\" ETH \",t('and'),' ',b(amountFormatter(tokenPerLiquidityToken,decimals,Math.min(decimals,4))),\" \",symbol));}}function renderSummary(){var contextualInfo='';var isError=false;if(brokenTokenWarning){contextualInfo=t('brokenToken');isError=true;}else if(zeroDecimalError){contextualInfo=zeroDecimalError;}else if(inputError||outputError){contextualInfo=inputError||outputError;isError=true;}else if(!inputCurrency||!outputCurrency){contextualInfo=t('selectTokenCont');}else if(!inputValue){contextualInfo=t('enterValueCont');}else if(!account){contextualInfo=t('noWallet');isError=true;}return React.createElement(ContextualInfo,{openDetailsText:t('transactionDetails'),closeDetailsText:t('hideDetails'),contextualInfo:contextualInfo,isError:isError,renderTransactionDetails:renderTransactionDetails});}var addTransaction=useTransactionAdder();function onAddLiquidity(){return _onAddLiquidity.apply(this,arguments);}function _onAddLiquidity(){_onAddLiquidity=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var usdTransactionSize,deadline,estimatedGasLimit,gasLimit;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// take ETH amount, multiplied by ETH rate and 2 for total tx size\nusdTransactionSize=ethPrice*(inputValueParsed/1e18)*2;// log pool added to and total usd amount\nReactGA.event({category:'Transaction',action:'Add Liquidity',label:outputCurrency,value:usdTransactionSize});deadline=Math.ceil(Date.now()/1000)+DEADLINE_FROM_NOW;_context.next=5;return exchangeContract.estimate.addLiquidity(isNewExchange?ethers.constants.Zero:liquidityTokensMin,isNewExchange?outputValueParsed:outputValueMax,deadline,{value:inputValueParsed});case 5:estimatedGasLimit=_context.sent;gasLimit=calculateGasMargin(estimatedGasLimit,GAS_MARGIN);exchangeContract.addLiquidity(isNewExchange?ethers.constants.Zero:liquidityTokensMin,isNewExchange?outputValueParsed:outputValueMax,deadline,{value:inputValueParsed,gasLimit:gasLimit}).then(function(response){addTransaction(response);});case 8:case\"end\":return _context.stop();}}},_callee);}));return _onAddLiquidity.apply(this,arguments);}function formatBalance(value){return\"Balance: \".concat(value);}useEffect(function(){setBrokenTokenWarning(false);for(var i=0;i<brokenTokens.length;i++){if(brokenTokens[i].toLowerCase()===outputCurrency.toLowerCase()){setBrokenTokenWarning(true);}}},[outputCurrency]);useEffect(function(){if(isNewExchange){setZeroDecimalError();if(inputValue){var parsedInputValue=ethers.utils.parseUnits(inputValue,18);setInputValueParsed(parsedInputValue);}if(outputValue){try{var parsedOutputValue=ethers.utils.parseUnits(outputValue,decimals);setOutputValueParsed(parsedOutputValue);}catch(_unused2){setZeroDecimalError('Invalid input. For 0 decimal tokens only supply whole number token amounts.');}}}},[decimals,inputValue,isNewExchange,outputValue]);// parse input value\nuseEffect(function(){if(isNewExchange===false&&inputValue&&marketRate&&lastEditedField===INPUT&&(decimals||decimals===0)){try{var parsedValue=ethers.utils.parseUnits(inputValue,18);if(parsedValue.lte(ethers.constants.Zero)||parsedValue.gte(ethers.constants.MaxUint256)){throw Error();}setInputValueParsed(parsedValue);var currencyAmount=marketRate.mul(parsedValue).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18-decimals)));setOutputValueParsed(currencyAmount);dispatchAddLiquidityState({type:'UPDATE_DEPENDENT_VALUE',payload:{field:OUTPUT,value:amountFormatter(currencyAmount,decimals,Math.min(decimals,4),false)}});return function(){setOutputError();setInputValueParsed();setOutputValueParsed();dispatchAddLiquidityState({type:'UPDATE_DEPENDENT_VALUE',payload:{field:OUTPUT,value:''}});};}catch(_unused3){setOutputError(t('inputNotValid'));}}},[inputValue,isNewExchange,lastEditedField,marketRate,decimals,t]);// parse output value\nuseEffect(function(){if(isNewExchange===false&&outputValue&&marketRateInverted&&lastEditedField===OUTPUT&&(decimals||decimals===0)){try{var parsedValue=ethers.utils.parseUnits(outputValue,decimals);if(parsedValue.lte(ethers.constants.Zero)||parsedValue.gte(ethers.constants.MaxUint256)){throw Error();}setOutputValueParsed(parsedValue);var currencyAmount=marketRateInverted.mul(parsedValue).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(decimals)));setInputValueParsed(currencyAmount);dispatchAddLiquidityState({type:'UPDATE_DEPENDENT_VALUE',payload:{field:INPUT,value:amountFormatter(currencyAmount,18,4,false)}});return function(){setInputError();setOutputValueParsed();setInputValueParsed();dispatchAddLiquidityState({type:'UPDATE_DEPENDENT_VALUE',payload:{field:INPUT,value:''}});};}catch(_unused4){setInputError(t('inputNotValid'));}}},[outputValue,isNewExchange,lastEditedField,marketRateInverted,decimals,t]);// input validation\nuseEffect(function(){if(inputValueParsed&&inputBalance){if(inputValueParsed.gt(inputBalance)){setInputError(t('insufficientBalance'));}else{setInputError(null);}}if(outputValueMax&&outputBalance){if(outputValueMax.gt(outputBalance)){setOutputError(t('insufficientBalance'));}else{setOutputError(null);}}},[inputValueParsed,inputBalance,outputValueMax,outputBalance,t]);var allowance=useAddressAllowance(account,outputCurrency,exchangeAddress);var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),showUnlock=_useState16[0],setShowUnlock=_useState16[1];useEffect(function(){if(outputValueParsed&&allowance){if(allowance.lt(outputValueParsed)){setOutputError(t('unlockTokenCont'));setShowUnlock(true);}return function(){setOutputError();setShowUnlock(false);};}},[outputValueParsed,allowance,t]);var isActive=active&&account;var isValid=(inputError===null||outputError===null)&&!zeroDecimalError&&!showUnlock&&!brokenTokenWarning;var newOutputDetected=outputCurrency!=='ETH'&&outputCurrency&&!INITIAL_TOKENS_CONTEXT[chainId].hasOwnProperty(outputCurrency);var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),showOutputWarning=_useState18[0],setShowOutputWarning=_useState18[1];useEffect(function(){if(newOutputDetected){setShowOutputWarning(true);}else{setShowOutputWarning(false);}},[newOutputDetected,setShowOutputWarning]);return React.createElement(React.Fragment,null,isNewExchange?React.createElement(NewExchangeWarning,null,React.createElement(NewExchangeWarningText,null,React.createElement(\"span\",{role:\"img\",\"aria-label\":\"first-liquidity\"},\"\\uD83D\\uDEB0\"),' ',t('firstLiquidity')),React.createElement(NewExchangeWarningText,null,t('initialExchangeRate',{symbol:symbol}))):null,showOutputWarning&&React.createElement(WarningCard,{onDismiss:function onDismiss(){setShowOutputWarning(false);},urlAddedTokens:urlAddedTokens,currency:outputCurrency}),React.createElement(CurrencyInputPanel,{title:t('deposit'),extraText:inputBalance&&formatBalance(amountFormatter(inputBalance,18,4)),onValueChange:function onValueChange(inputValue){dispatchAddLiquidityState({type:'UPDATE_VALUE',payload:{value:inputValue,field:INPUT}});},extraTextClickHander:function extraTextClickHander(){if(inputBalance){var valueToSet=inputBalance.sub(ethers.utils.parseEther('.1'));if(valueToSet.gt(ethers.constants.Zero)){dispatchAddLiquidityState({type:'UPDATE_VALUE',payload:{value:amountFormatter(valueToSet,18,18,false),field:INPUT}});}}},selectedTokenAddress:\"ETH\",value:inputValue,errorMessage:inputError,disableTokenSelect:true}),React.createElement(OversizedPanel,null,React.createElement(DownArrowBackground,null,React.createElement(ColoredWrappedPlus,{active:isActive,alt:\"plus\"}))),React.createElement(CurrencyInputPanel,{title:t('deposit'),description:isNewExchange?'':outputValue?\"(\".concat(t('estimated'),\")\"):'',extraText:outputBalance&&decimals&&formatBalance(amountFormatter(outputBalance,decimals,Math.min(decimals,4))),urlAddedTokens:urlAddedTokens,selectedTokenAddress:outputCurrency,onCurrencySelected:function onCurrencySelected(outputCurrency){dispatchAddLiquidityState({type:'SELECT_CURRENCY',payload:outputCurrency});},onValueChange:function onValueChange(outputValue){dispatchAddLiquidityState({type:'UPDATE_VALUE',payload:{value:outputValue,field:OUTPUT}});},extraTextClickHander:function extraTextClickHander(){if(outputBalance){dispatchAddLiquidityState({type:'UPDATE_VALUE',payload:{value:amountFormatter(calculateMaxOutputVal(outputBalance),decimals,decimals,false),field:OUTPUT}});}},value:outputValue,showUnlock:showUnlock,errorMessage:outputError}),React.createElement(OversizedPanel,{hideBottom:true},React.createElement(SummaryPanel,null,React.createElement(ExchangeRateWrapper,null,React.createElement(ExchangeRate,null,t('exchangeRate')),React.createElement(\"span\",null,marketRate?\"1 ETH = \".concat(amountFormatter(marketRate,18,4),\" \").concat(symbol):' - ')),React.createElement(ExchangeRateWrapper,null,React.createElement(ExchangeRate,null,t('currentPoolSize')),React.createElement(\"span\",null,exchangeETHBalance&&exchangeTokenBalance?\"\".concat(amountFormatter(exchangeETHBalance,18,4),\" ETH + \").concat(amountFormatter(exchangeTokenBalance,decimals,Math.min(4,decimals)),\" \").concat(symbol):' - ')),React.createElement(ExchangeRateWrapper,null,React.createElement(ExchangeRate,null,t('yourPoolShare'),\" (\",exchangeETHBalance&&amountFormatter(poolTokenPercentage,16,2),\"%)\"),React.createElement(\"span\",null,ethShare&&tokenShare?\"\".concat(amountFormatter(ethShare,18,4),\" ETH + \").concat(amountFormatter(tokenShare,decimals,Math.min(4,decimals)),\" \").concat(symbol):' - ')))),renderSummary(),React.createElement(Flex,null,React.createElement(Button,{disabled:!isValid,onClick:onAddLiquidity},t('addLiquidity'))));}","map":{"version":3,"sources":["/workspace/uniswap-exchange/src/pages/Pool/AddLiquidity.js"],"names":["React","useReducer","useState","useCallback","useEffect","useMemo","useTranslation","createBrowserHistory","ethers","ReactGA","styled","Button","CurrencyInputPanel","OversizedPanel","ContextualInfo","WarningCard","useWeb3React","useExchangeContract","brokenTokens","amountFormatter","calculateGasMargin","useTransactionAdder","useTokenDetails","INITIAL_TOKENS_CONTEXT","useAddressBalance","useExchangeReserves","useETHPriceInUSD","useAddressAllowance","INPUT","OUTPUT","ALLOWED_SLIPPAGE","utils","bigNumberify","DEADLINE_FROM_NOW","GAS_MARGIN","BlueSpan","span","theme","royalBlue","NewExchangeWarning","div","NewExchangeWarningText","LastSummaryText","DownArrowBackground","flexRowNoWrap","SummaryPanel","flexColumnNoWrap","ExchangeRateWrapper","doveGray","ExchangeRate","Flex","WrappedPlus","isError","highSlippageWarning","rest","ColoredWrappedPlus","active","chaliceGray","calculateSlippageBounds","value","offset","mul","minimum","sub","maximum","add","lt","constants","Zero","gt","MaxUint256","calculateMaxOutputVal","initialAddLiquidityState","state","inputValue","ethAmountURL","outputValue","tokenAmountURL","lastEditedField","outputCurrency","tokenURL","addLiquidityStateReducer","action","type","payload","field","getExchangeRate","inputDecimals","outputDecimals","invert","factor","pow","getMarketRate","reserveETH","reserveToken","decimals","AddLiquidity","params","t","library","account","chainId","ethPrice","urlAddedTokens","token","history","push","window","location","pathname","ethAmount","tokenAmount","addLiquidityState","dispatchAddLiquidityState","inputCurrency","inputValueParsed","setInputValueParsed","outputValueParsed","setOutputValueParsed","inputError","setInputError","outputError","setOutputError","zeroDecimalError","setZeroDecimalError","brokenTokenWarning","setBrokenTokenWarning","symbol","exchangeAddress","exchangeContract","totalPoolTokens","setTotalPoolTokens","fetchPoolTokens","totalSupply","then","on","removeListener","poolTokenBalance","exchangeETHBalance","exchangeTokenBalance","isNewExchange","isZero","poolTokenPercentage","undefined","ethShare","tokenShare","liquidityMinted","inputBalance","outputBalance","ethPerLiquidityToken","tokenPerLiquidityToken","outputValueMax","liquidityTokensMin","marketRate","marketRateInverted","renderTransactionDetails","b","text","Math","min","renderSummary","contextualInfo","addTransaction","onAddLiquidity","usdTransactionSize","event","category","label","deadline","ceil","Date","now","estimate","addLiquidity","estimatedGasLimit","gasLimit","response","formatBalance","i","length","toLowerCase","parsedInputValue","parseUnits","parsedOutputValue","parsedValue","lte","gte","Error","currencyAmount","allowance","showUnlock","setShowUnlock","isActive","isValid","newOutputDetected","hasOwnProperty","showOutputWarning","setShowOutputWarning","valueToSet","parseEther"],"mappings":"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","sourcesContent":["import React, { useReducer, useState, useCallback, useEffect, useMemo } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { createBrowserHistory } from 'history'\nimport { ethers } from 'ethers'\nimport ReactGA from 'react-ga'\nimport styled from 'styled-components'\n\nimport { Button } from '../../theme'\nimport CurrencyInputPanel from '../../components/CurrencyInputPanel'\nimport OversizedPanel from '../../components/OversizedPanel'\nimport ContextualInfo from '../../components/ContextualInfo'\nimport { ReactComponent as Plus } from '../../assets/images/plus-blue.svg'\nimport WarningCard from '../../components/WarningCard'\n\nimport { useWeb3React, useExchangeContract } from '../../hooks'\nimport { brokenTokens } from '../../constants'\nimport { amountFormatter, calculateGasMargin } from '../../utils'\nimport { useTransactionAdder } from '../../contexts/Transactions'\nimport { useTokenDetails, INITIAL_TOKENS_CONTEXT } from '../../contexts/Tokens'\nimport { useAddressBalance, useExchangeReserves, useETHPriceInUSD } from '../../contexts/Balances'\nimport { useAddressAllowance } from '../../contexts/Allowances'\n\nconst INPUT = 0\nconst OUTPUT = 1\n\n// denominated in bips\nconst ALLOWED_SLIPPAGE = ethers.utils.bigNumberify(200)\n\n// denominated in seconds\nconst DEADLINE_FROM_NOW = 60 * 15\n\n// denominated in bips\nconst GAS_MARGIN = ethers.utils.bigNumberify(1000)\n\nconst BlueSpan = styled.span`\n  color: ${({ theme }) => theme.royalBlue};\n`\n\nconst NewExchangeWarning = styled.div`\n  margin-top: 1rem;\n  padding: 1rem;\n  margin-bottom: 2rem;\n  border: 1px solid rgba($pizazz-orange, 0.4);\n  background-color: rgba($pizazz-orange, 0.1);\n  border-radius: 1rem;\n`\n\nconst NewExchangeWarningText = styled.div`\n  font-size: 0.75rem;\n  line-height: 1rem;\n  text-align: center;\n\n  :first-child {\n    padding-bottom: 0.3rem;\n    font-weight: 500;\n  }\n`\n\nconst LastSummaryText = styled.div`\n  margin-top: 1rem;\n`\n\nconst DownArrowBackground = styled.div`\n  ${({ theme }) => theme.flexRowNoWrap}\n  justify-content: center;\n  align-items: center;\n`\nconst SummaryPanel = styled.div`\n  ${({ theme }) => theme.flexColumnNoWrap}\n  padding: 1rem 0;\n`\n\nconst ExchangeRateWrapper = styled.div`\n  ${({ theme }) => theme.flexRowNoWrap};\n  align-items: center;\n  color: ${({ theme }) => theme.doveGray};\n  font-size: 0.75rem;\n  padding: 0.25rem 1rem 0;\n`\n\nconst ExchangeRate = styled.span`\n  flex: 1 1 auto;\n  width: 0;\n  color: ${({ theme }) => theme.doveGray};\n`\n\nconst Flex = styled.div`\n  display: flex;\n  justify-content: center;\n  padding: 2rem;\n\n  button {\n    max-width: 20rem;\n  }\n`\n\nconst WrappedPlus = ({ isError, highSlippageWarning, ...rest }) => <Plus {...rest} />\nconst ColoredWrappedPlus = styled(WrappedPlus)`\n  width: 0.625rem;\n  height: 0.625rem;\n  position: relative;\n  padding: 0.875rem;\n  path {\n    stroke: ${({ active, theme }) => (active ? theme.royalBlue : theme.chaliceGray)};\n  }\n`\n\nfunction calculateSlippageBounds(value) {\n  if (value) {\n    const offset = value.mul(ALLOWED_SLIPPAGE).div(ethers.utils.bigNumberify(10000))\n    const minimum = value.sub(offset)\n    const maximum = value.add(offset)\n    return {\n      minimum: minimum.lt(ethers.constants.Zero) ? ethers.constants.Zero : minimum,\n      maximum: maximum.gt(ethers.constants.MaxUint256) ? ethers.constants.MaxUint256 : maximum\n    }\n  } else {\n    return {}\n  }\n}\n\nfunction calculateMaxOutputVal(value) {\n  if (value) {\n    return value.mul(ethers.utils.bigNumberify(10000)).div(ALLOWED_SLIPPAGE.add(ethers.utils.bigNumberify(10000)))\n  }\n}\n\nfunction initialAddLiquidityState(state) {\n  return {\n    inputValue: state.ethAmountURL ? state.ethAmountURL : '',\n    outputValue: state.tokenAmountURL && !state.ethAmountURL ? state.tokenAmountURL : '',\n    lastEditedField: state.tokenAmountURL && state.ethAmountURL === '' ? OUTPUT : INPUT,\n    outputCurrency: state.tokenURL ? state.tokenURL : ''\n  }\n}\n\nfunction addLiquidityStateReducer(state, action) {\n  switch (action.type) {\n    case 'SELECT_CURRENCY': {\n      return {\n        ...state,\n        outputCurrency: action.payload\n      }\n    }\n    case 'UPDATE_VALUE': {\n      const { inputValue, outputValue } = state\n      const { field, value } = action.payload\n      return {\n        ...state,\n        inputValue: field === INPUT ? value : inputValue,\n        outputValue: field === OUTPUT ? value : outputValue,\n        lastEditedField: field\n      }\n    }\n    case 'UPDATE_DEPENDENT_VALUE': {\n      const { inputValue, outputValue } = state\n      const { field, value } = action.payload\n      return {\n        ...state,\n        inputValue: field === INPUT ? value : inputValue,\n        outputValue: field === OUTPUT ? value : outputValue\n      }\n    }\n    default: {\n      return initialAddLiquidityState()\n    }\n  }\n}\n\nfunction getExchangeRate(inputValue, inputDecimals, outputValue, outputDecimals, invert = false) {\n  try {\n    if (\n      inputValue &&\n      (inputDecimals || inputDecimals === 0) &&\n      outputValue &&\n      (outputDecimals || outputDecimals === 0)\n    ) {\n      const factor = ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))\n\n      if (invert) {\n        return inputValue\n          .mul(factor)\n          .mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals)))\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals)))\n          .div(outputValue)\n      } else {\n        return outputValue\n          .mul(factor)\n          .mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals)))\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals)))\n          .div(inputValue)\n      }\n    }\n  } catch {}\n}\n\nfunction getMarketRate(reserveETH, reserveToken, decimals, invert = false) {\n  return getExchangeRate(reserveETH, 18, reserveToken, decimals, invert)\n}\n\nexport default function AddLiquidity({ params }) {\n  const { t } = useTranslation()\n  const { library, account, active, chainId } = useWeb3React()\n\n  // BigNumber.js instance\n  const ethPrice = useETHPriceInUSD()\n\n  const urlAddedTokens = {}\n  if (params.token) {\n    urlAddedTokens[params.token] = true\n  }\n\n  // clear url of query\n  useEffect(() => {\n    const history = createBrowserHistory()\n    history.push(window.location.pathname + '')\n  }, [])\n\n  const [addLiquidityState, dispatchAddLiquidityState] = useReducer(\n    addLiquidityStateReducer,\n    { ethAmountURL: params.ethAmount, tokenAmountURL: params.tokenAmount, tokenURL: params.token },\n    initialAddLiquidityState\n  )\n  const { inputValue, outputValue, lastEditedField, outputCurrency } = addLiquidityState\n  const inputCurrency = 'ETH'\n\n  const [inputValueParsed, setInputValueParsed] = useState()\n  const [outputValueParsed, setOutputValueParsed] = useState()\n  const [inputError, setInputError] = useState()\n  const [outputError, setOutputError] = useState()\n  const [zeroDecimalError, setZeroDecimalError] = useState()\n\n  const [brokenTokenWarning, setBrokenTokenWarning] = useState()\n\n  const { symbol, decimals, exchangeAddress } = useTokenDetails(outputCurrency)\n  const exchangeContract = useExchangeContract(exchangeAddress)\n\n  const [totalPoolTokens, setTotalPoolTokens] = useState()\n  const fetchPoolTokens = useCallback(() => {\n    if (exchangeContract) {\n      exchangeContract.totalSupply().then(totalSupply => {\n        setTotalPoolTokens(totalSupply)\n      })\n    }\n  }, [exchangeContract])\n  useEffect(() => {\n    fetchPoolTokens()\n    library.on('block', fetchPoolTokens)\n\n    return () => {\n      library.removeListener('block', fetchPoolTokens)\n    }\n  }, [fetchPoolTokens, library])\n\n  const poolTokenBalance = useAddressBalance(account, exchangeAddress)\n  const exchangeETHBalance = useAddressBalance(exchangeAddress, 'ETH')\n  const exchangeTokenBalance = useAddressBalance(exchangeAddress, outputCurrency)\n\n  const { reserveETH, reserveToken } = useExchangeReserves(outputCurrency)\n  const isNewExchange = !!(reserveETH && reserveToken && reserveETH.isZero() && reserveToken.isZero())\n\n  // 18 decimals\n  const poolTokenPercentage =\n    poolTokenBalance && totalPoolTokens && isNewExchange === false && !totalPoolTokens.isZero()\n      ? poolTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens)\n      : undefined\n  const ethShare =\n    exchangeETHBalance && poolTokenPercentage\n      ? exchangeETHBalance\n          .mul(poolTokenPercentage)\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n      : undefined\n  const tokenShare =\n    exchangeTokenBalance && poolTokenPercentage\n      ? exchangeTokenBalance\n          .mul(poolTokenPercentage)\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n      : undefined\n\n  const liquidityMinted = isNewExchange\n    ? inputValueParsed\n    : totalPoolTokens && inputValueParsed && exchangeETHBalance && !exchangeETHBalance.isZero()\n    ? totalPoolTokens.mul(inputValueParsed).div(exchangeETHBalance)\n    : undefined\n\n  // user balances\n  const inputBalance = useAddressBalance(account, inputCurrency)\n  const outputBalance = useAddressBalance(account, outputCurrency)\n\n  const ethPerLiquidityToken =\n    exchangeETHBalance && totalPoolTokens && isNewExchange === false && !totalPoolTokens.isZero()\n      ? exchangeETHBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens)\n      : undefined\n  const tokenPerLiquidityToken =\n    exchangeTokenBalance && totalPoolTokens && isNewExchange === false && !totalPoolTokens.isZero()\n      ? exchangeTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens)\n      : undefined\n\n  const outputValueMax = outputValueParsed && calculateSlippageBounds(outputValueParsed).maximum\n  const liquidityTokensMin = liquidityMinted && calculateSlippageBounds(liquidityMinted).minimum\n\n  const marketRate = useMemo(() => {\n    return getMarketRate(reserveETH, reserveToken, decimals)\n  }, [reserveETH, reserveToken, decimals])\n  const marketRateInverted = useMemo(() => {\n    return getMarketRate(reserveETH, reserveToken, decimals, true)\n  }, [reserveETH, reserveToken, decimals])\n\n  function renderTransactionDetails() {\n    const b = text => <BlueSpan>{text}</BlueSpan>\n\n    if (isNewExchange) {\n      return (\n        <div>\n          <div>\n            {t('youAreAdding')} {b(`${inputValue} ETH`)} {t('and')} {b(`${outputValue} ${symbol}`)} {t('intoPool')}\n          </div>\n          <LastSummaryText>\n            {t('youAreSettingExRate')}{' '}\n            {b(\n              `1 ETH = ${amountFormatter(\n                getMarketRate(inputValueParsed, outputValueParsed, decimals),\n                18,\n                4,\n                false\n              )} ${symbol}`\n            )}\n            .\n          </LastSummaryText>\n          <LastSummaryText>\n            {t('youWillMint')} {b(`${inputValue}`)} {t('liquidityTokens')}\n          </LastSummaryText>\n          <LastSummaryText>{t('totalSupplyIs0')}</LastSummaryText>\n        </div>\n      )\n    } else {\n      return (\n        <>\n          <div>\n            {t('youAreAdding')} {b(`${amountFormatter(inputValueParsed, 18, 4)} ETH`)} {t('and')} {'at most'}{' '}\n            {b(`${amountFormatter(outputValueMax, decimals, Math.min(decimals, 4))} ${symbol}`)} {t('intoPool')}\n          </div>\n          <LastSummaryText>\n            {t('youWillMint')} {b(amountFormatter(liquidityMinted, 18, 4))} {t('liquidityTokens')}\n          </LastSummaryText>\n          <LastSummaryText>\n            {t('totalSupplyIs')} {b(amountFormatter(totalPoolTokens, 18, 4))}\n          </LastSummaryText>\n          <LastSummaryText>\n            {t('tokenWorth')} {b(amountFormatter(ethPerLiquidityToken, 18, 4))} ETH {t('and')}{' '}\n            {b(amountFormatter(tokenPerLiquidityToken, decimals, Math.min(decimals, 4)))} {symbol}\n          </LastSummaryText>\n        </>\n      )\n    }\n  }\n\n  function renderSummary() {\n    let contextualInfo = ''\n    let isError = false\n    if (brokenTokenWarning) {\n      contextualInfo = t('brokenToken')\n      isError = true\n    } else if (zeroDecimalError) {\n      contextualInfo = zeroDecimalError\n    } else if (inputError || outputError) {\n      contextualInfo = inputError || outputError\n      isError = true\n    } else if (!inputCurrency || !outputCurrency) {\n      contextualInfo = t('selectTokenCont')\n    } else if (!inputValue) {\n      contextualInfo = t('enterValueCont')\n    } else if (!account) {\n      contextualInfo = t('noWallet')\n      isError = true\n    }\n\n    return (\n      <ContextualInfo\n        openDetailsText={t('transactionDetails')}\n        closeDetailsText={t('hideDetails')}\n        contextualInfo={contextualInfo}\n        isError={isError}\n        renderTransactionDetails={renderTransactionDetails}\n      />\n    )\n  }\n\n  const addTransaction = useTransactionAdder()\n\n  async function onAddLiquidity() {\n    // take ETH amount, multiplied by ETH rate and 2 for total tx size\n    let usdTransactionSize = ethPrice * (inputValueParsed / 1e18) * 2\n\n    // log pool added to and total usd amount\n    ReactGA.event({\n      category: 'Transaction',\n      action: 'Add Liquidity',\n      label: outputCurrency,\n      value: usdTransactionSize\n    })\n\n    const deadline = Math.ceil(Date.now() / 1000) + DEADLINE_FROM_NOW\n\n    const estimatedGasLimit = await exchangeContract.estimate.addLiquidity(\n      isNewExchange ? ethers.constants.Zero : liquidityTokensMin,\n      isNewExchange ? outputValueParsed : outputValueMax,\n      deadline,\n      {\n        value: inputValueParsed\n      }\n    )\n\n    const gasLimit = calculateGasMargin(estimatedGasLimit, GAS_MARGIN)\n\n    exchangeContract\n      .addLiquidity(\n        isNewExchange ? ethers.constants.Zero : liquidityTokensMin,\n        isNewExchange ? outputValueParsed : outputValueMax,\n        deadline,\n        {\n          value: inputValueParsed,\n          gasLimit\n        }\n      )\n      .then(response => {\n        addTransaction(response)\n      })\n  }\n\n  function formatBalance(value) {\n    return `Balance: ${value}`\n  }\n\n  useEffect(() => {\n    setBrokenTokenWarning(false)\n    for (let i = 0; i < brokenTokens.length; i++) {\n      if (brokenTokens[i].toLowerCase() === outputCurrency.toLowerCase()) {\n        setBrokenTokenWarning(true)\n      }\n    }\n  }, [outputCurrency])\n\n  useEffect(() => {\n    if (isNewExchange) {\n      setZeroDecimalError()\n      if (inputValue) {\n        const parsedInputValue = ethers.utils.parseUnits(inputValue, 18)\n        setInputValueParsed(parsedInputValue)\n      }\n      if (outputValue) {\n        try {\n          const parsedOutputValue = ethers.utils.parseUnits(outputValue, decimals)\n          setOutputValueParsed(parsedOutputValue)\n        } catch {\n          setZeroDecimalError('Invalid input. For 0 decimal tokens only supply whole number token amounts.')\n        }\n      }\n    }\n  }, [decimals, inputValue, isNewExchange, outputValue])\n\n  // parse input value\n  useEffect(() => {\n    if (\n      isNewExchange === false &&\n      inputValue &&\n      marketRate &&\n      lastEditedField === INPUT &&\n      (decimals || decimals === 0)\n    ) {\n      try {\n        const parsedValue = ethers.utils.parseUnits(inputValue, 18)\n\n        if (parsedValue.lte(ethers.constants.Zero) || parsedValue.gte(ethers.constants.MaxUint256)) {\n          throw Error()\n        }\n\n        setInputValueParsed(parsedValue)\n\n        const currencyAmount = marketRate\n          .mul(parsedValue)\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18 - decimals)))\n\n        setOutputValueParsed(currencyAmount)\n        dispatchAddLiquidityState({\n          type: 'UPDATE_DEPENDENT_VALUE',\n          payload: { field: OUTPUT, value: amountFormatter(currencyAmount, decimals, Math.min(decimals, 4), false) }\n        })\n\n        return () => {\n          setOutputError()\n          setInputValueParsed()\n          setOutputValueParsed()\n          dispatchAddLiquidityState({\n            type: 'UPDATE_DEPENDENT_VALUE',\n            payload: { field: OUTPUT, value: '' }\n          })\n        }\n      } catch {\n        setOutputError(t('inputNotValid'))\n      }\n    }\n  }, [inputValue, isNewExchange, lastEditedField, marketRate, decimals, t])\n\n  // parse output value\n  useEffect(() => {\n    if (\n      isNewExchange === false &&\n      outputValue &&\n      marketRateInverted &&\n      lastEditedField === OUTPUT &&\n      (decimals || decimals === 0)\n    ) {\n      try {\n        const parsedValue = ethers.utils.parseUnits(outputValue, decimals)\n\n        if (parsedValue.lte(ethers.constants.Zero) || parsedValue.gte(ethers.constants.MaxUint256)) {\n          throw Error()\n        }\n\n        setOutputValueParsed(parsedValue)\n\n        const currencyAmount = marketRateInverted\n          .mul(parsedValue)\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(decimals)))\n\n        setInputValueParsed(currencyAmount)\n        dispatchAddLiquidityState({\n          type: 'UPDATE_DEPENDENT_VALUE',\n          payload: { field: INPUT, value: amountFormatter(currencyAmount, 18, 4, false) }\n        })\n\n        return () => {\n          setInputError()\n          setOutputValueParsed()\n          setInputValueParsed()\n          dispatchAddLiquidityState({\n            type: 'UPDATE_DEPENDENT_VALUE',\n            payload: { field: INPUT, value: '' }\n          })\n        }\n      } catch {\n        setInputError(t('inputNotValid'))\n      }\n    }\n  }, [outputValue, isNewExchange, lastEditedField, marketRateInverted, decimals, t])\n\n  // input validation\n  useEffect(() => {\n    if (inputValueParsed && inputBalance) {\n      if (inputValueParsed.gt(inputBalance)) {\n        setInputError(t('insufficientBalance'))\n      } else {\n        setInputError(null)\n      }\n    }\n\n    if (outputValueMax && outputBalance) {\n      if (outputValueMax.gt(outputBalance)) {\n        setOutputError(t('insufficientBalance'))\n      } else {\n        setOutputError(null)\n      }\n    }\n  }, [inputValueParsed, inputBalance, outputValueMax, outputBalance, t])\n\n  const allowance = useAddressAllowance(account, outputCurrency, exchangeAddress)\n\n  const [showUnlock, setShowUnlock] = useState(false)\n  useEffect(() => {\n    if (outputValueParsed && allowance) {\n      if (allowance.lt(outputValueParsed)) {\n        setOutputError(t('unlockTokenCont'))\n        setShowUnlock(true)\n      }\n      return () => {\n        setOutputError()\n        setShowUnlock(false)\n      }\n    }\n  }, [outputValueParsed, allowance, t])\n\n  const isActive = active && account\n  const isValid =\n    (inputError === null || outputError === null) && !zeroDecimalError && !showUnlock && !brokenTokenWarning\n\n  const newOutputDetected =\n    outputCurrency !== 'ETH' && outputCurrency && !INITIAL_TOKENS_CONTEXT[chainId].hasOwnProperty(outputCurrency)\n\n  const [showOutputWarning, setShowOutputWarning] = useState(false)\n\n  useEffect(() => {\n    if (newOutputDetected) {\n      setShowOutputWarning(true)\n    } else {\n      setShowOutputWarning(false)\n    }\n  }, [newOutputDetected, setShowOutputWarning])\n  return (\n    <>\n      {isNewExchange ? (\n        <NewExchangeWarning>\n          <NewExchangeWarningText>\n            <span role=\"img\" aria-label=\"first-liquidity\">\n              \n            </span>{' '}\n            {t('firstLiquidity')}\n          </NewExchangeWarningText>\n          <NewExchangeWarningText>{t('initialExchangeRate', { symbol })}</NewExchangeWarningText>\n        </NewExchangeWarning>\n      ) : null}\n      {showOutputWarning && (\n        <WarningCard\n          onDismiss={() => {\n            setShowOutputWarning(false)\n          }}\n          urlAddedTokens={urlAddedTokens}\n          currency={outputCurrency}\n        />\n      )}\n      <CurrencyInputPanel\n        title={t('deposit')}\n        extraText={inputBalance && formatBalance(amountFormatter(inputBalance, 18, 4))}\n        onValueChange={inputValue => {\n          dispatchAddLiquidityState({ type: 'UPDATE_VALUE', payload: { value: inputValue, field: INPUT } })\n        }}\n        extraTextClickHander={() => {\n          if (inputBalance) {\n            const valueToSet = inputBalance.sub(ethers.utils.parseEther('.1'))\n            if (valueToSet.gt(ethers.constants.Zero)) {\n              dispatchAddLiquidityState({\n                type: 'UPDATE_VALUE',\n                payload: { value: amountFormatter(valueToSet, 18, 18, false), field: INPUT }\n              })\n            }\n          }\n        }}\n        selectedTokenAddress=\"ETH\"\n        value={inputValue}\n        errorMessage={inputError}\n        disableTokenSelect\n      />\n      <OversizedPanel>\n        <DownArrowBackground>\n          <ColoredWrappedPlus active={isActive} alt=\"plus\" />\n        </DownArrowBackground>\n      </OversizedPanel>\n      <CurrencyInputPanel\n        title={t('deposit')}\n        description={isNewExchange ? '' : outputValue ? `(${t('estimated')})` : ''}\n        extraText={\n          outputBalance && decimals && formatBalance(amountFormatter(outputBalance, decimals, Math.min(decimals, 4)))\n        }\n        urlAddedTokens={urlAddedTokens}\n        selectedTokenAddress={outputCurrency}\n        onCurrencySelected={outputCurrency => {\n          dispatchAddLiquidityState({ type: 'SELECT_CURRENCY', payload: outputCurrency })\n        }}\n        onValueChange={outputValue => {\n          dispatchAddLiquidityState({ type: 'UPDATE_VALUE', payload: { value: outputValue, field: OUTPUT } })\n        }}\n        extraTextClickHander={() => {\n          if (outputBalance) {\n            dispatchAddLiquidityState({\n              type: 'UPDATE_VALUE',\n              payload: {\n                value: amountFormatter(calculateMaxOutputVal(outputBalance), decimals, decimals, false),\n                field: OUTPUT\n              }\n            })\n          }\n        }}\n        value={outputValue}\n        showUnlock={showUnlock}\n        errorMessage={outputError}\n      />\n      <OversizedPanel hideBottom>\n        <SummaryPanel>\n          <ExchangeRateWrapper>\n            <ExchangeRate>{t('exchangeRate')}</ExchangeRate>\n            <span>{marketRate ? `1 ETH = ${amountFormatter(marketRate, 18, 4)} ${symbol}` : ' - '}</span>\n          </ExchangeRateWrapper>\n          <ExchangeRateWrapper>\n            <ExchangeRate>{t('currentPoolSize')}</ExchangeRate>\n            <span>\n              {exchangeETHBalance && exchangeTokenBalance\n                ? `${amountFormatter(exchangeETHBalance, 18, 4)} ETH + ${amountFormatter(\n                    exchangeTokenBalance,\n                    decimals,\n                    Math.min(4, decimals)\n                  )} ${symbol}`\n                : ' - '}\n            </span>\n          </ExchangeRateWrapper>\n          <ExchangeRateWrapper>\n            <ExchangeRate>\n              {t('yourPoolShare')} ({exchangeETHBalance && amountFormatter(poolTokenPercentage, 16, 2)}%)\n            </ExchangeRate>\n            <span>\n              {ethShare && tokenShare\n                ? `${amountFormatter(ethShare, 18, 4)} ETH + ${amountFormatter(\n                    tokenShare,\n                    decimals,\n                    Math.min(4, decimals)\n                  )} ${symbol}`\n                : ' - '}\n            </span>\n          </ExchangeRateWrapper>\n        </SummaryPanel>\n      </OversizedPanel>\n      {renderSummary()}\n      <Flex>\n        <Button disabled={!isValid} onClick={onAddLiquidity}>\n          {t('addLiquidity')}\n        </Button>\n      </Flex>\n    </>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}