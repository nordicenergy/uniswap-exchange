{"ast":null,"code":"import _slicedToArray from\"/workspace/uniswap-exchange/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"/workspace/uniswap-exchange/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/workspace/uniswap-exchange/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{createContext,useContext,useReducer,useMemo,useCallback,useEffect}from\"react\";import\"@web3-react/core\";import{useWeb3React}from\"../hooks\";import{safeAccess,isAddress,getTokenAllowance}from\"../utils\";import{useBlockNumber}from\"./Application\";var UPDATE=\"UPDATE\";var AllowancesContext=createContext();function useAllowancesContext(){return useContext(AllowancesContext);}function reducer(state,_ref){var type=_ref.type,payload=_ref.payload;switch(type){case UPDATE:{var networkId=payload.networkId,address=payload.address,tokenAddress=payload.tokenAddress,spenderAddress=payload.spenderAddress,value=payload.value,blockNumber=payload.blockNumber;return _objectSpread({},state,_defineProperty({},networkId,_objectSpread({},safeAccess(state,[networkId])||{},_defineProperty({},address,_objectSpread({},safeAccess(state,[networkId,address])||{},_defineProperty({},tokenAddress,_objectSpread({},safeAccess(state,[networkId,address,tokenAddress])||{},_defineProperty({},spenderAddress,{value:value,blockNumber:blockNumber}))))))));}default:{throw Error(\"Unexpected action type in AllowancesContext reducer: '\".concat(type,\"'.\"));}}}export default function Provider(_ref2){var children=_ref2.children;var _useReducer=useReducer(reducer,{}),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var update=useCallback(function(networkId,address,tokenAddress,spenderAddress,value,blockNumber){dispatch({type:UPDATE,payload:{networkId:networkId,address:address,tokenAddress:tokenAddress,spenderAddress:spenderAddress,value:value,blockNumber:blockNumber}});},[]);return React.createElement(AllowancesContext.Provider,{value:useMemo(function(){return[state,{update:update}];},[state,update])},children);}export function useAddressAllowance(address,tokenAddress,spenderAddress){var _useWeb3React=useWeb3React(),library=_useWeb3React.library,chainId=_useWeb3React.chainId;var globalBlockNumber=useBlockNumber();var _useAllowancesContext=useAllowancesContext(),_useAllowancesContext2=_slicedToArray(_useAllowancesContext,2),state=_useAllowancesContext2[0],update=_useAllowancesContext2[1].update;var _ref3=safeAccess(state,[chainId,address,tokenAddress,spenderAddress])||{},value=_ref3.value,blockNumber=_ref3.blockNumber;useEffect(function(){if(isAddress(address)&&isAddress(tokenAddress)&&isAddress(spenderAddress)&&(value===undefined||blockNumber!==globalBlockNumber)&&(chainId||chainId===0)&&library){var stale=false;getTokenAllowance(address,tokenAddress,spenderAddress,library).then(function(value){if(!stale){update(chainId,address,tokenAddress,spenderAddress,value,globalBlockNumber);}}).catch(function(){if(!stale){update(chainId,address,tokenAddress,spenderAddress,null,globalBlockNumber);}});return function(){stale=true;};}},[address,tokenAddress,spenderAddress,value,blockNumber,globalBlockNumber,chainId,library,update]);return value;}","map":{"version":3,"sources":["/workspace/uniswap-exchange/src/contexts/Allowances.js"],"names":["React","createContext","useContext","useReducer","useMemo","useCallback","useEffect","useWeb3React","safeAccess","isAddress","getTokenAllowance","useBlockNumber","UPDATE","AllowancesContext","useAllowancesContext","reducer","state","type","payload","networkId","address","tokenAddress","spenderAddress","value","blockNumber","Error","Provider","children","dispatch","update","useAddressAllowance","library","chainId","globalBlockNumber","undefined","stale","then","catch"],"mappings":"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","sourcesContent":["import React, {\n  createContext,\n  useContext,\n  useReducer,\n  useMemo,\n  useCallback,\n  useEffect\n} from \"react\";\nimport {} from \"@web3-react/core\";\n\nimport { useWeb3React } from \"../hooks\";\nimport { safeAccess, isAddress, getTokenAllowance } from \"../utils\";\nimport { useBlockNumber } from \"./Application\";\n\nconst UPDATE = \"UPDATE\";\n\nconst AllowancesContext = createContext();\n\nfunction useAllowancesContext() {\n  return useContext(AllowancesContext);\n}\n\nfunction reducer(state, { type, payload }) {\n  switch (type) {\n    case UPDATE: {\n      const {\n        networkId,\n        address,\n        tokenAddress,\n        spenderAddress,\n        value,\n        blockNumber\n      } = payload;\n      return {\n        ...state,\n        [networkId]: {\n          ...(safeAccess(state, [networkId]) || {}),\n          [address]: {\n            ...(safeAccess(state, [networkId, address]) || {}),\n            [tokenAddress]: {\n              ...(safeAccess(state, [networkId, address, tokenAddress]) || {}),\n              [spenderAddress]: {\n                value,\n                blockNumber\n              }\n            }\n          }\n        }\n      };\n    }\n    default: {\n      throw Error(\n        `Unexpected action type in AllowancesContext reducer: '${type}'.`\n      );\n    }\n  }\n}\n\nexport default function Provider({ children }) {\n  const [state, dispatch] = useReducer(reducer, {});\n\n  const update = useCallback(\n    (networkId, address, tokenAddress, spenderAddress, value, blockNumber) => {\n      dispatch({\n        type: UPDATE,\n        payload: {\n          networkId,\n          address,\n          tokenAddress,\n          spenderAddress,\n          value,\n          blockNumber\n        }\n      });\n    },\n    []\n  );\n\n  return (\n    <AllowancesContext.Provider\n      value={useMemo(() => [state, { update }], [state, update])}\n    >\n      {children}\n    </AllowancesContext.Provider>\n  );\n}\n\nexport function useAddressAllowance(address, tokenAddress, spenderAddress) {\n  const { library, chainId } = useWeb3React();\n\n  const globalBlockNumber = useBlockNumber();\n\n  const [state, { update }] = useAllowancesContext();\n  const { value, blockNumber } =\n    safeAccess(state, [chainId, address, tokenAddress, spenderAddress]) || {};\n\n  useEffect(() => {\n    if (\n      isAddress(address) &&\n      isAddress(tokenAddress) &&\n      isAddress(spenderAddress) &&\n      (value === undefined || blockNumber !== globalBlockNumber) &&\n      (chainId || chainId === 0) &&\n      library\n    ) {\n      let stale = false;\n\n      getTokenAllowance(address, tokenAddress, spenderAddress, library)\n        .then(value => {\n          if (!stale) {\n            update(\n              chainId,\n              address,\n              tokenAddress,\n              spenderAddress,\n              value,\n              globalBlockNumber\n            );\n          }\n        })\n        .catch(() => {\n          if (!stale) {\n            update(\n              chainId,\n              address,\n              tokenAddress,\n              spenderAddress,\n              null,\n              globalBlockNumber\n            );\n          }\n        });\n\n      return () => {\n        stale = true;\n      };\n    }\n  }, [\n    address,\n    tokenAddress,\n    spenderAddress,\n    value,\n    blockNumber,\n    globalBlockNumber,\n    chainId,\n    library,\n    update\n  ]);\n\n  return value;\n}\n"]},"metadata":{},"sourceType":"module"}