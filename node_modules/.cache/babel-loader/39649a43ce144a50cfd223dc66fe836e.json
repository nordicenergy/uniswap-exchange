{"ast":null,"code":"import _regeneratorRuntime from\"/workspace/uniswap-exchange/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/workspace/uniswap-exchange/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/workspace/uniswap-exchange/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/workspace/uniswap-exchange/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _objectWithoutProperties from\"/workspace/uniswap-exchange/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _taggedTemplateLiteral from\"/workspace/uniswap-exchange/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject10(){var data=_taggedTemplateLiteral([\"\\n  width: 0.625rem;\\n  height: 0.625rem;\\n  position: relative;\\n  padding: 0.875rem;\\n  path {\\n    stroke: \",\";\\n  }\\n\"]);_templateObject10=function _templateObject10(){return data;};return data;}function _templateObject9(){var data=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: center;\\n  padding: 2rem;\\n\\n  button {\\n    max-width: 20rem;\\n  }\\n\"]);_templateObject9=function _templateObject9(){return data;};return data;}function _templateObject8(){var data=_taggedTemplateLiteral([\"\\n  flex: 1 1 auto;\\n  width: 0;\\n  color: \",\";\\n\"]);_templateObject8=function _templateObject8(){return data;};return data;}function _templateObject7(){var data=_taggedTemplateLiteral([\"\\n  \",\";\\n  align-items: center;\\n  color: \",\";\\n  font-size: 0.75rem;\\n  padding: 0.25rem 1rem 0;\\n\"]);_templateObject7=function _templateObject7(){return data;};return data;}function _templateObject6(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  padding: 1rem 0;\\n\"]);_templateObject6=function _templateObject6(){return data;};return data;}function _templateObject5(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  justify-content: center;\\n  align-items: center;\\n\"]);_templateObject5=function _templateObject5(){return data;};return data;}function _templateObject4(){var data=_taggedTemplateLiteral([\"\\n  margin-top: 1rem;\\n\"]);_templateObject4=function _templateObject4(){return data;};return data;}function _templateObject3(){var data=_taggedTemplateLiteral([\"\\n  font-size: 0.75rem;\\n  line-height: 1rem;\\n  text-align: center;\\n\\n  :first-child {\\n    padding-bottom: 0.3rem;\\n    font-weight: 500;\\n  }\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n  margin-top: 1rem;\\n  padding: 1rem;\\n  margin-bottom: 2rem;\\n  border: 1px solid rgba($pizazz-orange, 0.4);\\n  background-color: rgba($pizazz-orange, 0.1);\\n  border-radius: 1rem;\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  color: \",\";\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useReducer,useState,useCallback,useEffect,useMemo}from\"react\";import{useTranslation}from\"react-i18next\";import{createBrowserHistory}from\"history\";import{ethers}from\"ethers\";import ReactGA from\"react-ga\";import styled from\"styled-components\";import{Button}from\"../../theme\";import CurrencyInputPanel from\"../../components/CurrencyInputPanel\";import OversizedPanel from\"../../components/OversizedPanel\";import ContextualInfo from\"../../components/ContextualInfo\";import{ReactComponent as Plus}from\"@svgr/webpack?-svgo,+titleProp,+ref!../../assets/images/plus-blue.svg\";import{useWeb3React,useExchangeContract}from\"../../hooks\";import{brokenTokens}from\"../../constants\";import{amountFormatter,calculateGasMargin}from\"../../utils\";import{useTransactionAdder}from\"../../contexts/Transactions\";import{useTokenDetails}from\"../../contexts/Tokens\";import{useAddressBalance,useExchangeReserves,useETHPriceInUSD}from\"../../contexts/Balances\";import{useAddressAllowance}from\"../../contexts/Allowances\";var INPUT=0;var OUTPUT=1;// denominated in bips\nvar ALLOWED_SLIPPAGE=ethers.utils.bigNumberify(200);// denominated in seconds\nvar DEADLINE_FROM_NOW=60*15;// denominated in bips\nvar GAS_MARGIN=ethers.utils.bigNumberify(1000);var BlueSpan=styled.span(_templateObject(),function(_ref){var theme=_ref.theme;return theme.royalBlue;});var NewExchangeWarning=styled.div(_templateObject2());var NewExchangeWarningText=styled.div(_templateObject3());var LastSummaryText=styled.div(_templateObject4());var DownArrowBackground=styled.div(_templateObject5(),function(_ref2){var theme=_ref2.theme;return theme.flexRowNoWrap;});var SummaryPanel=styled.div(_templateObject6(),function(_ref3){var theme=_ref3.theme;return theme.flexColumnNoWrap;});var ExchangeRateWrapper=styled.div(_templateObject7(),function(_ref4){var theme=_ref4.theme;return theme.flexRowNoWrap;},function(_ref5){var theme=_ref5.theme;return theme.doveGray;});var ExchangeRate=styled.span(_templateObject8(),function(_ref6){var theme=_ref6.theme;return theme.doveGray;});var Flex=styled.div(_templateObject9());var WrappedPlus=function WrappedPlus(_ref7){var isError=_ref7.isError,highSlippageWarning=_ref7.highSlippageWarning,rest=_objectWithoutProperties(_ref7,[\"isError\",\"highSlippageWarning\"]);return React.createElement(Plus,rest);};var ColoredWrappedPlus=styled(WrappedPlus)(_templateObject10(),function(_ref8){var active=_ref8.active,theme=_ref8.theme;return active?theme.royalBlue:theme.chaliceGray;});function calculateSlippageBounds(value){if(value){var offset=value.mul(ALLOWED_SLIPPAGE).div(ethers.utils.bigNumberify(10000));var minimum=value.sub(offset);var maximum=value.add(offset);return{minimum:minimum.lt(ethers.constants.Zero)?ethers.constants.Zero:minimum,maximum:maximum.gt(ethers.constants.MaxUint256)?ethers.constants.MaxUint256:maximum};}else{return{};}}function calculateMaxOutputVal(value){if(value){return value.mul(ethers.utils.bigNumberify(10000)).div(ALLOWED_SLIPPAGE.add(ethers.utils.bigNumberify(10000)));}}function initialAddLiquidityState(state){return{inputValue:state.ethAmountURL?state.ethAmountURL:\"\",outputValue:state.tokenAmountURL&&!state.ethAmountURL?state.tokenAmountURL:\"\",lastEditedField:state.tokenAmountURL&&state.ethAmountURL===\"\"?OUTPUT:INPUT,outputCurrency:state.tokenURL?state.tokenURL:\"\"};}function addLiquidityStateReducer(state,action){switch(action.type){case\"SELECT_CURRENCY\":{return _objectSpread({},state,{outputCurrency:action.payload});}case\"UPDATE_VALUE\":{var inputValue=state.inputValue,outputValue=state.outputValue;var _action$payload=action.payload,field=_action$payload.field,value=_action$payload.value;return _objectSpread({},state,{inputValue:field===INPUT?value:inputValue,outputValue:field===OUTPUT?value:outputValue,lastEditedField:field});}case\"UPDATE_DEPENDENT_VALUE\":{var _inputValue=state.inputValue,_outputValue=state.outputValue;var _action$payload2=action.payload,_field=_action$payload2.field,_value=_action$payload2.value;return _objectSpread({},state,{inputValue:_field===INPUT?_value:_inputValue,outputValue:_field===OUTPUT?_value:_outputValue});}default:{return initialAddLiquidityState();}}}function getExchangeRate(inputValue,inputDecimals,outputValue,outputDecimals){var invert=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;try{if(inputValue&&(inputDecimals||inputDecimals===0)&&outputValue&&(outputDecimals||outputDecimals===0)){var factor=ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18));if(invert){return inputValue.mul(factor).div(outputValue).mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals))).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals)));}else{return outputValue.mul(factor).div(inputValue).mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals))).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals)));}}}catch(_unused){}}function getMarketRate(reserveETH,reserveToken,decimals){var invert=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return getExchangeRate(reserveETH,18,reserveToken,decimals,invert);}export default function AddLiquidity(_ref9){var params=_ref9.params;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useWeb3React=useWeb3React(),library=_useWeb3React.library,account=_useWeb3React.account,active=_useWeb3React.active;// BigNumber.js instance\nvar ethPrice=useETHPriceInUSD();// clear url of query\nuseEffect(function(){var history=createBrowserHistory();history.push(window.location.pathname+\"\");},[]);var _useReducer=useReducer(addLiquidityStateReducer,{ethAmountURL:params.ethAmount,tokenAmountURL:params.tokenAmount,tokenURL:params.token},initialAddLiquidityState),_useReducer2=_slicedToArray(_useReducer,2),addLiquidityState=_useReducer2[0],dispatchAddLiquidityState=_useReducer2[1];var inputValue=addLiquidityState.inputValue,outputValue=addLiquidityState.outputValue,lastEditedField=addLiquidityState.lastEditedField,outputCurrency=addLiquidityState.outputCurrency;var inputCurrency=\"ETH\";var _useState=useState(),_useState2=_slicedToArray(_useState,2),inputValueParsed=_useState2[0],setInputValueParsed=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),outputValueParsed=_useState4[0],setOutputValueParsed=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),inputError=_useState6[0],setInputError=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),outputError=_useState8[0],setOutputError=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),brokenTokenWarning=_useState10[0],setBrokenTokenWarning=_useState10[1];var _useTokenDetails=useTokenDetails(outputCurrency),symbol=_useTokenDetails.symbol,decimals=_useTokenDetails.decimals,exchangeAddress=_useTokenDetails.exchangeAddress;var exchangeContract=useExchangeContract(exchangeAddress);var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),totalPoolTokens=_useState12[0],setTotalPoolTokens=_useState12[1];var fetchPoolTokens=useCallback(function(){if(exchangeContract){exchangeContract.totalSupply().then(function(totalSupply){setTotalPoolTokens(totalSupply);});}},[exchangeContract]);useEffect(function(){fetchPoolTokens();library.on(\"block\",fetchPoolTokens);return function(){library.removeListener(\"block\",fetchPoolTokens);};},[fetchPoolTokens,library]);var poolTokenBalance=useAddressBalance(account,exchangeAddress);var exchangeETHBalance=useAddressBalance(exchangeAddress,\"ETH\");var exchangeTokenBalance=useAddressBalance(exchangeAddress,outputCurrency);var _useExchangeReserves=useExchangeReserves(outputCurrency),reserveETH=_useExchangeReserves.reserveETH,reserveToken=_useExchangeReserves.reserveToken;var isNewExchange=!!(reserveETH&&reserveToken&&reserveETH.isZero()&&reserveToken.isZero());// 18 decimals\nvar poolTokenPercentage=poolTokenBalance&&totalPoolTokens&&isNewExchange===false&&!totalPoolTokens.isZero()?poolTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens):undefined;var ethShare=exchangeETHBalance&&poolTokenPercentage?exchangeETHBalance.mul(poolTokenPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))):undefined;var tokenShare=exchangeTokenBalance&&poolTokenPercentage?exchangeTokenBalance.mul(poolTokenPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))):undefined;var liquidityMinted=isNewExchange?inputValueParsed:totalPoolTokens&&inputValueParsed&&exchangeETHBalance&&!exchangeETHBalance.isZero()?totalPoolTokens.mul(inputValueParsed).div(exchangeETHBalance):undefined;// user balances\nvar inputBalance=useAddressBalance(account,inputCurrency);var outputBalance=useAddressBalance(account,outputCurrency);var ethPerLiquidityToken=exchangeETHBalance&&totalPoolTokens&&isNewExchange===false&&!totalPoolTokens.isZero()?exchangeETHBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens):undefined;var tokenPerLiquidityToken=exchangeTokenBalance&&totalPoolTokens&&isNewExchange===false&&!totalPoolTokens.isZero()?exchangeTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens):undefined;var outputValueMax=outputValueParsed&&calculateSlippageBounds(outputValueParsed).maximum;var liquidityTokensMin=liquidityMinted&&calculateSlippageBounds(liquidityMinted).minimum;var marketRate=useMemo(function(){return getMarketRate(reserveETH,reserveToken,decimals);},[reserveETH,reserveToken,decimals]);var marketRateInverted=useMemo(function(){return getMarketRate(reserveETH,reserveToken,decimals,true);},[reserveETH,reserveToken,decimals]);function renderTransactionDetails(){var b=function b(text){return React.createElement(BlueSpan,null,text);};if(isNewExchange){return React.createElement(\"div\",null,React.createElement(\"div\",null,t(\"youAreAdding\"),\" \",b(\"\".concat(inputValue,\" ETH\")),\" \",t(\"and\"),\" \",b(\"\".concat(outputValue,\" \").concat(symbol)),\" \",t(\"intoPool\")),React.createElement(LastSummaryText,null,t(\"youAreSettingExRate\"),\" \",b(\"1 ETH = \".concat(amountFormatter(getMarketRate(inputValueParsed,outputValueParsed,decimals),18,4,false),\" \").concat(symbol)),\".\"),React.createElement(LastSummaryText,null,t(\"youWillMint\"),\" \",b(\"\".concat(inputValue)),\" \",t(\"liquidityTokens\")),React.createElement(LastSummaryText,null,t(\"totalSupplyIs0\")));}else{return React.createElement(React.Fragment,null,React.createElement(\"div\",null,t(\"youAreAdding\"),\" \",b(\"\".concat(amountFormatter(inputValueParsed,18,4),\" ETH\")),\" \",t(\"and\"),\" \",\"at most\",\" \",b(\"\".concat(amountFormatter(outputValueMax,decimals,Math.min(decimals,4)),\" \").concat(symbol)),\" \",t(\"intoPool\")),React.createElement(LastSummaryText,null,t(\"youWillMint\"),\" \",b(amountFormatter(liquidityMinted,18,4)),\" \",t(\"liquidityTokens\")),React.createElement(LastSummaryText,null,t(\"totalSupplyIs\"),\" \",b(amountFormatter(totalPoolTokens,18,4))),React.createElement(LastSummaryText,null,t(\"tokenWorth\"),\" \",b(amountFormatter(ethPerLiquidityToken,18,4)),\" \",\"ETH \",t(\"and\"),\" \",b(amountFormatter(tokenPerLiquidityToken,decimals,Math.min(decimals,4))),\" \",symbol));}}function renderSummary(){var contextualInfo=\"\";var isError=false;if(brokenTokenWarning){contextualInfo=t(\"brokenToken\");isError=true;}else if(inputError||outputError){contextualInfo=inputError||outputError;isError=true;}else if(!inputCurrency||!outputCurrency){contextualInfo=t(\"selectTokenCont\");}else if(!inputValue){contextualInfo=t(\"enterValueCont\");}else if(!account){contextualInfo=t(\"noWallet\");isError=true;}return React.createElement(ContextualInfo,{openDetailsText:t(\"transactionDetails\"),closeDetailsText:t(\"hideDetails\"),contextualInfo:contextualInfo,isError:isError,renderTransactionDetails:renderTransactionDetails});}var addTransaction=useTransactionAdder();function onAddLiquidity(){return _onAddLiquidity.apply(this,arguments);}function _onAddLiquidity(){_onAddLiquidity=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var usdTransactionSize,deadline,estimatedGasLimit,gasLimit;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// take ETH amount, multiplied by ETH rate and 2 for total tx size\nusdTransactionSize=ethPrice*(inputValueParsed/1e18)*2;// log pool added to and total usd amount\nReactGA.event({category:\"Transaction\",action:\"Add Liquidity\",label:outputCurrency,value:usdTransactionSize});deadline=Math.ceil(Date.now()/1000)+DEADLINE_FROM_NOW;_context.next=5;return exchangeContract.estimate.addLiquidity(isNewExchange?ethers.constants.Zero:liquidityTokensMin,isNewExchange?outputValueParsed:outputValueMax,deadline,{value:inputValueParsed});case 5:estimatedGasLimit=_context.sent;gasLimit=calculateGasMargin(estimatedGasLimit,GAS_MARGIN);exchangeContract.addLiquidity(isNewExchange?ethers.constants.Zero:liquidityTokensMin,isNewExchange?outputValueParsed:outputValueMax,deadline,{value:inputValueParsed,gasLimit:gasLimit}).then(function(response){addTransaction(response);});case 8:case\"end\":return _context.stop();}}},_callee);}));return _onAddLiquidity.apply(this,arguments);}function formatBalance(value){return\"Balance: \".concat(value);}// check for broken tokens\nuseEffect(function(){setBrokenTokenWarning(false);for(var i=0;i<brokenTokens.length;i++){if(brokenTokens[i].toLowerCase()===outputCurrency.toLowerCase()){setBrokenTokenWarning(true);}}},[outputCurrency]);useEffect(function(){if(isNewExchange){if(inputValue){var parsedInputValue=ethers.utils.parseUnits(inputValue,18);setInputValueParsed(parsedInputValue);}if(outputValue){var parsedOutputValue=ethers.utils.parseUnits(outputValue,decimals);setOutputValueParsed(parsedOutputValue);}}},[decimals,inputValue,isNewExchange,outputValue]);// parse input value\nuseEffect(function(){if(isNewExchange===false&&inputValue&&marketRate&&lastEditedField===INPUT&&(decimals||decimals===0)){try{var parsedValue=ethers.utils.parseUnits(inputValue,18);if(parsedValue.lte(ethers.constants.Zero)||parsedValue.gte(ethers.constants.MaxUint256)){throw Error();}setInputValueParsed(parsedValue);var currencyAmount=marketRate.mul(parsedValue).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18-decimals)));setOutputValueParsed(currencyAmount);dispatchAddLiquidityState({type:\"UPDATE_DEPENDENT_VALUE\",payload:{field:OUTPUT,value:amountFormatter(currencyAmount,decimals,Math.min(decimals,4),false)}});return function(){setOutputError();setInputValueParsed();setOutputValueParsed();dispatchAddLiquidityState({type:\"UPDATE_DEPENDENT_VALUE\",payload:{field:OUTPUT,value:\"\"}});};}catch(_unused2){setOutputError(t(\"inputNotValid\"));}}},[inputValue,isNewExchange,lastEditedField,marketRate,decimals,t]);// parse output value\nuseEffect(function(){if(isNewExchange===false&&outputValue&&marketRateInverted&&lastEditedField===OUTPUT&&(decimals||decimals===0)){try{var parsedValue=ethers.utils.parseUnits(outputValue,decimals);if(parsedValue.lte(ethers.constants.Zero)||parsedValue.gte(ethers.constants.MaxUint256)){throw Error();}setOutputValueParsed(parsedValue);var currencyAmount=marketRateInverted.mul(parsedValue).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(decimals)));setInputValueParsed(currencyAmount);dispatchAddLiquidityState({type:\"UPDATE_DEPENDENT_VALUE\",payload:{field:INPUT,value:amountFormatter(currencyAmount,18,4,false)}});return function(){setInputError();setOutputValueParsed();setInputValueParsed();dispatchAddLiquidityState({type:\"UPDATE_DEPENDENT_VALUE\",payload:{field:INPUT,value:\"\"}});};}catch(_unused3){setInputError(t(\"inputNotValid\"));}}},[outputValue,isNewExchange,lastEditedField,marketRateInverted,decimals,t]);// input validation\nuseEffect(function(){if(inputValueParsed&&inputBalance){if(inputValueParsed.gt(inputBalance)){setInputError(t(\"insufficientBalance\"));}else{setInputError(null);}}if(outputValueMax&&outputBalance){if(outputValueMax.gt(outputBalance)){setOutputError(t(\"insufficientBalance\"));}else{setOutputError(null);}}},[inputValueParsed,inputBalance,outputValueMax,outputBalance,t]);var allowance=useAddressAllowance(account,outputCurrency,exchangeAddress);var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),showUnlock=_useState14[0],setShowUnlock=_useState14[1];useEffect(function(){if(outputValueParsed&&allowance){if(allowance.lt(outputValueParsed)){setOutputError(t(\"unlockTokenCont\"));setShowUnlock(true);}return function(){setOutputError();setShowUnlock(false);};}},[outputValueParsed,allowance,t]);var isActive=active&&account;var isValid=(inputError===null||outputError===null)&&!showUnlock&&!brokenTokenWarning;return React.createElement(React.Fragment,null,isNewExchange?React.createElement(NewExchangeWarning,null,React.createElement(NewExchangeWarningText,null,React.createElement(\"span\",{role:\"img\",\"aria-label\":\"first-liquidity\"},\"\\uD83D\\uDEB0\"),\" \",t(\"firstLiquidity\")),React.createElement(NewExchangeWarningText,null,t(\"initialExchangeRate\",{symbol:symbol}))):null,React.createElement(CurrencyInputPanel,{title:t(\"deposit\"),extraText:inputBalance&&formatBalance(amountFormatter(inputBalance,18,4)),onValueChange:function onValueChange(inputValue){dispatchAddLiquidityState({type:\"UPDATE_VALUE\",payload:{value:inputValue,field:INPUT}});},extraTextClickHander:function extraTextClickHander(){if(inputBalance){var valueToSet=inputBalance.sub(ethers.utils.parseEther(\".1\"));if(valueToSet.gt(ethers.constants.Zero)){dispatchAddLiquidityState({type:\"UPDATE_VALUE\",payload:{value:amountFormatter(valueToSet,18,18,false),field:INPUT}});}}},selectedTokenAddress:\"ETH\",value:inputValue,errorMessage:inputError,disableTokenSelect:true}),React.createElement(OversizedPanel,null,React.createElement(DownArrowBackground,null,React.createElement(ColoredWrappedPlus,{active:isActive,alt:\"plus\"}))),React.createElement(CurrencyInputPanel,{title:t(\"deposit\"),description:isNewExchange?\"\":outputValue?\"(\".concat(t(\"estimated\"),\")\"):\"\",extraText:outputBalance&&decimals&&formatBalance(amountFormatter(outputBalance,decimals,Math.min(decimals,4))),selectedTokenAddress:outputCurrency,onCurrencySelected:function onCurrencySelected(outputCurrency){dispatchAddLiquidityState({type:\"SELECT_CURRENCY\",payload:outputCurrency});},onValueChange:function onValueChange(outputValue){dispatchAddLiquidityState({type:\"UPDATE_VALUE\",payload:{value:outputValue,field:OUTPUT}});},extraTextClickHander:function extraTextClickHander(){if(outputBalance){dispatchAddLiquidityState({type:\"UPDATE_VALUE\",payload:{value:amountFormatter(calculateMaxOutputVal(outputBalance),decimals,decimals,false),field:OUTPUT}});}},value:outputValue,showUnlock:showUnlock,errorMessage:outputError}),React.createElement(OversizedPanel,{hideBottom:true},React.createElement(SummaryPanel,null,React.createElement(ExchangeRateWrapper,null,React.createElement(ExchangeRate,null,t(\"exchangeRate\")),React.createElement(\"span\",null,marketRate?\"1 ETH = \".concat(amountFormatter(marketRate,18,4),\" \").concat(symbol):\" - \")),React.createElement(ExchangeRateWrapper,null,React.createElement(ExchangeRate,null,t(\"currentPoolSize\")),React.createElement(\"span\",null,exchangeETHBalance&&exchangeTokenBalance?\"\".concat(amountFormatter(exchangeETHBalance,18,4),\" ETH + \").concat(amountFormatter(exchangeTokenBalance,decimals,Math.min(4,decimals)),\" \").concat(symbol):\" - \")),React.createElement(ExchangeRateWrapper,null,React.createElement(ExchangeRate,null,t(\"yourPoolShare\"),\" (\",exchangeETHBalance&&amountFormatter(poolTokenPercentage,16,2),\"%)\"),React.createElement(\"span\",null,ethShare&&tokenShare?\"\".concat(amountFormatter(ethShare,18,4),\" ETH + \").concat(amountFormatter(tokenShare,decimals,Math.min(4,decimals)),\" \").concat(symbol):\" - \")))),renderSummary(),React.createElement(Flex,null,React.createElement(Button,{disabled:!isValid,onClick:onAddLiquidity},t(\"addLiquidity\"))));}","map":{"version":3,"sources":["/workspace/uniswap-exchange/src/pages/Pool/AddLiquidity.js"],"names":["React","useReducer","useState","useCallback","useEffect","useMemo","useTranslation","createBrowserHistory","ethers","ReactGA","styled","Button","CurrencyInputPanel","OversizedPanel","ContextualInfo","useWeb3React","useExchangeContract","brokenTokens","amountFormatter","calculateGasMargin","useTransactionAdder","useTokenDetails","useAddressBalance","useExchangeReserves","useETHPriceInUSD","useAddressAllowance","INPUT","OUTPUT","ALLOWED_SLIPPAGE","utils","bigNumberify","DEADLINE_FROM_NOW","GAS_MARGIN","BlueSpan","span","theme","royalBlue","NewExchangeWarning","div","NewExchangeWarningText","LastSummaryText","DownArrowBackground","flexRowNoWrap","SummaryPanel","flexColumnNoWrap","ExchangeRateWrapper","doveGray","ExchangeRate","Flex","WrappedPlus","isError","highSlippageWarning","rest","ColoredWrappedPlus","active","chaliceGray","calculateSlippageBounds","value","offset","mul","minimum","sub","maximum","add","lt","constants","Zero","gt","MaxUint256","calculateMaxOutputVal","initialAddLiquidityState","state","inputValue","ethAmountURL","outputValue","tokenAmountURL","lastEditedField","outputCurrency","tokenURL","addLiquidityStateReducer","action","type","payload","field","getExchangeRate","inputDecimals","outputDecimals","invert","factor","pow","getMarketRate","reserveETH","reserveToken","decimals","AddLiquidity","params","t","library","account","ethPrice","history","push","window","location","pathname","ethAmount","tokenAmount","token","addLiquidityState","dispatchAddLiquidityState","inputCurrency","inputValueParsed","setInputValueParsed","outputValueParsed","setOutputValueParsed","inputError","setInputError","outputError","setOutputError","brokenTokenWarning","setBrokenTokenWarning","symbol","exchangeAddress","exchangeContract","totalPoolTokens","setTotalPoolTokens","fetchPoolTokens","totalSupply","then","on","removeListener","poolTokenBalance","exchangeETHBalance","exchangeTokenBalance","isNewExchange","isZero","poolTokenPercentage","undefined","ethShare","tokenShare","liquidityMinted","inputBalance","outputBalance","ethPerLiquidityToken","tokenPerLiquidityToken","outputValueMax","liquidityTokensMin","marketRate","marketRateInverted","renderTransactionDetails","b","text","Math","min","renderSummary","contextualInfo","addTransaction","onAddLiquidity","usdTransactionSize","event","category","label","deadline","ceil","Date","now","estimate","addLiquidity","estimatedGasLimit","gasLimit","response","formatBalance","i","length","toLowerCase","parsedInputValue","parseUnits","parsedOutputValue","parsedValue","lte","gte","Error","currencyAmount","allowance","showUnlock","setShowUnlock","isActive","isValid","valueToSet","parseEther"],"mappings":"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","sourcesContent":["import React, {\n  useReducer,\n  useState,\n  useCallback,\n  useEffect,\n  useMemo\n} from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { createBrowserHistory } from \"history\";\nimport { ethers } from \"ethers\";\nimport ReactGA from \"react-ga\";\nimport styled from \"styled-components\";\n\nimport { Button } from \"../../theme\";\nimport CurrencyInputPanel from \"../../components/CurrencyInputPanel\";\nimport OversizedPanel from \"../../components/OversizedPanel\";\nimport ContextualInfo from \"../../components/ContextualInfo\";\nimport { ReactComponent as Plus } from \"../../assets/images/plus-blue.svg\";\nimport { useWeb3React, useExchangeContract } from \"../../hooks\";\nimport { brokenTokens } from \"../../constants\";\nimport { amountFormatter, calculateGasMargin } from \"../../utils\";\nimport { useTransactionAdder } from \"../../contexts/Transactions\";\nimport { useTokenDetails } from \"../../contexts/Tokens\";\nimport {\n  useAddressBalance,\n  useExchangeReserves,\n  useETHPriceInUSD\n} from \"../../contexts/Balances\";\nimport { useAddressAllowance } from \"../../contexts/Allowances\";\n\nconst INPUT = 0;\nconst OUTPUT = 1;\n\n// denominated in bips\nconst ALLOWED_SLIPPAGE = ethers.utils.bigNumberify(200);\n\n// denominated in seconds\nconst DEADLINE_FROM_NOW = 60 * 15;\n\n// denominated in bips\nconst GAS_MARGIN = ethers.utils.bigNumberify(1000);\n\nconst BlueSpan = styled.span`\n  color: ${({ theme }) => theme.royalBlue};\n`;\n\nconst NewExchangeWarning = styled.div`\n  margin-top: 1rem;\n  padding: 1rem;\n  margin-bottom: 2rem;\n  border: 1px solid rgba($pizazz-orange, 0.4);\n  background-color: rgba($pizazz-orange, 0.1);\n  border-radius: 1rem;\n`;\n\nconst NewExchangeWarningText = styled.div`\n  font-size: 0.75rem;\n  line-height: 1rem;\n  text-align: center;\n\n  :first-child {\n    padding-bottom: 0.3rem;\n    font-weight: 500;\n  }\n`;\n\nconst LastSummaryText = styled.div`\n  margin-top: 1rem;\n`;\n\nconst DownArrowBackground = styled.div`\n  ${({ theme }) => theme.flexRowNoWrap}\n  justify-content: center;\n  align-items: center;\n`;\nconst SummaryPanel = styled.div`\n  ${({ theme }) => theme.flexColumnNoWrap}\n  padding: 1rem 0;\n`;\n\nconst ExchangeRateWrapper = styled.div`\n  ${({ theme }) => theme.flexRowNoWrap};\n  align-items: center;\n  color: ${({ theme }) => theme.doveGray};\n  font-size: 0.75rem;\n  padding: 0.25rem 1rem 0;\n`;\n\nconst ExchangeRate = styled.span`\n  flex: 1 1 auto;\n  width: 0;\n  color: ${({ theme }) => theme.doveGray};\n`;\n\nconst Flex = styled.div`\n  display: flex;\n  justify-content: center;\n  padding: 2rem;\n\n  button {\n    max-width: 20rem;\n  }\n`;\n\nconst WrappedPlus = ({ isError, highSlippageWarning, ...rest }) => (\n  <Plus {...rest} />\n);\nconst ColoredWrappedPlus = styled(WrappedPlus)`\n  width: 0.625rem;\n  height: 0.625rem;\n  position: relative;\n  padding: 0.875rem;\n  path {\n    stroke: ${({ active, theme }) =>\n      active ? theme.royalBlue : theme.chaliceGray};\n  }\n`;\n\nfunction calculateSlippageBounds(value) {\n  if (value) {\n    const offset = value\n      .mul(ALLOWED_SLIPPAGE)\n      .div(ethers.utils.bigNumberify(10000));\n    const minimum = value.sub(offset);\n    const maximum = value.add(offset);\n    return {\n      minimum: minimum.lt(ethers.constants.Zero)\n        ? ethers.constants.Zero\n        : minimum,\n      maximum: maximum.gt(ethers.constants.MaxUint256)\n        ? ethers.constants.MaxUint256\n        : maximum\n    };\n  } else {\n    return {};\n  }\n}\n\nfunction calculateMaxOutputVal(value) {\n  if (value) {\n    return value\n      .mul(ethers.utils.bigNumberify(10000))\n      .div(ALLOWED_SLIPPAGE.add(ethers.utils.bigNumberify(10000)));\n  }\n}\n\nfunction initialAddLiquidityState(state) {\n  return {\n    inputValue: state.ethAmountURL ? state.ethAmountURL : \"\",\n    outputValue:\n      state.tokenAmountURL && !state.ethAmountURL ? state.tokenAmountURL : \"\",\n    lastEditedField:\n      state.tokenAmountURL && state.ethAmountURL === \"\" ? OUTPUT : INPUT,\n    outputCurrency: state.tokenURL ? state.tokenURL : \"\"\n  };\n}\n\nfunction addLiquidityStateReducer(state, action) {\n  switch (action.type) {\n    case \"SELECT_CURRENCY\": {\n      return {\n        ...state,\n        outputCurrency: action.payload\n      };\n    }\n    case \"UPDATE_VALUE\": {\n      const { inputValue, outputValue } = state;\n      const { field, value } = action.payload;\n      return {\n        ...state,\n        inputValue: field === INPUT ? value : inputValue,\n        outputValue: field === OUTPUT ? value : outputValue,\n        lastEditedField: field\n      };\n    }\n    case \"UPDATE_DEPENDENT_VALUE\": {\n      const { inputValue, outputValue } = state;\n      const { field, value } = action.payload;\n      return {\n        ...state,\n        inputValue: field === INPUT ? value : inputValue,\n        outputValue: field === OUTPUT ? value : outputValue\n      };\n    }\n    default: {\n      return initialAddLiquidityState();\n    }\n  }\n}\n\nfunction getExchangeRate(\n  inputValue,\n  inputDecimals,\n  outputValue,\n  outputDecimals,\n  invert = false\n) {\n  try {\n    if (\n      inputValue &&\n      (inputDecimals || inputDecimals === 0) &&\n      outputValue &&\n      (outputDecimals || outputDecimals === 0)\n    ) {\n      const factor = ethers.utils\n        .bigNumberify(10)\n        .pow(ethers.utils.bigNumberify(18));\n\n      if (invert) {\n        return inputValue\n          .mul(factor)\n          .div(outputValue)\n          .mul(\n            ethers.utils\n              .bigNumberify(10)\n              .pow(ethers.utils.bigNumberify(outputDecimals))\n          )\n          .div(\n            ethers.utils\n              .bigNumberify(10)\n              .pow(ethers.utils.bigNumberify(inputDecimals))\n          );\n      } else {\n        return outputValue\n          .mul(factor)\n          .div(inputValue)\n          .mul(\n            ethers.utils\n              .bigNumberify(10)\n              .pow(ethers.utils.bigNumberify(inputDecimals))\n          )\n          .div(\n            ethers.utils\n              .bigNumberify(10)\n              .pow(ethers.utils.bigNumberify(outputDecimals))\n          );\n      }\n    }\n  } catch {}\n}\n\nfunction getMarketRate(reserveETH, reserveToken, decimals, invert = false) {\n  return getExchangeRate(reserveETH, 18, reserveToken, decimals, invert);\n}\n\nexport default function AddLiquidity({ params }) {\n  const { t } = useTranslation();\n  const { library, account, active } = useWeb3React();\n\n  // BigNumber.js instance\n  const ethPrice = useETHPriceInUSD();\n\n  // clear url of query\n  useEffect(() => {\n    const history = createBrowserHistory();\n    history.push(window.location.pathname + \"\");\n  }, []);\n\n  const [addLiquidityState, dispatchAddLiquidityState] = useReducer(\n    addLiquidityStateReducer,\n    {\n      ethAmountURL: params.ethAmount,\n      tokenAmountURL: params.tokenAmount,\n      tokenURL: params.token\n    },\n    initialAddLiquidityState\n  );\n  const {\n    inputValue,\n    outputValue,\n    lastEditedField,\n    outputCurrency\n  } = addLiquidityState;\n  const inputCurrency = \"ETH\";\n\n  const [inputValueParsed, setInputValueParsed] = useState();\n  const [outputValueParsed, setOutputValueParsed] = useState();\n  const [inputError, setInputError] = useState();\n  const [outputError, setOutputError] = useState();\n\n  const [brokenTokenWarning, setBrokenTokenWarning] = useState();\n\n  const { symbol, decimals, exchangeAddress } = useTokenDetails(outputCurrency);\n  const exchangeContract = useExchangeContract(exchangeAddress);\n\n  const [totalPoolTokens, setTotalPoolTokens] = useState();\n  const fetchPoolTokens = useCallback(() => {\n    if (exchangeContract) {\n      exchangeContract.totalSupply().then(totalSupply => {\n        setTotalPoolTokens(totalSupply);\n      });\n    }\n  }, [exchangeContract]);\n  useEffect(() => {\n    fetchPoolTokens();\n    library.on(\"block\", fetchPoolTokens);\n\n    return () => {\n      library.removeListener(\"block\", fetchPoolTokens);\n    };\n  }, [fetchPoolTokens, library]);\n\n  const poolTokenBalance = useAddressBalance(account, exchangeAddress);\n  const exchangeETHBalance = useAddressBalance(exchangeAddress, \"ETH\");\n  const exchangeTokenBalance = useAddressBalance(\n    exchangeAddress,\n    outputCurrency\n  );\n\n  const { reserveETH, reserveToken } = useExchangeReserves(outputCurrency);\n  const isNewExchange = !!(\n    reserveETH &&\n    reserveToken &&\n    reserveETH.isZero() &&\n    reserveToken.isZero()\n  );\n\n  // 18 decimals\n  const poolTokenPercentage =\n    poolTokenBalance &&\n    totalPoolTokens &&\n    isNewExchange === false &&\n    !totalPoolTokens.isZero()\n      ? poolTokenBalance\n          .mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n          .div(totalPoolTokens)\n      : undefined;\n  const ethShare =\n    exchangeETHBalance && poolTokenPercentage\n      ? exchangeETHBalance\n          .mul(poolTokenPercentage)\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n      : undefined;\n  const tokenShare =\n    exchangeTokenBalance && poolTokenPercentage\n      ? exchangeTokenBalance\n          .mul(poolTokenPercentage)\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n      : undefined;\n\n  const liquidityMinted = isNewExchange\n    ? inputValueParsed\n    : totalPoolTokens &&\n      inputValueParsed &&\n      exchangeETHBalance &&\n      !exchangeETHBalance.isZero()\n    ? totalPoolTokens.mul(inputValueParsed).div(exchangeETHBalance)\n    : undefined;\n\n  // user balances\n  const inputBalance = useAddressBalance(account, inputCurrency);\n  const outputBalance = useAddressBalance(account, outputCurrency);\n\n  const ethPerLiquidityToken =\n    exchangeETHBalance &&\n    totalPoolTokens &&\n    isNewExchange === false &&\n    !totalPoolTokens.isZero()\n      ? exchangeETHBalance\n          .mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n          .div(totalPoolTokens)\n      : undefined;\n  const tokenPerLiquidityToken =\n    exchangeTokenBalance &&\n    totalPoolTokens &&\n    isNewExchange === false &&\n    !totalPoolTokens.isZero()\n      ? exchangeTokenBalance\n          .mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n          .div(totalPoolTokens)\n      : undefined;\n\n  const outputValueMax =\n    outputValueParsed && calculateSlippageBounds(outputValueParsed).maximum;\n  const liquidityTokensMin =\n    liquidityMinted && calculateSlippageBounds(liquidityMinted).minimum;\n\n  const marketRate = useMemo(() => {\n    return getMarketRate(reserveETH, reserveToken, decimals);\n  }, [reserveETH, reserveToken, decimals]);\n  const marketRateInverted = useMemo(() => {\n    return getMarketRate(reserveETH, reserveToken, decimals, true);\n  }, [reserveETH, reserveToken, decimals]);\n\n  function renderTransactionDetails() {\n    const b = text => <BlueSpan>{text}</BlueSpan>;\n\n    if (isNewExchange) {\n      return (\n        <div>\n          <div>\n            {t(\"youAreAdding\")} {b(`${inputValue} ETH`)} {t(\"and\")}{\" \"}\n            {b(`${outputValue} ${symbol}`)} {t(\"intoPool\")}\n          </div>\n          <LastSummaryText>\n            {t(\"youAreSettingExRate\")}{\" \"}\n            {b(\n              `1 ETH = ${amountFormatter(\n                getMarketRate(inputValueParsed, outputValueParsed, decimals),\n                18,\n                4,\n                false\n              )} ${symbol}`\n            )}\n            .\n          </LastSummaryText>\n          <LastSummaryText>\n            {t(\"youWillMint\")} {b(`${inputValue}`)} {t(\"liquidityTokens\")}\n          </LastSummaryText>\n          <LastSummaryText>{t(\"totalSupplyIs0\")}</LastSummaryText>\n        </div>\n      );\n    } else {\n      return (\n        <>\n          <div>\n            {t(\"youAreAdding\")}{\" \"}\n            {b(`${amountFormatter(inputValueParsed, 18, 4)} ETH`)} {t(\"and\")}{\" \"}\n            {\"at most\"}{\" \"}\n            {b(\n              `${amountFormatter(\n                outputValueMax,\n                decimals,\n                Math.min(decimals, 4)\n              )} ${symbol}`\n            )}{\" \"}\n            {t(\"intoPool\")}\n          </div>\n          <LastSummaryText>\n            {t(\"youWillMint\")} {b(amountFormatter(liquidityMinted, 18, 4))}{\" \"}\n            {t(\"liquidityTokens\")}\n          </LastSummaryText>\n          <LastSummaryText>\n            {t(\"totalSupplyIs\")} {b(amountFormatter(totalPoolTokens, 18, 4))}\n          </LastSummaryText>\n          <LastSummaryText>\n            {t(\"tokenWorth\")} {b(amountFormatter(ethPerLiquidityToken, 18, 4))}{\" \"}\n            ETH {t(\"and\")}{\" \"}\n            {b(\n              amountFormatter(\n                tokenPerLiquidityToken,\n                decimals,\n                Math.min(decimals, 4)\n              )\n            )}{\" \"}\n            {symbol}\n          </LastSummaryText>\n        </>\n      );\n    }\n  }\n\n  function renderSummary() {\n    let contextualInfo = \"\";\n    let isError = false;\n    if (brokenTokenWarning) {\n      contextualInfo = t(\"brokenToken\");\n      isError = true;\n    } else if (inputError || outputError) {\n      contextualInfo = inputError || outputError;\n      isError = true;\n    } else if (!inputCurrency || !outputCurrency) {\n      contextualInfo = t(\"selectTokenCont\");\n    } else if (!inputValue) {\n      contextualInfo = t(\"enterValueCont\");\n    } else if (!account) {\n      contextualInfo = t(\"noWallet\");\n      isError = true;\n    }\n\n    return (\n      <ContextualInfo\n        openDetailsText={t(\"transactionDetails\")}\n        closeDetailsText={t(\"hideDetails\")}\n        contextualInfo={contextualInfo}\n        isError={isError}\n        renderTransactionDetails={renderTransactionDetails}\n      />\n    );\n  }\n\n  const addTransaction = useTransactionAdder();\n\n  async function onAddLiquidity() {\n    // take ETH amount, multiplied by ETH rate and 2 for total tx size\n    let usdTransactionSize = ethPrice * (inputValueParsed / 1e18) * 2;\n\n    // log pool added to and total usd amount\n    ReactGA.event({\n      category: \"Transaction\",\n      action: \"Add Liquidity\",\n      label: outputCurrency,\n      value: usdTransactionSize\n    });\n\n    const deadline = Math.ceil(Date.now() / 1000) + DEADLINE_FROM_NOW;\n\n    const estimatedGasLimit = await exchangeContract.estimate.addLiquidity(\n      isNewExchange ? ethers.constants.Zero : liquidityTokensMin,\n      isNewExchange ? outputValueParsed : outputValueMax,\n      deadline,\n      {\n        value: inputValueParsed\n      }\n    );\n\n    const gasLimit = calculateGasMargin(estimatedGasLimit, GAS_MARGIN);\n\n    exchangeContract\n      .addLiquidity(\n        isNewExchange ? ethers.constants.Zero : liquidityTokensMin,\n        isNewExchange ? outputValueParsed : outputValueMax,\n        deadline,\n        {\n          value: inputValueParsed,\n          gasLimit\n        }\n      )\n      .then(response => {\n        addTransaction(response);\n      });\n  }\n\n  function formatBalance(value) {\n    return `Balance: ${value}`;\n  } // check for broken tokens\n\n  useEffect(() => {\n    setBrokenTokenWarning(false);\n    for (let i = 0; i < brokenTokens.length; i++) {\n      if (brokenTokens[i].toLowerCase() === outputCurrency.toLowerCase()) {\n        setBrokenTokenWarning(true);\n      }\n    }\n  }, [outputCurrency]);\n\n  useEffect(() => {\n    if (isNewExchange) {\n      if (inputValue) {\n        const parsedInputValue = ethers.utils.parseUnits(inputValue, 18);\n        setInputValueParsed(parsedInputValue);\n      }\n\n      if (outputValue) {\n        const parsedOutputValue = ethers.utils.parseUnits(\n          outputValue,\n          decimals\n        );\n        setOutputValueParsed(parsedOutputValue);\n      }\n    }\n  }, [decimals, inputValue, isNewExchange, outputValue]);\n\n  // parse input value\n  useEffect(() => {\n    if (\n      isNewExchange === false &&\n      inputValue &&\n      marketRate &&\n      lastEditedField === INPUT &&\n      (decimals || decimals === 0)\n    ) {\n      try {\n        const parsedValue = ethers.utils.parseUnits(inputValue, 18);\n\n        if (\n          parsedValue.lte(ethers.constants.Zero) ||\n          parsedValue.gte(ethers.constants.MaxUint256)\n        ) {\n          throw Error();\n        }\n\n        setInputValueParsed(parsedValue);\n\n        const currencyAmount = marketRate\n          .mul(parsedValue)\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n          .div(\n            ethers.utils\n              .bigNumberify(10)\n              .pow(ethers.utils.bigNumberify(18 - decimals))\n          );\n\n        setOutputValueParsed(currencyAmount);\n        dispatchAddLiquidityState({\n          type: \"UPDATE_DEPENDENT_VALUE\",\n          payload: {\n            field: OUTPUT,\n            value: amountFormatter(\n              currencyAmount,\n              decimals,\n              Math.min(decimals, 4),\n              false\n            )\n          }\n        });\n\n        return () => {\n          setOutputError();\n          setInputValueParsed();\n          setOutputValueParsed();\n          dispatchAddLiquidityState({\n            type: \"UPDATE_DEPENDENT_VALUE\",\n            payload: { field: OUTPUT, value: \"\" }\n          });\n        };\n      } catch {\n        setOutputError(t(\"inputNotValid\"));\n      }\n    }\n  }, [inputValue, isNewExchange, lastEditedField, marketRate, decimals, t]);\n\n  // parse output value\n  useEffect(() => {\n    if (\n      isNewExchange === false &&\n      outputValue &&\n      marketRateInverted &&\n      lastEditedField === OUTPUT &&\n      (decimals || decimals === 0)\n    ) {\n      try {\n        const parsedValue = ethers.utils.parseUnits(outputValue, decimals);\n\n        if (\n          parsedValue.lte(ethers.constants.Zero) ||\n          parsedValue.gte(ethers.constants.MaxUint256)\n        ) {\n          throw Error();\n        }\n\n        setOutputValueParsed(parsedValue);\n\n        const currencyAmount = marketRateInverted\n          .mul(parsedValue)\n          .div(\n            ethers.utils\n              .bigNumberify(10)\n              .pow(ethers.utils.bigNumberify(decimals))\n          );\n\n        setInputValueParsed(currencyAmount);\n        dispatchAddLiquidityState({\n          type: \"UPDATE_DEPENDENT_VALUE\",\n          payload: {\n            field: INPUT,\n            value: amountFormatter(currencyAmount, 18, 4, false)\n          }\n        });\n\n        return () => {\n          setInputError();\n          setOutputValueParsed();\n          setInputValueParsed();\n          dispatchAddLiquidityState({\n            type: \"UPDATE_DEPENDENT_VALUE\",\n            payload: { field: INPUT, value: \"\" }\n          });\n        };\n      } catch {\n        setInputError(t(\"inputNotValid\"));\n      }\n    }\n  }, [\n    outputValue,\n    isNewExchange,\n    lastEditedField,\n    marketRateInverted,\n    decimals,\n    t\n  ]);\n\n  // input validation\n  useEffect(() => {\n    if (inputValueParsed && inputBalance) {\n      if (inputValueParsed.gt(inputBalance)) {\n        setInputError(t(\"insufficientBalance\"));\n      } else {\n        setInputError(null);\n      }\n    }\n\n    if (outputValueMax && outputBalance) {\n      if (outputValueMax.gt(outputBalance)) {\n        setOutputError(t(\"insufficientBalance\"));\n      } else {\n        setOutputError(null);\n      }\n    }\n  }, [inputValueParsed, inputBalance, outputValueMax, outputBalance, t]);\n\n  const allowance = useAddressAllowance(\n    account,\n    outputCurrency,\n    exchangeAddress\n  );\n\n  const [showUnlock, setShowUnlock] = useState(false);\n  useEffect(() => {\n    if (outputValueParsed && allowance) {\n      if (allowance.lt(outputValueParsed)) {\n        setOutputError(t(\"unlockTokenCont\"));\n        setShowUnlock(true);\n      }\n      return () => {\n        setOutputError();\n        setShowUnlock(false);\n      };\n    }\n  }, [outputValueParsed, allowance, t]);\n\n  const isActive = active && account;\n  const isValid =\n    (inputError === null || outputError === null) &&\n    !showUnlock &&\n    !brokenTokenWarning;\n\n  return (\n    <>\n      {isNewExchange ? (\n        <NewExchangeWarning>\n          <NewExchangeWarningText>\n            <span role=\"img\" aria-label=\"first-liquidity\">\n              🚰\n            </span>{\" \"}\n            {t(\"firstLiquidity\")}\n          </NewExchangeWarningText>\n          <NewExchangeWarningText>\n            {t(\"initialExchangeRate\", { symbol })}\n          </NewExchangeWarningText>\n        </NewExchangeWarning>\n      ) : null}\n\n      <CurrencyInputPanel\n        title={t(\"deposit\")}\n        extraText={\n          inputBalance && formatBalance(amountFormatter(inputBalance, 18, 4))\n        }\n        onValueChange={inputValue => {\n          dispatchAddLiquidityState({\n            type: \"UPDATE_VALUE\",\n            payload: { value: inputValue, field: INPUT }\n          });\n        }}\n        extraTextClickHander={() => {\n          if (inputBalance) {\n            const valueToSet = inputBalance.sub(ethers.utils.parseEther(\".1\"));\n            if (valueToSet.gt(ethers.constants.Zero)) {\n              dispatchAddLiquidityState({\n                type: \"UPDATE_VALUE\",\n                payload: {\n                  value: amountFormatter(valueToSet, 18, 18, false),\n                  field: INPUT\n                }\n              });\n            }\n          }\n        }}\n        selectedTokenAddress=\"ETH\"\n        value={inputValue}\n        errorMessage={inputError}\n        disableTokenSelect\n      />\n      <OversizedPanel>\n        <DownArrowBackground>\n          <ColoredWrappedPlus active={isActive} alt=\"plus\" />\n        </DownArrowBackground>\n      </OversizedPanel>\n      <CurrencyInputPanel\n        title={t(\"deposit\")}\n        description={\n          isNewExchange ? \"\" : outputValue ? `(${t(\"estimated\")})` : \"\"\n        }\n        extraText={\n          outputBalance &&\n          decimals &&\n          formatBalance(\n            amountFormatter(outputBalance, decimals, Math.min(decimals, 4))\n          )\n        }\n        selectedTokenAddress={outputCurrency}\n        onCurrencySelected={outputCurrency => {\n          dispatchAddLiquidityState({\n            type: \"SELECT_CURRENCY\",\n            payload: outputCurrency\n          });\n        }}\n        onValueChange={outputValue => {\n          dispatchAddLiquidityState({\n            type: \"UPDATE_VALUE\",\n            payload: { value: outputValue, field: OUTPUT }\n          });\n        }}\n        extraTextClickHander={() => {\n          if (outputBalance) {\n            dispatchAddLiquidityState({\n              type: \"UPDATE_VALUE\",\n              payload: {\n                value: amountFormatter(\n                  calculateMaxOutputVal(outputBalance),\n                  decimals,\n                  decimals,\n                  false\n                ),\n                field: OUTPUT\n              }\n            });\n          }\n        }}\n        value={outputValue}\n        showUnlock={showUnlock}\n        errorMessage={outputError}\n      />\n      <OversizedPanel hideBottom>\n        <SummaryPanel>\n          <ExchangeRateWrapper>\n            <ExchangeRate>{t(\"exchangeRate\")}</ExchangeRate>\n            <span>\n              {marketRate\n                ? `1 ETH = ${amountFormatter(marketRate, 18, 4)} ${symbol}`\n                : \" - \"}\n            </span>\n          </ExchangeRateWrapper>\n          <ExchangeRateWrapper>\n            <ExchangeRate>{t(\"currentPoolSize\")}</ExchangeRate>\n            <span>\n              {exchangeETHBalance && exchangeTokenBalance\n                ? `${amountFormatter(\n                    exchangeETHBalance,\n                    18,\n                    4\n                  )} ETH + ${amountFormatter(\n                    exchangeTokenBalance,\n                    decimals,\n                    Math.min(4, decimals)\n                  )} ${symbol}`\n                : \" - \"}\n            </span>\n          </ExchangeRateWrapper>\n          <ExchangeRateWrapper>\n            <ExchangeRate>\n              {t(\"yourPoolShare\")} (\n              {exchangeETHBalance &&\n                amountFormatter(poolTokenPercentage, 16, 2)}\n              %)\n            </ExchangeRate>\n            <span>\n              {ethShare && tokenShare\n                ? `${amountFormatter(ethShare, 18, 4)} ETH + ${amountFormatter(\n                    tokenShare,\n                    decimals,\n                    Math.min(4, decimals)\n                  )} ${symbol}`\n                : \" - \"}\n            </span>\n          </ExchangeRateWrapper>\n        </SummaryPanel>\n      </OversizedPanel>\n      {renderSummary()}\n      <Flex>\n        <Button disabled={!isValid} onClick={onAddLiquidity}>\n          {t(\"addLiquidity\")}\n        </Button>\n      </Flex>\n    </>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}