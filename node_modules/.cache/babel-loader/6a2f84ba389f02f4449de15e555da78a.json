{"ast":null,"code":"\"use strict\"; // Copyright (c) 2018-2019 Coinbase, Inc. <https://coinbase.com/>\n// Licensed under the Apache License, version 2.0\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst bn_js_1 = __importDefault(require(\"bn.js\"));\n\nconst eth_eip712_util_1 = __importDefault(require(\"eth-eip712-util\"));\n\nconst events_1 = require(\"events\");\n\nconst FilterPolyfill_1 = require(\"./FilterPolyfill\");\n\nconst JSONRPC_1 = require(\"./types/JSONRPC\");\n\nconst Web3Provider_1 = require(\"./types/Web3Provider\");\n\nconst util_1 = require(\"./util\");\n\nconst LOCAL_STORAGE_ADDRESSES_KEY = \"Addresses\";\n\nclass WalletLinkProvider extends events_1.EventEmitter {\n  constructor(options) {\n    super();\n    this._filterPolyfill = new FilterPolyfill_1.FilterPolyfill(this);\n    this._addresses = [];\n    this._send = this.send;\n    this._sendAsync = this.sendAsync;\n\n    if (!options.relay) {\n      throw new Error(\"realy must be provided\");\n    }\n\n    if (!options.jsonRpcUrl) {\n      throw new Error(\"jsonRpcUrl must be provided\");\n    }\n\n    this._relay = options.relay;\n    this._chainId = util_1.ensureIntNumber(options.chainId || 1);\n    this._jsonRpcUrl = options.jsonRpcUrl;\n\n    const cahedAddresses = this._relay.getStorageItem(LOCAL_STORAGE_ADDRESSES_KEY);\n\n    if (cahedAddresses) {\n      const addresses = cahedAddresses.split(\" \");\n\n      if (addresses[0] !== \"\") {\n        this._addresses = addresses;\n      }\n    }\n  }\n\n  get selectedAddress() {\n    return this._addresses[0] || undefined;\n  }\n\n  get networkVersion() {\n    return this._chainId.toString(10);\n  }\n\n  get isWalletLink() {\n    return true;\n  }\n\n  get host() {\n    return this._jsonRpcUrl;\n  }\n\n  get connected() {\n    return true;\n  }\n\n  isConnected() {\n    return true;\n  }\n\n  async enable() {\n    if (this._addresses.length > 0) {\n      return this._addresses;\n    }\n\n    return await this._send(JSONRPC_1.JSONRPCMethod.eth_requestAccounts);\n  }\n\n  send(requestOrMethod, callbackOrParams) {\n    // send<T>(method, params): Promise<T>\n    if (typeof requestOrMethod === \"string\") {\n      const method = requestOrMethod;\n      const params = Array.isArray(callbackOrParams) ? callbackOrParams : callbackOrParams !== undefined ? [callbackOrParams] : [];\n      const request = {\n        jsonrpc: \"2.0\",\n        id: 1,\n        method,\n        params\n      };\n      return this._sendRequestAsync(request).then(res => res.result);\n    } // send(JSONRPCRequest | JSONRPCRequest[], callback): void\n\n\n    if (typeof callbackOrParams === \"function\") {\n      const request = requestOrMethod;\n      const callback = callbackOrParams;\n      return this._sendAsync(request, callback);\n    } // send(JSONRPCRequest[]): JSONRPCResponse[]\n\n\n    if (Array.isArray(requestOrMethod)) {\n      const requests = requestOrMethod;\n      return requests.map(r => this._sendRequest(r));\n    } // send(JSONRPCRequest): JSONRPCResponse\n\n\n    const req = requestOrMethod;\n    return this._sendRequest(req);\n  }\n\n  sendAsync(request, callback) {\n    if (typeof callback !== \"function\") {\n      throw new Error(\"callback is required\");\n    } // send(JSONRPCRequest[], callback): void\n\n\n    if (Array.isArray(request)) {\n      const arrayCb = callback;\n\n      this._sendMultipleRequestsAsync(request).then(responses => arrayCb(null, responses)).catch(err => arrayCb(err, null));\n\n      return;\n    } // send(JSONRPCRequest, callback): void\n\n\n    const cb = callback;\n\n    this._sendRequestAsync(request).then(response => cb(null, response)).catch(err => cb(err, null));\n  }\n\n  async scanQRCode(match) {\n    const res = await this._relay.scanQRCode(util_1.ensureRegExpString(match));\n\n    if (typeof res.result !== \"string\") {\n      throw new Error(\"result was not a string\");\n    }\n\n    return res.result;\n  }\n\n  async arbitraryRequest(data) {\n    const res = await this._relay.arbitraryRequest(data);\n\n    if (typeof res.result !== \"string\") {\n      throw new Error(\"result was not a string\");\n    }\n\n    return res.result;\n  }\n\n  supportsSubscriptions() {\n    return false;\n  }\n\n  subscribe() {\n    throw new Error(\"Subscriptions are not supported\");\n  }\n\n  unsubscribe() {\n    throw new Error(\"Subscriptions are not supported\");\n  }\n\n  disconnect() {\n    return true;\n  }\n\n  _sendRequest(request) {\n    const response = {\n      jsonrpc: \"2.0\",\n      id: request.id\n    };\n    const {\n      method\n    } = request;\n    response.result = this._handleSynchronousMethods(request);\n\n    if (response.result === undefined) {\n      throw new Error(`WalletLink does not support calling ${method} synchronously without ` + `a callback. Please provide a callback parameter to call ${method} ` + `asynchronously.`);\n    }\n\n    return response;\n  }\n\n  _setAddresses(addresses) {\n    if (!Array.isArray(addresses)) {\n      throw new Error(\"addresses is not an array\");\n    }\n\n    this._addresses = addresses.map(address => util_1.ensureAddressString(address));\n\n    this._relay.setStorageItem(LOCAL_STORAGE_ADDRESSES_KEY, addresses.join(\" \"));\n\n    this.emit(\"accountsChanged\", this._addresses);\n  }\n\n  _sendRequestAsync(request) {\n    return new Promise((resolve, reject) => {\n      try {\n        const syncResult = this._handleSynchronousMethods(request);\n\n        if (syncResult !== undefined) {\n          return resolve({\n            jsonrpc: \"2.0\",\n            id: request.id,\n            result: syncResult\n          });\n        }\n\n        const filterPromise = this._handleAsynchronousFilterMethods(request);\n\n        if (filterPromise !== undefined) {\n          filterPromise.then(res => resolve(Object.assign({}, res, {\n            id: request.id\n          }))).catch(err => reject(err));\n          return;\n        }\n      } catch (err) {\n        return reject(err);\n      }\n\n      this._handleAsynchronousMethods(request).then(res => resolve(Object.assign({}, res, {\n        id: request.id\n      }))).catch(err => reject(err));\n    });\n  }\n\n  _sendMultipleRequestsAsync(requests) {\n    return Promise.all(requests.map(r => this._sendRequestAsync(r)));\n  }\n\n  _handleSynchronousMethods(request) {\n    const {\n      method\n    } = request;\n    const params = request.params || [];\n\n    switch (method) {\n      case JSONRPC_1.JSONRPCMethod.eth_accounts:\n        return this._eth_accounts();\n\n      case JSONRPC_1.JSONRPCMethod.eth_coinbase:\n        return this._eth_coinbase();\n\n      case JSONRPC_1.JSONRPCMethod.eth_uninstallFilter:\n        return this._eth_uninstallFilter(params);\n\n      case JSONRPC_1.JSONRPCMethod.net_version:\n        return this._net_version();\n\n      default:\n        return undefined;\n    }\n  }\n\n  _handleAsynchronousMethods(request) {\n    const {\n      method\n    } = request;\n    const params = request.params || [];\n\n    switch (method) {\n      case JSONRPC_1.JSONRPCMethod.eth_requestAccounts:\n        return this._eth_requestAccounts();\n\n      case JSONRPC_1.JSONRPCMethod.eth_sign:\n        return this._eth_sign(params);\n\n      case JSONRPC_1.JSONRPCMethod.eth_ecRecover:\n        return this._eth_ecRecover(params);\n\n      case JSONRPC_1.JSONRPCMethod.personal_sign:\n        return this._personal_sign(params);\n\n      case JSONRPC_1.JSONRPCMethod.personal_ecRecover:\n        return this._personal_ecRecover(params);\n\n      case JSONRPC_1.JSONRPCMethod.eth_signTransaction:\n        return this._eth_signTransaction(params);\n\n      case JSONRPC_1.JSONRPCMethod.eth_sendRawTransaction:\n        return this._eth_sendRawTransaction(params);\n\n      case JSONRPC_1.JSONRPCMethod.eth_sendTransaction:\n        return this._eth_sendTransaction(params);\n\n      case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v1:\n        return this._eth_signTypedData_v1(params);\n\n      case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v2:\n        return this._throwUnsupportedMethodError();\n\n      case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v3:\n        return this._eth_signTypedData_v3(params);\n\n      case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v4:\n      case JSONRPC_1.JSONRPCMethod.eth_signTypedData:\n        return this._eth_signTypedData_v4(params);\n\n      case JSONRPC_1.JSONRPCMethod.walletlink_arbitrary:\n        return this._walletlink_arbitrary(params);\n    }\n\n    return window.fetch(this._jsonRpcUrl, {\n      method: \"POST\",\n      body: JSON.stringify(request),\n      mode: \"cors\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(res => res.json()).then(json => {\n      if (!json) {\n        throw new Web3Provider_1.ProviderError(\"unexpected response\");\n      }\n\n      const response = json;\n      const {\n        error\n      } = response;\n\n      if (error) {\n        throw new Web3Provider_1.ProviderError(error.message || \"RPC Error\", error.code, error.data);\n      }\n\n      return response;\n    });\n  }\n\n  _handleAsynchronousFilterMethods(request) {\n    const {\n      method\n    } = request;\n    const params = request.params || [];\n\n    switch (method) {\n      case JSONRPC_1.JSONRPCMethod.eth_newFilter:\n        return this._eth_newFilter(params);\n\n      case JSONRPC_1.JSONRPCMethod.eth_newBlockFilter:\n        return this._eth_newBlockFilter();\n\n      case JSONRPC_1.JSONRPCMethod.eth_newPendingTransactionFilter:\n        return this._eth_newPendingTransactionFilter();\n\n      case JSONRPC_1.JSONRPCMethod.eth_getFilterChanges:\n        return this._eth_getFilterChanges(params);\n\n      case JSONRPC_1.JSONRPCMethod.eth_getFilterLogs:\n        return this._eth_getFilterLogs(params);\n    }\n\n    return undefined;\n  }\n\n  _isKnownAddress(addressString) {\n    try {\n      const address = util_1.ensureAddressString(addressString);\n      return this._addresses.includes(address);\n    } catch (_a) {}\n\n    return false;\n  }\n\n  _ensureKnownAddress(addressString) {\n    if (!this._isKnownAddress(addressString)) {\n      throw new Error(\"Unknown Ethereum address\");\n    }\n  }\n\n  _prepareTransactionParams(tx) {\n    const fromAddress = tx.from ? util_1.ensureAddressString(tx.from) : this.selectedAddress;\n\n    if (!fromAddress) {\n      throw new Error(\"Ethereum address is unavailable\");\n    }\n\n    this._ensureKnownAddress(fromAddress);\n\n    const toAddress = tx.to ? util_1.ensureAddressString(tx.to) : null;\n    const weiValue = tx.value != null ? util_1.ensureBN(tx.value) : new bn_js_1.default(0);\n    const data = tx.data ? util_1.ensureBuffer(tx.data) : Buffer.alloc(0);\n    const nonce = tx.nonce != null ? util_1.ensureIntNumber(tx.nonce) : null;\n    const gasPriceInWei = tx.gasPrice != null ? util_1.ensureBN(tx.gasPrice) : null;\n    const gasLimit = tx.gas != null ? util_1.ensureBN(tx.gas) : null;\n    const chainId = this._chainId;\n    return {\n      fromAddress,\n      toAddress,\n      weiValue,\n      data,\n      nonce,\n      gasPriceInWei,\n      gasLimit,\n      chainId\n    };\n  }\n\n  _requireAuthorization() {\n    if (this._addresses.length === 0) {\n      throw new Web3Provider_1.ProviderError(\"Unauthorized\", Web3Provider_1.ProviderErrorCode.UNAUTHORIZED);\n    }\n  }\n\n  _throwUnsupportedMethodError() {\n    throw new Web3Provider_1.ProviderError(\"Unsupported method\", Web3Provider_1.ProviderErrorCode.UNSUPPORTED_METHOD);\n  }\n\n  async _signEthereumMessage(message, address, addPrefix, typedDataJson) {\n    this._ensureKnownAddress(address);\n\n    try {\n      const res = await this._relay.signEthereumMessage(message, address, addPrefix, typedDataJson);\n      return {\n        jsonrpc: \"2.0\",\n        id: 0,\n        result: res.result\n      };\n    } catch (err) {\n      if (typeof err.message === \"string\" && err.message.match(/(denied|rejected)/i)) {\n        throw new Web3Provider_1.ProviderError(\"User denied message signature\", Web3Provider_1.ProviderErrorCode.USER_DENIED_REQUEST_SIGNATURE);\n      }\n\n      throw err;\n    }\n  }\n\n  async _ethereumAddressFromSignedMessage(message, signature, addPrefix) {\n    const res = await this._relay.ethereumAddressFromSignedMessage(message, signature, addPrefix);\n    return {\n      jsonrpc: \"2.0\",\n      id: 0,\n      result: res.result\n    };\n  }\n\n  _eth_accounts() {\n    return this._addresses;\n  }\n\n  _eth_coinbase() {\n    return this.selectedAddress || null;\n  }\n\n  _net_version() {\n    return this._chainId.toString(10);\n  }\n\n  async _eth_requestAccounts() {\n    if (this._addresses.length > 0) {\n      return Promise.resolve({\n        jsonrpc: \"2.0\",\n        id: 0,\n        result: this._addresses\n      });\n    }\n\n    let res;\n\n    try {\n      res = await this._relay.requestEthereumAccounts();\n    } catch (err) {\n      if (typeof err.message === \"string\" && err.message.match(/(denied|rejected)/i)) {\n        throw new Web3Provider_1.ProviderError(\"User denied account authorization\", Web3Provider_1.ProviderErrorCode.USER_DENIED_REQUEST_ACCOUNTS);\n      }\n\n      throw err;\n    }\n\n    if (!res.result) {\n      throw new Error(\"accounts received is empty\");\n    }\n\n    this._setAddresses(res.result);\n\n    return {\n      jsonrpc: \"2.0\",\n      id: 0,\n      result: this._addresses\n    };\n  }\n\n  _eth_sign(params) {\n    this._requireAuthorization();\n\n    const address = util_1.ensureAddressString(params[0]);\n    const message = util_1.ensureBuffer(params[1]);\n    return this._signEthereumMessage(message, address, false);\n  }\n\n  _eth_ecRecover(params) {\n    const message = util_1.ensureBuffer(params[0]);\n    const signature = util_1.ensureBuffer(params[1]);\n    return this._ethereumAddressFromSignedMessage(message, signature, false);\n  }\n\n  _personal_sign(params) {\n    this._requireAuthorization();\n\n    const message = util_1.ensureBuffer(params[0]);\n    const address = util_1.ensureAddressString(params[1]);\n    return this._signEthereumMessage(message, address, true);\n  }\n\n  _personal_ecRecover(params) {\n    const message = util_1.ensureBuffer(params[0]);\n    const signature = util_1.ensureBuffer(params[1]);\n    return this._ethereumAddressFromSignedMessage(message, signature, true);\n  }\n\n  async _eth_signTransaction(params) {\n    this._requireAuthorization();\n\n    const tx = this._prepareTransactionParams(params[0] || {});\n\n    try {\n      const res = await this._relay.signEthereumTransaction(tx);\n      return {\n        jsonrpc: \"2.0\",\n        id: 0,\n        result: res.result\n      };\n    } catch (err) {\n      if (typeof err.message === \"string\" && err.message.match(/(denied|rejected)/i)) {\n        throw new Web3Provider_1.ProviderError(\"User denied transaction signature\", Web3Provider_1.ProviderErrorCode.USER_DENIED_REQUEST_SIGNATURE);\n      }\n\n      throw err;\n    }\n  }\n\n  async _eth_sendRawTransaction(params) {\n    const signedTransaction = util_1.ensureBuffer(params[0]);\n    const res = await this._relay.submitEthereumTransaction(signedTransaction, this._chainId);\n    return {\n      jsonrpc: \"2.0\",\n      id: 0,\n      result: res.result\n    };\n  }\n\n  async _eth_sendTransaction(params) {\n    this._requireAuthorization();\n\n    const tx = this._prepareTransactionParams(params[0] || {});\n\n    try {\n      const res = await this._relay.signAndSubmitEthereumTransaction(tx);\n      return {\n        jsonrpc: \"2.0\",\n        id: 0,\n        result: res.result\n      };\n    } catch (err) {\n      if (typeof err.message === \"string\" && err.message.match(/(denied|rejected)/i)) {\n        throw new Web3Provider_1.ProviderError(\"User denied transaction signature\", Web3Provider_1.ProviderErrorCode.USER_DENIED_REQUEST_SIGNATURE);\n      }\n\n      throw err;\n    }\n  }\n\n  async _eth_signTypedData_v1(params) {\n    this._requireAuthorization();\n\n    const typedData = params[0];\n    const address = util_1.ensureAddressString(params[1]);\n\n    this._ensureKnownAddress(address);\n\n    const message = eth_eip712_util_1.default.hashForSignTypedDataLegacy({\n      data: typedData\n    });\n    const typedDataJson = JSON.stringify(typedData, null, 2);\n    return this._signEthereumMessage(message, address, false, typedDataJson);\n  }\n\n  async _eth_signTypedData_v3(params) {\n    this._requireAuthorization();\n\n    const address = util_1.ensureAddressString(params[0]);\n    const typedData = params[1];\n\n    this._ensureKnownAddress(address);\n\n    const message = eth_eip712_util_1.default.hashForSignTypedData_v3({\n      data: typedData\n    });\n    const typedDataJson = JSON.stringify(typedData, null, 2);\n    return this._signEthereumMessage(message, address, false, typedDataJson);\n  }\n\n  async _eth_signTypedData_v4(params) {\n    this._requireAuthorization();\n\n    const address = util_1.ensureAddressString(params[0]);\n    const typedData = params[1];\n\n    this._ensureKnownAddress(address);\n\n    const message = eth_eip712_util_1.default.hashForSignTypedData_v4({\n      data: typedData\n    });\n    const typedDataJson = JSON.stringify(typedData, null, 2);\n    return this._signEthereumMessage(message, address, false, typedDataJson);\n  }\n\n  async _walletlink_arbitrary(params) {\n    const data = params[0];\n\n    if (typeof data !== \"string\") {\n      throw new Error(\"parameter must be a string\");\n    }\n\n    const result = await this.arbitraryRequest(data);\n    return {\n      jsonrpc: \"2.0\",\n      id: 0,\n      result\n    };\n  }\n\n  _eth_uninstallFilter(params) {\n    const filterId = util_1.ensureHexString(params[0]);\n    return this._filterPolyfill.uninstallFilter(filterId);\n  }\n\n  async _eth_newFilter(params) {\n    const param = params[0]; // TODO: un-any this\n\n    const filterId = await this._filterPolyfill.newFilter(param);\n    return {\n      jsonrpc: \"2.0\",\n      id: 0,\n      result: filterId\n    };\n  }\n\n  async _eth_newBlockFilter() {\n    const filterId = await this._filterPolyfill.newBlockFilter();\n    return {\n      jsonrpc: \"2.0\",\n      id: 0,\n      result: filterId\n    };\n  }\n\n  async _eth_newPendingTransactionFilter() {\n    const filterId = await this._filterPolyfill.newPendingTransactionFilter();\n    return {\n      jsonrpc: \"2.0\",\n      id: 0,\n      result: filterId\n    };\n  }\n\n  _eth_getFilterChanges(params) {\n    const filterId = util_1.ensureHexString(params[0]);\n    return this._filterPolyfill.getFilterChanges(filterId);\n  }\n\n  _eth_getFilterLogs(params) {\n    const filterId = util_1.ensureHexString(params[0]);\n    return this._filterPolyfill.getFilterLogs(filterId);\n  }\n\n}\n\nexports.WalletLinkProvider = WalletLinkProvider;","map":{"version":3,"sources":["/workspace/uniswap-exchange/node_modules/walletlink/dist/WalletLinkProvider.js"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","bn_js_1","require","eth_eip712_util_1","events_1","FilterPolyfill_1","JSONRPC_1","Web3Provider_1","util_1","LOCAL_STORAGE_ADDRESSES_KEY","WalletLinkProvider","EventEmitter","constructor","options","_filterPolyfill","FilterPolyfill","_addresses","_send","send","_sendAsync","sendAsync","relay","Error","jsonRpcUrl","_relay","_chainId","ensureIntNumber","chainId","_jsonRpcUrl","cahedAddresses","getStorageItem","addresses","split","selectedAddress","undefined","networkVersion","toString","isWalletLink","host","connected","isConnected","enable","length","JSONRPCMethod","eth_requestAccounts","requestOrMethod","callbackOrParams","method","params","Array","isArray","request","jsonrpc","id","_sendRequestAsync","then","res","result","callback","requests","map","r","_sendRequest","req","arrayCb","_sendMultipleRequestsAsync","responses","catch","err","cb","response","scanQRCode","match","ensureRegExpString","arbitraryRequest","data","supportsSubscriptions","subscribe","unsubscribe","disconnect","_handleSynchronousMethods","_setAddresses","address","ensureAddressString","setStorageItem","join","emit","Promise","resolve","reject","syncResult","filterPromise","_handleAsynchronousFilterMethods","assign","_handleAsynchronousMethods","all","eth_accounts","_eth_accounts","eth_coinbase","_eth_coinbase","eth_uninstallFilter","_eth_uninstallFilter","net_version","_net_version","_eth_requestAccounts","eth_sign","_eth_sign","eth_ecRecover","_eth_ecRecover","personal_sign","_personal_sign","personal_ecRecover","_personal_ecRecover","eth_signTransaction","_eth_signTransaction","eth_sendRawTransaction","_eth_sendRawTransaction","eth_sendTransaction","_eth_sendTransaction","eth_signTypedData_v1","_eth_signTypedData_v1","eth_signTypedData_v2","_throwUnsupportedMethodError","eth_signTypedData_v3","_eth_signTypedData_v3","eth_signTypedData_v4","eth_signTypedData","_eth_signTypedData_v4","walletlink_arbitrary","_walletlink_arbitrary","window","fetch","body","JSON","stringify","mode","headers","json","ProviderError","error","message","code","eth_newFilter","_eth_newFilter","eth_newBlockFilter","_eth_newBlockFilter","eth_newPendingTransactionFilter","_eth_newPendingTransactionFilter","eth_getFilterChanges","_eth_getFilterChanges","eth_getFilterLogs","_eth_getFilterLogs","_isKnownAddress","addressString","includes","_a","_ensureKnownAddress","_prepareTransactionParams","tx","fromAddress","from","toAddress","to","weiValue","ensureBN","default","ensureBuffer","Buffer","alloc","nonce","gasPriceInWei","gasPrice","gasLimit","gas","_requireAuthorization","ProviderErrorCode","UNAUTHORIZED","UNSUPPORTED_METHOD","_signEthereumMessage","addPrefix","typedDataJson","signEthereumMessage","USER_DENIED_REQUEST_SIGNATURE","_ethereumAddressFromSignedMessage","signature","ethereumAddressFromSignedMessage","requestEthereumAccounts","USER_DENIED_REQUEST_ACCOUNTS","signEthereumTransaction","signedTransaction","submitEthereumTransaction","signAndSubmitEthereumTransaction","typedData","hashForSignTypedDataLegacy","hashForSignTypedData_v3","hashForSignTypedData_v4","filterId","ensureHexString","uninstallFilter","param","newFilter","newBlockFilter","newPendingTransactionFilter","getFilterChanges","getFilterLogs"],"mappings":"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","sourcesContent":["\"use strict\";\n// Copyright (c) 2018-2019 Coinbase, Inc. <https://coinbase.com/>\n// Licensed under the Apache License, version 2.0\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst bn_js_1 = __importDefault(require(\"bn.js\"));\nconst eth_eip712_util_1 = __importDefault(require(\"eth-eip712-util\"));\nconst events_1 = require(\"events\");\nconst FilterPolyfill_1 = require(\"./FilterPolyfill\");\nconst JSONRPC_1 = require(\"./types/JSONRPC\");\nconst Web3Provider_1 = require(\"./types/Web3Provider\");\nconst util_1 = require(\"./util\");\nconst LOCAL_STORAGE_ADDRESSES_KEY = \"Addresses\";\nclass WalletLinkProvider extends events_1.EventEmitter {\n    constructor(options) {\n        super();\n        this._filterPolyfill = new FilterPolyfill_1.FilterPolyfill(this);\n        this._addresses = [];\n        this._send = this.send;\n        this._sendAsync = this.sendAsync;\n        if (!options.relay) {\n            throw new Error(\"realy must be provided\");\n        }\n        if (!options.jsonRpcUrl) {\n            throw new Error(\"jsonRpcUrl must be provided\");\n        }\n        this._relay = options.relay;\n        this._chainId = util_1.ensureIntNumber(options.chainId || 1);\n        this._jsonRpcUrl = options.jsonRpcUrl;\n        const cahedAddresses = this._relay.getStorageItem(LOCAL_STORAGE_ADDRESSES_KEY);\n        if (cahedAddresses) {\n            const addresses = cahedAddresses.split(\" \");\n            if (addresses[0] !== \"\") {\n                this._addresses = addresses;\n            }\n        }\n    }\n    get selectedAddress() {\n        return this._addresses[0] || undefined;\n    }\n    get networkVersion() {\n        return this._chainId.toString(10);\n    }\n    get isWalletLink() {\n        return true;\n    }\n    get host() {\n        return this._jsonRpcUrl;\n    }\n    get connected() {\n        return true;\n    }\n    isConnected() {\n        return true;\n    }\n    async enable() {\n        if (this._addresses.length > 0) {\n            return this._addresses;\n        }\n        return await this._send(JSONRPC_1.JSONRPCMethod.eth_requestAccounts);\n    }\n    send(requestOrMethod, callbackOrParams) {\n        // send<T>(method, params): Promise<T>\n        if (typeof requestOrMethod === \"string\") {\n            const method = requestOrMethod;\n            const params = Array.isArray(callbackOrParams)\n                ? callbackOrParams\n                : callbackOrParams !== undefined\n                    ? [callbackOrParams]\n                    : [];\n            const request = { jsonrpc: \"2.0\", id: 1, method, params };\n            return this._sendRequestAsync(request).then(res => res.result);\n        }\n        // send(JSONRPCRequest | JSONRPCRequest[], callback): void\n        if (typeof callbackOrParams === \"function\") {\n            const request = requestOrMethod;\n            const callback = callbackOrParams;\n            return this._sendAsync(request, callback);\n        }\n        // send(JSONRPCRequest[]): JSONRPCResponse[]\n        if (Array.isArray(requestOrMethod)) {\n            const requests = requestOrMethod;\n            return requests.map(r => this._sendRequest(r));\n        }\n        // send(JSONRPCRequest): JSONRPCResponse\n        const req = requestOrMethod;\n        return this._sendRequest(req);\n    }\n    sendAsync(request, callback) {\n        if (typeof callback !== \"function\") {\n            throw new Error(\"callback is required\");\n        }\n        // send(JSONRPCRequest[], callback): void\n        if (Array.isArray(request)) {\n            const arrayCb = callback;\n            this._sendMultipleRequestsAsync(request)\n                .then(responses => arrayCb(null, responses))\n                .catch(err => arrayCb(err, null));\n            return;\n        }\n        // send(JSONRPCRequest, callback): void\n        const cb = callback;\n        this._sendRequestAsync(request)\n            .then(response => cb(null, response))\n            .catch(err => cb(err, null));\n    }\n    async scanQRCode(match) {\n        const res = await this._relay.scanQRCode(util_1.ensureRegExpString(match));\n        if (typeof res.result !== \"string\") {\n            throw new Error(\"result was not a string\");\n        }\n        return res.result;\n    }\n    async arbitraryRequest(data) {\n        const res = await this._relay.arbitraryRequest(data);\n        if (typeof res.result !== \"string\") {\n            throw new Error(\"result was not a string\");\n        }\n        return res.result;\n    }\n    supportsSubscriptions() {\n        return false;\n    }\n    subscribe() {\n        throw new Error(\"Subscriptions are not supported\");\n    }\n    unsubscribe() {\n        throw new Error(\"Subscriptions are not supported\");\n    }\n    disconnect() {\n        return true;\n    }\n    _sendRequest(request) {\n        const response = {\n            jsonrpc: \"2.0\",\n            id: request.id\n        };\n        const { method } = request;\n        response.result = this._handleSynchronousMethods(request);\n        if (response.result === undefined) {\n            throw new Error(`WalletLink does not support calling ${method} synchronously without ` +\n                `a callback. Please provide a callback parameter to call ${method} ` +\n                `asynchronously.`);\n        }\n        return response;\n    }\n    _setAddresses(addresses) {\n        if (!Array.isArray(addresses)) {\n            throw new Error(\"addresses is not an array\");\n        }\n        this._addresses = addresses.map(address => util_1.ensureAddressString(address));\n        this._relay.setStorageItem(LOCAL_STORAGE_ADDRESSES_KEY, addresses.join(\" \"));\n        this.emit(\"accountsChanged\", this._addresses);\n    }\n    _sendRequestAsync(request) {\n        return new Promise((resolve, reject) => {\n            try {\n                const syncResult = this._handleSynchronousMethods(request);\n                if (syncResult !== undefined) {\n                    return resolve({\n                        jsonrpc: \"2.0\",\n                        id: request.id,\n                        result: syncResult\n                    });\n                }\n                const filterPromise = this._handleAsynchronousFilterMethods(request);\n                if (filterPromise !== undefined) {\n                    filterPromise\n                        .then(res => resolve(Object.assign({}, res, { id: request.id })))\n                        .catch(err => reject(err));\n                    return;\n                }\n            }\n            catch (err) {\n                return reject(err);\n            }\n            this._handleAsynchronousMethods(request)\n                .then(res => resolve(Object.assign({}, res, { id: request.id })))\n                .catch(err => reject(err));\n        });\n    }\n    _sendMultipleRequestsAsync(requests) {\n        return Promise.all(requests.map(r => this._sendRequestAsync(r)));\n    }\n    _handleSynchronousMethods(request) {\n        const { method } = request;\n        const params = request.params || [];\n        switch (method) {\n            case JSONRPC_1.JSONRPCMethod.eth_accounts:\n                return this._eth_accounts();\n            case JSONRPC_1.JSONRPCMethod.eth_coinbase:\n                return this._eth_coinbase();\n            case JSONRPC_1.JSONRPCMethod.eth_uninstallFilter:\n                return this._eth_uninstallFilter(params);\n            case JSONRPC_1.JSONRPCMethod.net_version:\n                return this._net_version();\n            default:\n                return undefined;\n        }\n    }\n    _handleAsynchronousMethods(request) {\n        const { method } = request;\n        const params = request.params || [];\n        switch (method) {\n            case JSONRPC_1.JSONRPCMethod.eth_requestAccounts:\n                return this._eth_requestAccounts();\n            case JSONRPC_1.JSONRPCMethod.eth_sign:\n                return this._eth_sign(params);\n            case JSONRPC_1.JSONRPCMethod.eth_ecRecover:\n                return this._eth_ecRecover(params);\n            case JSONRPC_1.JSONRPCMethod.personal_sign:\n                return this._personal_sign(params);\n            case JSONRPC_1.JSONRPCMethod.personal_ecRecover:\n                return this._personal_ecRecover(params);\n            case JSONRPC_1.JSONRPCMethod.eth_signTransaction:\n                return this._eth_signTransaction(params);\n            case JSONRPC_1.JSONRPCMethod.eth_sendRawTransaction:\n                return this._eth_sendRawTransaction(params);\n            case JSONRPC_1.JSONRPCMethod.eth_sendTransaction:\n                return this._eth_sendTransaction(params);\n            case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v1:\n                return this._eth_signTypedData_v1(params);\n            case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v2:\n                return this._throwUnsupportedMethodError();\n            case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v3:\n                return this._eth_signTypedData_v3(params);\n            case JSONRPC_1.JSONRPCMethod.eth_signTypedData_v4:\n            case JSONRPC_1.JSONRPCMethod.eth_signTypedData:\n                return this._eth_signTypedData_v4(params);\n            case JSONRPC_1.JSONRPCMethod.walletlink_arbitrary:\n                return this._walletlink_arbitrary(params);\n        }\n        return window\n            .fetch(this._jsonRpcUrl, {\n            method: \"POST\",\n            body: JSON.stringify(request),\n            mode: \"cors\",\n            headers: { \"Content-Type\": \"application/json\" }\n        })\n            .then(res => res.json())\n            .then(json => {\n            if (!json) {\n                throw new Web3Provider_1.ProviderError(\"unexpected response\");\n            }\n            const response = json;\n            const { error } = response;\n            if (error) {\n                throw new Web3Provider_1.ProviderError(error.message || \"RPC Error\", error.code, error.data);\n            }\n            return response;\n        });\n    }\n    _handleAsynchronousFilterMethods(request) {\n        const { method } = request;\n        const params = request.params || [];\n        switch (method) {\n            case JSONRPC_1.JSONRPCMethod.eth_newFilter:\n                return this._eth_newFilter(params);\n            case JSONRPC_1.JSONRPCMethod.eth_newBlockFilter:\n                return this._eth_newBlockFilter();\n            case JSONRPC_1.JSONRPCMethod.eth_newPendingTransactionFilter:\n                return this._eth_newPendingTransactionFilter();\n            case JSONRPC_1.JSONRPCMethod.eth_getFilterChanges:\n                return this._eth_getFilterChanges(params);\n            case JSONRPC_1.JSONRPCMethod.eth_getFilterLogs:\n                return this._eth_getFilterLogs(params);\n        }\n        return undefined;\n    }\n    _isKnownAddress(addressString) {\n        try {\n            const address = util_1.ensureAddressString(addressString);\n            return this._addresses.includes(address);\n        }\n        catch (_a) { }\n        return false;\n    }\n    _ensureKnownAddress(addressString) {\n        if (!this._isKnownAddress(addressString)) {\n            throw new Error(\"Unknown Ethereum address\");\n        }\n    }\n    _prepareTransactionParams(tx) {\n        const fromAddress = tx.from\n            ? util_1.ensureAddressString(tx.from)\n            : this.selectedAddress;\n        if (!fromAddress) {\n            throw new Error(\"Ethereum address is unavailable\");\n        }\n        this._ensureKnownAddress(fromAddress);\n        const toAddress = tx.to ? util_1.ensureAddressString(tx.to) : null;\n        const weiValue = tx.value != null ? util_1.ensureBN(tx.value) : new bn_js_1.default(0);\n        const data = tx.data ? util_1.ensureBuffer(tx.data) : Buffer.alloc(0);\n        const nonce = tx.nonce != null ? util_1.ensureIntNumber(tx.nonce) : null;\n        const gasPriceInWei = tx.gasPrice != null ? util_1.ensureBN(tx.gasPrice) : null;\n        const gasLimit = tx.gas != null ? util_1.ensureBN(tx.gas) : null;\n        const chainId = this._chainId;\n        return {\n            fromAddress,\n            toAddress,\n            weiValue,\n            data,\n            nonce,\n            gasPriceInWei,\n            gasLimit,\n            chainId\n        };\n    }\n    _requireAuthorization() {\n        if (this._addresses.length === 0) {\n            throw new Web3Provider_1.ProviderError(\"Unauthorized\", Web3Provider_1.ProviderErrorCode.UNAUTHORIZED);\n        }\n    }\n    _throwUnsupportedMethodError() {\n        throw new Web3Provider_1.ProviderError(\"Unsupported method\", Web3Provider_1.ProviderErrorCode.UNSUPPORTED_METHOD);\n    }\n    async _signEthereumMessage(message, address, addPrefix, typedDataJson) {\n        this._ensureKnownAddress(address);\n        try {\n            const res = await this._relay.signEthereumMessage(message, address, addPrefix, typedDataJson);\n            return { jsonrpc: \"2.0\", id: 0, result: res.result };\n        }\n        catch (err) {\n            if (typeof err.message === \"string\" &&\n                err.message.match(/(denied|rejected)/i)) {\n                throw new Web3Provider_1.ProviderError(\"User denied message signature\", Web3Provider_1.ProviderErrorCode.USER_DENIED_REQUEST_SIGNATURE);\n            }\n            throw err;\n        }\n    }\n    async _ethereumAddressFromSignedMessage(message, signature, addPrefix) {\n        const res = await this._relay.ethereumAddressFromSignedMessage(message, signature, addPrefix);\n        return { jsonrpc: \"2.0\", id: 0, result: res.result };\n    }\n    _eth_accounts() {\n        return this._addresses;\n    }\n    _eth_coinbase() {\n        return this.selectedAddress || null;\n    }\n    _net_version() {\n        return this._chainId.toString(10);\n    }\n    async _eth_requestAccounts() {\n        if (this._addresses.length > 0) {\n            return Promise.resolve({ jsonrpc: \"2.0\", id: 0, result: this._addresses });\n        }\n        let res;\n        try {\n            res = await this._relay.requestEthereumAccounts();\n        }\n        catch (err) {\n            if (typeof err.message === \"string\" &&\n                err.message.match(/(denied|rejected)/i)) {\n                throw new Web3Provider_1.ProviderError(\"User denied account authorization\", Web3Provider_1.ProviderErrorCode.USER_DENIED_REQUEST_ACCOUNTS);\n            }\n            throw err;\n        }\n        if (!res.result) {\n            throw new Error(\"accounts received is empty\");\n        }\n        this._setAddresses(res.result);\n        return { jsonrpc: \"2.0\", id: 0, result: this._addresses };\n    }\n    _eth_sign(params) {\n        this._requireAuthorization();\n        const address = util_1.ensureAddressString(params[0]);\n        const message = util_1.ensureBuffer(params[1]);\n        return this._signEthereumMessage(message, address, false);\n    }\n    _eth_ecRecover(params) {\n        const message = util_1.ensureBuffer(params[0]);\n        const signature = util_1.ensureBuffer(params[1]);\n        return this._ethereumAddressFromSignedMessage(message, signature, false);\n    }\n    _personal_sign(params) {\n        this._requireAuthorization();\n        const message = util_1.ensureBuffer(params[0]);\n        const address = util_1.ensureAddressString(params[1]);\n        return this._signEthereumMessage(message, address, true);\n    }\n    _personal_ecRecover(params) {\n        const message = util_1.ensureBuffer(params[0]);\n        const signature = util_1.ensureBuffer(params[1]);\n        return this._ethereumAddressFromSignedMessage(message, signature, true);\n    }\n    async _eth_signTransaction(params) {\n        this._requireAuthorization();\n        const tx = this._prepareTransactionParams(params[0] || {});\n        try {\n            const res = await this._relay.signEthereumTransaction(tx);\n            return { jsonrpc: \"2.0\", id: 0, result: res.result };\n        }\n        catch (err) {\n            if (typeof err.message === \"string\" &&\n                err.message.match(/(denied|rejected)/i)) {\n                throw new Web3Provider_1.ProviderError(\"User denied transaction signature\", Web3Provider_1.ProviderErrorCode.USER_DENIED_REQUEST_SIGNATURE);\n            }\n            throw err;\n        }\n    }\n    async _eth_sendRawTransaction(params) {\n        const signedTransaction = util_1.ensureBuffer(params[0]);\n        const res = await this._relay.submitEthereumTransaction(signedTransaction, this._chainId);\n        return { jsonrpc: \"2.0\", id: 0, result: res.result };\n    }\n    async _eth_sendTransaction(params) {\n        this._requireAuthorization();\n        const tx = this._prepareTransactionParams(params[0] || {});\n        try {\n            const res = await this._relay.signAndSubmitEthereumTransaction(tx);\n            return { jsonrpc: \"2.0\", id: 0, result: res.result };\n        }\n        catch (err) {\n            if (typeof err.message === \"string\" &&\n                err.message.match(/(denied|rejected)/i)) {\n                throw new Web3Provider_1.ProviderError(\"User denied transaction signature\", Web3Provider_1.ProviderErrorCode.USER_DENIED_REQUEST_SIGNATURE);\n            }\n            throw err;\n        }\n    }\n    async _eth_signTypedData_v1(params) {\n        this._requireAuthorization();\n        const typedData = params[0];\n        const address = util_1.ensureAddressString(params[1]);\n        this._ensureKnownAddress(address);\n        const message = eth_eip712_util_1.default.hashForSignTypedDataLegacy({ data: typedData });\n        const typedDataJson = JSON.stringify(typedData, null, 2);\n        return this._signEthereumMessage(message, address, false, typedDataJson);\n    }\n    async _eth_signTypedData_v3(params) {\n        this._requireAuthorization();\n        const address = util_1.ensureAddressString(params[0]);\n        const typedData = params[1];\n        this._ensureKnownAddress(address);\n        const message = eth_eip712_util_1.default.hashForSignTypedData_v3({ data: typedData });\n        const typedDataJson = JSON.stringify(typedData, null, 2);\n        return this._signEthereumMessage(message, address, false, typedDataJson);\n    }\n    async _eth_signTypedData_v4(params) {\n        this._requireAuthorization();\n        const address = util_1.ensureAddressString(params[0]);\n        const typedData = params[1];\n        this._ensureKnownAddress(address);\n        const message = eth_eip712_util_1.default.hashForSignTypedData_v4({ data: typedData });\n        const typedDataJson = JSON.stringify(typedData, null, 2);\n        return this._signEthereumMessage(message, address, false, typedDataJson);\n    }\n    async _walletlink_arbitrary(params) {\n        const data = params[0];\n        if (typeof data !== \"string\") {\n            throw new Error(\"parameter must be a string\");\n        }\n        const result = await this.arbitraryRequest(data);\n        return { jsonrpc: \"2.0\", id: 0, result };\n    }\n    _eth_uninstallFilter(params) {\n        const filterId = util_1.ensureHexString(params[0]);\n        return this._filterPolyfill.uninstallFilter(filterId);\n    }\n    async _eth_newFilter(params) {\n        const param = params[0]; // TODO: un-any this\n        const filterId = await this._filterPolyfill.newFilter(param);\n        return { jsonrpc: \"2.0\", id: 0, result: filterId };\n    }\n    async _eth_newBlockFilter() {\n        const filterId = await this._filterPolyfill.newBlockFilter();\n        return { jsonrpc: \"2.0\", id: 0, result: filterId };\n    }\n    async _eth_newPendingTransactionFilter() {\n        const filterId = await this._filterPolyfill.newPendingTransactionFilter();\n        return { jsonrpc: \"2.0\", id: 0, result: filterId };\n    }\n    _eth_getFilterChanges(params) {\n        const filterId = util_1.ensureHexString(params[0]);\n        return this._filterPolyfill.getFilterChanges(filterId);\n    }\n    _eth_getFilterLogs(params) {\n        const filterId = util_1.ensureHexString(params[0]);\n        return this._filterPolyfill.getFilterLogs(filterId);\n    }\n}\nexports.WalletLinkProvider = WalletLinkProvider;\n"]},"metadata":{},"sourceType":"script"}