{"ast":null,"code":"var _jsxFileName = \"/workspace/uniswap-exchange/src/contexts/Allowances.js\";\nimport React, { createContext, useContext, useReducer, useMemo, useCallback, useEffect } from \"react\";\nimport \"@web3-react/core\";\nimport { useWeb3React } from \"../hooks\";\nimport { safeAccess, isAddress, getTokenAllowance } from \"../utils\";\nimport { useBlockNumber } from \"./Application\";\nconst UPDATE = \"UPDATE\";\nconst AllowancesContext = createContext();\n\nfunction useAllowancesContext() {\n  return useContext(AllowancesContext);\n}\n\nfunction reducer(state, {\n  type,\n  payload\n}) {\n  switch (type) {\n    case UPDATE:\n      {\n        const {\n          networkId,\n          address,\n          tokenAddress,\n          spenderAddress,\n          value,\n          blockNumber\n        } = payload;\n        return { ...state,\n          [networkId]: { ...(safeAccess(state, [networkId]) || {}),\n            [address]: { ...(safeAccess(state, [networkId, address]) || {}),\n              [tokenAddress]: { ...(safeAccess(state, [networkId, address, tokenAddress]) || {}),\n                [spenderAddress]: {\n                  value,\n                  blockNumber\n                }\n              }\n            }\n          }\n        };\n      }\n\n    default:\n      {\n        throw Error(`Unexpected action type in AllowancesContext reducer: '${type}'.`);\n      }\n  }\n}\n\nexport default function Provider({\n  children\n}) {\n  const [state, dispatch] = useReducer(reducer, {});\n  const update = useCallback((networkId, address, tokenAddress, spenderAddress, value, blockNumber) => {\n    dispatch({\n      type: UPDATE,\n      payload: {\n        networkId,\n        address,\n        tokenAddress,\n        spenderAddress,\n        value,\n        blockNumber\n      }\n    });\n  }, []);\n  return React.createElement(AllowancesContext.Provider, {\n    value: useMemo(() => [state, {\n      update\n    }], [state, update]),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80\n    },\n    __self: this\n  }, children);\n}\nexport function useAddressAllowance(address, tokenAddress, spenderAddress) {\n  const {\n    library,\n    chainId\n  } = useWeb3React();\n  const globalBlockNumber = useBlockNumber();\n  const [state, {\n    update\n  }] = useAllowancesContext();\n  const {\n    value,\n    blockNumber\n  } = safeAccess(state, [chainId, address, tokenAddress, spenderAddress]) || {};\n  useEffect(() => {\n    if (isAddress(address) && isAddress(tokenAddress) && isAddress(spenderAddress) && (value === undefined || blockNumber !== globalBlockNumber) && (chainId || chainId === 0) && library) {\n      let stale = false;\n      getTokenAllowance(address, tokenAddress, spenderAddress, library).then(value => {\n        if (!stale) {\n          update(chainId, address, tokenAddress, spenderAddress, value, globalBlockNumber);\n        }\n      }).catch(() => {\n        if (!stale) {\n          update(chainId, address, tokenAddress, spenderAddress, null, globalBlockNumber);\n        }\n      });\n      return () => {\n        stale = true;\n      };\n    }\n  }, [address, tokenAddress, spenderAddress, value, blockNumber, globalBlockNumber, chainId, library, update]);\n  return value;\n}","map":{"version":3,"sources":["/workspace/uniswap-exchange/src/contexts/Allowances.js"],"names":["React","createContext","useContext","useReducer","useMemo","useCallback","useEffect","useWeb3React","safeAccess","isAddress","getTokenAllowance","useBlockNumber","UPDATE","AllowancesContext","useAllowancesContext","reducer","state","type","payload","networkId","address","tokenAddress","spenderAddress","value","blockNumber","Error","Provider","children","dispatch","update","useAddressAllowance","library","chainId","globalBlockNumber","undefined","stale","then","catch"],"mappings":"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","sourcesContent":["import React, {\n  createContext,\n  useContext,\n  useReducer,\n  useMemo,\n  useCallback,\n  useEffect\n} from \"react\";\nimport {} from \"@web3-react/core\";\n\nimport { useWeb3React } from \"../hooks\";\nimport { safeAccess, isAddress, getTokenAllowance } from \"../utils\";\nimport { useBlockNumber } from \"./Application\";\n\nconst UPDATE = \"UPDATE\";\n\nconst AllowancesContext = createContext();\n\nfunction useAllowancesContext() {\n  return useContext(AllowancesContext);\n}\n\nfunction reducer(state, { type, payload }) {\n  switch (type) {\n    case UPDATE: {\n      const {\n        networkId,\n        address,\n        tokenAddress,\n        spenderAddress,\n        value,\n        blockNumber\n      } = payload;\n      return {\n        ...state,\n        [networkId]: {\n          ...(safeAccess(state, [networkId]) || {}),\n          [address]: {\n            ...(safeAccess(state, [networkId, address]) || {}),\n            [tokenAddress]: {\n              ...(safeAccess(state, [networkId, address, tokenAddress]) || {}),\n              [spenderAddress]: {\n                value,\n                blockNumber\n              }\n            }\n          }\n        }\n      };\n    }\n    default: {\n      throw Error(\n        `Unexpected action type in AllowancesContext reducer: '${type}'.`\n      );\n    }\n  }\n}\n\nexport default function Provider({ children }) {\n  const [state, dispatch] = useReducer(reducer, {});\n\n  const update = useCallback(\n    (networkId, address, tokenAddress, spenderAddress, value, blockNumber) => {\n      dispatch({\n        type: UPDATE,\n        payload: {\n          networkId,\n          address,\n          tokenAddress,\n          spenderAddress,\n          value,\n          blockNumber\n        }\n      });\n    },\n    []\n  );\n\n  return (\n    <AllowancesContext.Provider\n      value={useMemo(() => [state, { update }], [state, update])}\n    >\n      {children}\n    </AllowancesContext.Provider>\n  );\n}\n\nexport function useAddressAllowance(address, tokenAddress, spenderAddress) {\n  const { library, chainId } = useWeb3React();\n\n  const globalBlockNumber = useBlockNumber();\n\n  const [state, { update }] = useAllowancesContext();\n  const { value, blockNumber } =\n    safeAccess(state, [chainId, address, tokenAddress, spenderAddress]) || {};\n\n  useEffect(() => {\n    if (\n      isAddress(address) &&\n      isAddress(tokenAddress) &&\n      isAddress(spenderAddress) &&\n      (value === undefined || blockNumber !== globalBlockNumber) &&\n      (chainId || chainId === 0) &&\n      library\n    ) {\n      let stale = false;\n\n      getTokenAllowance(address, tokenAddress, spenderAddress, library)\n        .then(value => {\n          if (!stale) {\n            update(\n              chainId,\n              address,\n              tokenAddress,\n              spenderAddress,\n              value,\n              globalBlockNumber\n            );\n          }\n        })\n        .catch(() => {\n          if (!stale) {\n            update(\n              chainId,\n              address,\n              tokenAddress,\n              spenderAddress,\n              null,\n              globalBlockNumber\n            );\n          }\n        });\n\n      return () => {\n        stale = true;\n      };\n    }\n  }, [\n    address,\n    tokenAddress,\n    spenderAddress,\n    value,\n    blockNumber,\n    globalBlockNumber,\n    chainId,\n    library,\n    update\n  ]);\n\n  return value;\n}\n"]},"metadata":{},"sourceType":"module"}