{"ast":null,"code":"import _regeneratorRuntime from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject11(){var data=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: center;\\n  padding: 2rem;\\n\\n  button {\\n    max-width: 20rem;\\n  }\\n\"]);_templateObject11=function _templateObject11(){return data;};return data;}function _templateObject10(){var data=_taggedTemplateLiteral([\"\\n  flex: 1 1 auto;\\n  width: 0;\\n  color: \",\";\\n\"]);_templateObject10=function _templateObject10(){return data;};return data;}function _templateObject9(){var data=_taggedTemplateLiteral([\"\\n  \",\";\\n  align-items: center;\\n  color: \",\";\\n  font-size: 0.75rem;\\n  padding: 0.25rem 1rem 0;\\n\"]);_templateObject9=function _templateObject9(){return data;};return data;}function _templateObject8(){var data=_taggedTemplateLiteral([\"\\n  margin-top: 1rem;\\n\"]);_templateObject8=function _templateObject8(){return data;};return data;}function _templateObject7(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  padding: 1rem 0;\\n\"]);_templateObject7=function _templateObject7(){return data;};return data;}function _templateObject6(){var data=_taggedTemplateLiteral([\"\\n  font-size: 1.25rem;\\n  line-height: 1.5rem;\\n  padding: 1rem 0;\\n\"]);_templateObject6=function _templateObject6(){return data;};return data;}function _templateObject5(){var data=_taggedTemplateLiteral([\"\\n  font-size: 1.25rem;\\n  line-height: 1.5rem;\\n  padding: 1rem 0.75rem;\\n\"]);_templateObject5=function _templateObject5(){return data;};return data;}function _templateObject4(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  min-height: 3.5rem;\\n\"]);_templateObject4=function _templateObject4(){return data;};return data;}function _templateObject3(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  color: \",\";\\n  width: 0.625rem;\\n  height: 0.625rem;\\n  position: relative;\\n  padding: 0.875rem;\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  justify-content: center;\\n  align-items: center;\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  color: \",\";\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useState,useEffect,useCallback}from'react';import{useTranslation}from'react-i18next';import ReactGA from'react-ga';import{createBrowserHistory}from'history';import{ethers}from'ethers';import styled from'styled-components';import{useWeb3React,useExchangeContract}from'../../hooks';import{useTransactionAdder}from'../../contexts/Transactions';import{useTokenDetails,INITIAL_TOKENS_CONTEXT}from'../../contexts/Tokens';import{useAddressBalance,useETHPriceInUSD}from'../../contexts/Balances';import{calculateGasMargin,amountFormatter}from'../../utils';import{brokenTokens}from'../../constants';import{Button}from'../../theme';import CurrencyInputPanel from'../../components/CurrencyInputPanel';import ContextualInfo from'../../components/ContextualInfo';import OversizedPanel from'../../components/OversizedPanel';import ArrowDown from'../../assets/svg/SVGArrowDown';import WarningCard from'../../components/WarningCard';// denominated in bips\nvar ALLOWED_SLIPPAGE=ethers.utils.bigNumberify(200);// denominated in seconds\nvar DEADLINE_FROM_NOW=60*15;// denominated in bips\nvar GAS_MARGIN=ethers.utils.bigNumberify(1000);var BlueSpan=styled.span(_templateObject(),function(_ref){var theme=_ref.theme;return theme.royalBlue;});var DownArrowBackground=styled.div(_templateObject2(),function(_ref2){var theme=_ref2.theme;return theme.flexRowNoWrap;});var DownArrow=styled(ArrowDown)(_templateObject3(),function(_ref3){var theme=_ref3.theme;return theme.flexRowNoWrap;},function(_ref4){var theme=_ref4.theme,active=_ref4.active;return active?theme.royalBlue:theme.doveGray;});var RemoveLiquidityOutput=styled.div(_templateObject4(),function(_ref5){var theme=_ref5.theme;return theme.flexRowNoWrap;});var RemoveLiquidityOutputText=styled.div(_templateObject5());var RemoveLiquidityOutputPlus=styled.div(_templateObject6());var SummaryPanel=styled.div(_templateObject7(),function(_ref6){var theme=_ref6.theme;return theme.flexColumnNoWrap;});var LastSummaryText=styled.div(_templateObject8());var ExchangeRateWrapper=styled.div(_templateObject9(),function(_ref7){var theme=_ref7.theme;return theme.flexRowNoWrap;},function(_ref8){var theme=_ref8.theme;return theme.doveGray;});var ExchangeRate=styled.span(_templateObject10(),function(_ref9){var theme=_ref9.theme;return theme.doveGray;});var Flex=styled.div(_templateObject11());function getExchangeRate(inputValue,inputDecimals,outputValue,outputDecimals){var invert=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;try{if(inputValue&&(inputDecimals||inputDecimals===0)&&outputValue&&(outputDecimals||outputDecimals===0)){var factor=ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18));if(invert){return inputValue.mul(factor).mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals))).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals))).div(outputValue);}else{return outputValue.mul(factor).mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals))).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals))).div(inputValue);}}}catch(_unused){}}function getMarketRate(reserveETH,reserveToken,decimals){var invert=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return getExchangeRate(reserveETH,18,reserveToken,decimals,invert);}function calculateSlippageBounds(value){if(value){var offset=value.mul(ALLOWED_SLIPPAGE).div(ethers.utils.bigNumberify(10000));var minimum=value.sub(offset);var maximum=value.add(offset);return{minimum:minimum.lt(ethers.constants.Zero)?ethers.constants.Zero:minimum,maximum:maximum.gt(ethers.constants.MaxUint256)?ethers.constants.MaxUint256:maximum};}else{return{};}}export default function RemoveLiquidity(_ref10){var params=_ref10.params;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useWeb3React=useWeb3React(),library=_useWeb3React.library,account=_useWeb3React.account,active=_useWeb3React.active,chainId=_useWeb3React.chainId;var addTransaction=useTransactionAdder();var _useState=useState(),_useState2=_slicedToArray(_useState,2),brokenTokenWarning=_useState2[0],setBrokenTokenWarning=_useState2[1];// clear url of query\nuseEffect(function(){var history=createBrowserHistory();history.push(window.location.pathname+'');},[]);var _useState3=useState(params.poolTokenAddress),_useState4=_slicedToArray(_useState3,2),outputCurrency=_useState4[0],setOutputCurrency=_useState4[1];var _useState5=useState(params.poolTokenAmount?params.poolTokenAmount:''),_useState6=_slicedToArray(_useState5,2),value=_useState6[0],setValue=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),inputError=_useState8[0],setInputError=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),valueParsed=_useState10[0],setValueParsed=_useState10[1];useEffect(function(){setBrokenTokenWarning(false);for(var i=0;i<brokenTokens.length;i++){if(brokenTokens[i].toLowerCase()===outputCurrency.toLowerCase()){setBrokenTokenWarning(true);}}},[outputCurrency]);// parse value\nuseEffect(function(){try{var parsedValue=ethers.utils.parseUnits(value,18);setValueParsed(parsedValue);}catch(_unused2){if(value!==''){setInputError(t('inputNotValid'));}}return function(){setInputError();setValueParsed();};},[t,value]);var _useTokenDetails=useTokenDetails(outputCurrency),symbol=_useTokenDetails.symbol,decimals=_useTokenDetails.decimals,exchangeAddress=_useTokenDetails.exchangeAddress;var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),totalPoolTokens=_useState12[0],setTotalPoolTokens=_useState12[1];var poolTokenBalance=useAddressBalance(account,exchangeAddress);var exchangeETHBalance=useAddressBalance(exchangeAddress,'ETH');var exchangeTokenBalance=useAddressBalance(exchangeAddress,outputCurrency);var urlAddedTokens={};if(params.poolTokenAddress){urlAddedTokens[params.poolTokenAddress]=true;}// input validation\nuseEffect(function(){if(valueParsed&&poolTokenBalance){if(valueParsed.gt(poolTokenBalance)){setInputError(t('insufficientBalance'));}else{setInputError(null);}}},[poolTokenBalance,t,valueParsed]);var exchange=useExchangeContract(exchangeAddress);var ownershipPercentage=poolTokenBalance&&totalPoolTokens&&!totalPoolTokens.isZero()?poolTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens):undefined;var ownershipPercentageFormatted=ownershipPercentage&&amountFormatter(ownershipPercentage,16,4);var ETHOwnShare=exchangeETHBalance&&ownershipPercentage&&exchangeETHBalance.mul(ownershipPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)));var TokenOwnShare=exchangeTokenBalance&&ownershipPercentage&&exchangeTokenBalance.mul(ownershipPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)));var ETHPer=exchangeETHBalance?exchangeETHBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))):undefined;var tokenPer=exchangeTokenBalance?exchangeTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))):undefined;var ethWithdrawn=ETHPer&&valueParsed&&totalPoolTokens&&!totalPoolTokens.isZero()?ETHPer.mul(valueParsed).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens):undefined;var tokenWithdrawn=tokenPer&&valueParsed&&totalPoolTokens&&!totalPoolTokens.isZero()?tokenPer.mul(valueParsed).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens):undefined;var ethWithdrawnMin=ethWithdrawn?calculateSlippageBounds(ethWithdrawn).minimum:undefined;var tokenWithdrawnMin=tokenWithdrawn?calculateSlippageBounds(tokenWithdrawn).minimum:undefined;var fetchPoolTokens=useCallback(function(){if(exchange){exchange.totalSupply().then(function(totalSupply){setTotalPoolTokens(totalSupply);});}},[exchange]);useEffect(function(){fetchPoolTokens();library.on('block',fetchPoolTokens);return function(){library.removeListener('block',fetchPoolTokens);};},[fetchPoolTokens,library]);// BigNumber.js instance\nvar ethPrice=useETHPriceInUSD();function onRemoveLiquidity(){return _onRemoveLiquidity.apply(this,arguments);}function _onRemoveLiquidity(){_onRemoveLiquidity=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var usdTransactionSize,deadline,estimatedGasLimit;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// take ETH amount, multiplied by ETH rate and 2 for total tx size\nusdTransactionSize=ethPrice*(ethWithdrawn/1e18)*2;ReactGA.event({category:'Transaction',action:'Remove Liquidity',label:outputCurrency,value:usdTransactionSize});deadline=Math.ceil(Date.now()/1000)+DEADLINE_FROM_NOW;_context.next=5;return exchange.estimate.removeLiquidity(valueParsed,ethWithdrawnMin,tokenWithdrawnMin,deadline);case 5:estimatedGasLimit=_context.sent;exchange.removeLiquidity(valueParsed,ethWithdrawnMin,tokenWithdrawnMin,deadline,{gasLimit:calculateGasMargin(estimatedGasLimit,GAS_MARGIN)}).then(function(response){addTransaction(response);});case 7:case\"end\":return _context.stop();}}},_callee);}));return _onRemoveLiquidity.apply(this,arguments);}var b=function b(text){return React.createElement(BlueSpan,null,text);};function renderTransactionDetails(){return React.createElement(\"div\",null,React.createElement(\"div\",null,t('youAreRemoving'),\" \",b(\"\".concat(amountFormatter(ethWithdrawn,18,4),\" ETH\")),\" \",t('and'),' ',b(\"\".concat(amountFormatter(tokenWithdrawn,decimals,Math.min(decimals,4)),\" \").concat(symbol)),\" \",t('outPool')),React.createElement(LastSummaryText,null,t('youWillRemove'),\" \",b(amountFormatter(valueParsed,18,4)),\" \",t('liquidityTokens')),React.createElement(LastSummaryText,null,t('totalSupplyIs'),\" \",b(amountFormatter(totalPoolTokens,18,4))),React.createElement(LastSummaryText,null,t('tokenWorth'),\" \",b(amountFormatter(ETHPer.div(totalPoolTokens),18,4)),\" ETH \",t('and'),' ',b(amountFormatter(tokenPer.div(totalPoolTokens),decimals,Math.min(4,decimals))),\" \",symbol));}function renderSummary(){var contextualInfo='';var isError=false;if(brokenTokenWarning){contextualInfo=t('brokenToken');isError=true;}else if(inputError){contextualInfo=inputError;isError=true;}else if(!outputCurrency||outputCurrency==='ETH'){contextualInfo=t('selectTokenCont');}else if(!valueParsed){contextualInfo=t('enterValueCont');}else if(!account){contextualInfo=t('noWallet');isError=true;}return React.createElement(ContextualInfo,{key:\"context-info\",openDetailsText:t('transactionDetails'),closeDetailsText:t('hideDetails'),contextualInfo:contextualInfo,isError:isError,renderTransactionDetails:renderTransactionDetails});}function formatBalance(value){return\"Balance: \".concat(value);}var isActive=active&&account;var isValid=inputError===null;var marketRate=getMarketRate(exchangeETHBalance,exchangeTokenBalance,decimals);var newOutputDetected=outputCurrency!=='ETH'&&outputCurrency&&!INITIAL_TOKENS_CONTEXT[chainId].hasOwnProperty(outputCurrency);var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),showCustomTokenWarning=_useState14[0],setShowCustomTokenWarning=_useState14[1];useEffect(function(){if(newOutputDetected){setShowCustomTokenWarning(true);}else{setShowCustomTokenWarning(false);}},[newOutputDetected]);return React.createElement(React.Fragment,null,showCustomTokenWarning&&React.createElement(WarningCard,{onDismiss:function onDismiss(){setShowCustomTokenWarning(false);},urlAddedTokens:urlAddedTokens,currency:outputCurrency}),React.createElement(CurrencyInputPanel,{title:t('poolTokens'),extraText:poolTokenBalance&&formatBalance(amountFormatter(poolTokenBalance,18,4)),extraTextClickHander:function extraTextClickHander(){if(poolTokenBalance){var valueToSet=poolTokenBalance;if(valueToSet.gt(ethers.constants.Zero)){setValue(amountFormatter(valueToSet,18,18,false));}}},urlAddedTokens:urlAddedTokens,onCurrencySelected:setOutputCurrency,onValueChange:setValue,value:value,errorMessage:inputError,selectedTokenAddress:outputCurrency}),React.createElement(OversizedPanel,null,React.createElement(DownArrowBackground,null,React.createElement(DownArrow,{active:isActive,alt:\"arrow\"}))),React.createElement(CurrencyInputPanel,{title:t('output'),description:!!(ethWithdrawn&&tokenWithdrawn)?\"(\".concat(t('estimated'),\")\"):'',key:\"remove-liquidity-input\",renderInput:function renderInput(){return!!(ethWithdrawn&&tokenWithdrawn)?React.createElement(RemoveLiquidityOutput,null,React.createElement(RemoveLiquidityOutputText,null,\"\".concat(amountFormatter(ethWithdrawn,18,4,false),\" ETH\")),React.createElement(RemoveLiquidityOutputPlus,null,\" + \"),React.createElement(RemoveLiquidityOutputText,null,\"\".concat(amountFormatter(tokenWithdrawn,decimals,Math.min(4,decimals)),\" \").concat(symbol))):React.createElement(RemoveLiquidityOutput,null);},disableTokenSelect:true,disableUnlock:true}),React.createElement(OversizedPanel,{key:\"remove-liquidity-input-under\",hideBottom:true},React.createElement(SummaryPanel,null,React.createElement(ExchangeRateWrapper,null,React.createElement(ExchangeRate,null,t('exchangeRate')),marketRate?React.createElement(\"span\",null,\"1 ETH = \".concat(amountFormatter(marketRate,18,4),\" \").concat(symbol)):' - '),React.createElement(ExchangeRateWrapper,null,React.createElement(ExchangeRate,null,t('currentPoolSize')),exchangeETHBalance&&exchangeTokenBalance&&(decimals||decimals===0)?React.createElement(\"span\",null,\"\".concat(amountFormatter(exchangeETHBalance,18,4),\" ETH + \").concat(amountFormatter(exchangeTokenBalance,decimals,Math.min(decimals,4)),\" \").concat(symbol)):' - '),React.createElement(ExchangeRateWrapper,null,React.createElement(ExchangeRate,null,t('yourPoolShare'),\" (\",ownershipPercentageFormatted&&ownershipPercentageFormatted,\"%)\"),ETHOwnShare&&TokenOwnShare?React.createElement(\"span\",null,\"\".concat(amountFormatter(ETHOwnShare,18,4),\" ETH + \").concat(amountFormatter(TokenOwnShare,decimals,Math.min(decimals,4)),\" \").concat(symbol)):' - '))),renderSummary(),React.createElement(Flex,null,React.createElement(Button,{disabled:!isValid,onClick:onRemoveLiquidity},t('removeLiquidity'))));}","map":{"version":3,"sources":["/workspace/uniswap-exchange/src/pages/Pool/RemoveLiquidity.js"],"names":["React","useState","useEffect","useCallback","useTranslation","ReactGA","createBrowserHistory","ethers","styled","useWeb3React","useExchangeContract","useTransactionAdder","useTokenDetails","INITIAL_TOKENS_CONTEXT","useAddressBalance","useETHPriceInUSD","calculateGasMargin","amountFormatter","brokenTokens","Button","CurrencyInputPanel","ContextualInfo","OversizedPanel","ArrowDown","WarningCard","ALLOWED_SLIPPAGE","utils","bigNumberify","DEADLINE_FROM_NOW","GAS_MARGIN","BlueSpan","span","theme","royalBlue","DownArrowBackground","div","flexRowNoWrap","DownArrow","active","doveGray","RemoveLiquidityOutput","RemoveLiquidityOutputText","RemoveLiquidityOutputPlus","SummaryPanel","flexColumnNoWrap","LastSummaryText","ExchangeRateWrapper","ExchangeRate","Flex","getExchangeRate","inputValue","inputDecimals","outputValue","outputDecimals","invert","factor","pow","mul","getMarketRate","reserveETH","reserveToken","decimals","calculateSlippageBounds","value","offset","minimum","sub","maximum","add","lt","constants","Zero","gt","MaxUint256","RemoveLiquidity","params","t","library","account","chainId","addTransaction","brokenTokenWarning","setBrokenTokenWarning","history","push","window","location","pathname","poolTokenAddress","outputCurrency","setOutputCurrency","poolTokenAmount","setValue","inputError","setInputError","valueParsed","setValueParsed","i","length","toLowerCase","parsedValue","parseUnits","symbol","exchangeAddress","totalPoolTokens","setTotalPoolTokens","poolTokenBalance","exchangeETHBalance","exchangeTokenBalance","urlAddedTokens","exchange","ownershipPercentage","isZero","undefined","ownershipPercentageFormatted","ETHOwnShare","TokenOwnShare","ETHPer","tokenPer","ethWithdrawn","tokenWithdrawn","ethWithdrawnMin","tokenWithdrawnMin","fetchPoolTokens","totalSupply","then","on","removeListener","ethPrice","onRemoveLiquidity","usdTransactionSize","event","category","action","label","deadline","Math","ceil","Date","now","estimate","removeLiquidity","estimatedGasLimit","gasLimit","response","b","text","renderTransactionDetails","min","renderSummary","contextualInfo","isError","formatBalance","isActive","isValid","marketRate","newOutputDetected","hasOwnProperty","showCustomTokenWarning","setShowCustomTokenWarning","valueToSet"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport ReactGA from 'react-ga'\nimport { createBrowserHistory } from 'history'\nimport { ethers } from 'ethers'\nimport styled from 'styled-components'\n\nimport { useWeb3React, useExchangeContract } from '../../hooks'\nimport { useTransactionAdder } from '../../contexts/Transactions'\nimport { useTokenDetails, INITIAL_TOKENS_CONTEXT } from '../../contexts/Tokens'\nimport { useAddressBalance, useETHPriceInUSD } from '../../contexts/Balances'\n\nimport { calculateGasMargin, amountFormatter } from '../../utils'\nimport { brokenTokens } from '../../constants'\n\nimport { Button } from '../../theme'\nimport CurrencyInputPanel from '../../components/CurrencyInputPanel'\nimport ContextualInfo from '../../components/ContextualInfo'\nimport OversizedPanel from '../../components/OversizedPanel'\nimport ArrowDown from '../../assets/svg/SVGArrowDown'\nimport WarningCard from '../../components/WarningCard'\n\n// denominated in bips\nconst ALLOWED_SLIPPAGE = ethers.utils.bigNumberify(200)\n\n// denominated in seconds\nconst DEADLINE_FROM_NOW = 60 * 15\n\n// denominated in bips\nconst GAS_MARGIN = ethers.utils.bigNumberify(1000)\n\nconst BlueSpan = styled.span`\n  color: ${({ theme }) => theme.royalBlue};\n`\n\nconst DownArrowBackground = styled.div`\n  ${({ theme }) => theme.flexRowNoWrap}\n  justify-content: center;\n  align-items: center;\n`\n\nconst DownArrow = styled(ArrowDown)`\n  ${({ theme }) => theme.flexRowNoWrap}\n  color: ${({ theme, active }) => (active ? theme.royalBlue : theme.doveGray)};\n  width: 0.625rem;\n  height: 0.625rem;\n  position: relative;\n  padding: 0.875rem;\n`\n\nconst RemoveLiquidityOutput = styled.div`\n  ${({ theme }) => theme.flexRowNoWrap}\n  min-height: 3.5rem;\n`\n\nconst RemoveLiquidityOutputText = styled.div`\n  font-size: 1.25rem;\n  line-height: 1.5rem;\n  padding: 1rem 0.75rem;\n`\n\nconst RemoveLiquidityOutputPlus = styled.div`\n  font-size: 1.25rem;\n  line-height: 1.5rem;\n  padding: 1rem 0;\n`\n\nconst SummaryPanel = styled.div`\n  ${({ theme }) => theme.flexColumnNoWrap}\n  padding: 1rem 0;\n`\n\nconst LastSummaryText = styled.div`\n  margin-top: 1rem;\n`\n\nconst ExchangeRateWrapper = styled.div`\n  ${({ theme }) => theme.flexRowNoWrap};\n  align-items: center;\n  color: ${({ theme }) => theme.doveGray};\n  font-size: 0.75rem;\n  padding: 0.25rem 1rem 0;\n`\n\nconst ExchangeRate = styled.span`\n  flex: 1 1 auto;\n  width: 0;\n  color: ${({ theme }) => theme.doveGray};\n`\n\nconst Flex = styled.div`\n  display: flex;\n  justify-content: center;\n  padding: 2rem;\n\n  button {\n    max-width: 20rem;\n  }\n`\n\nfunction getExchangeRate(inputValue, inputDecimals, outputValue, outputDecimals, invert = false) {\n  try {\n    if (\n      inputValue &&\n      (inputDecimals || inputDecimals === 0) &&\n      outputValue &&\n      (outputDecimals || outputDecimals === 0)\n    ) {\n      const factor = ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))\n\n      if (invert) {\n        return inputValue\n          .mul(factor)\n          .mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals)))\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals)))\n          .div(outputValue)\n      } else {\n        return outputValue\n          .mul(factor)\n          .mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals)))\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals)))\n          .div(inputValue)\n      }\n    }\n  } catch {}\n}\n\nfunction getMarketRate(reserveETH, reserveToken, decimals, invert = false) {\n  return getExchangeRate(reserveETH, 18, reserveToken, decimals, invert)\n}\n\nfunction calculateSlippageBounds(value) {\n  if (value) {\n    const offset = value.mul(ALLOWED_SLIPPAGE).div(ethers.utils.bigNumberify(10000))\n    const minimum = value.sub(offset)\n    const maximum = value.add(offset)\n    return {\n      minimum: minimum.lt(ethers.constants.Zero) ? ethers.constants.Zero : minimum,\n      maximum: maximum.gt(ethers.constants.MaxUint256) ? ethers.constants.MaxUint256 : maximum\n    }\n  } else {\n    return {}\n  }\n}\n\nexport default function RemoveLiquidity({ params }) {\n  const { t } = useTranslation()\n  const { library, account, active, chainId } = useWeb3React()\n\n  const addTransaction = useTransactionAdder()\n\n  const [brokenTokenWarning, setBrokenTokenWarning] = useState()\n\n  // clear url of query\n  useEffect(() => {\n    const history = createBrowserHistory()\n    history.push(window.location.pathname + '')\n  }, [])\n\n  const [outputCurrency, setOutputCurrency] = useState(params.poolTokenAddress)\n  const [value, setValue] = useState(params.poolTokenAmount ? params.poolTokenAmount : '')\n  const [inputError, setInputError] = useState()\n  const [valueParsed, setValueParsed] = useState()\n\n  useEffect(() => {\n    setBrokenTokenWarning(false)\n    for (let i = 0; i < brokenTokens.length; i++) {\n      if (brokenTokens[i].toLowerCase() === outputCurrency.toLowerCase()) {\n        setBrokenTokenWarning(true)\n      }\n    }\n  }, [outputCurrency])\n\n  // parse value\n  useEffect(() => {\n    try {\n      const parsedValue = ethers.utils.parseUnits(value, 18)\n      setValueParsed(parsedValue)\n    } catch {\n      if (value !== '') {\n        setInputError(t('inputNotValid'))\n      }\n    }\n\n    return () => {\n      setInputError()\n      setValueParsed()\n    }\n  }, [t, value])\n\n  const { symbol, decimals, exchangeAddress } = useTokenDetails(outputCurrency)\n\n  const [totalPoolTokens, setTotalPoolTokens] = useState()\n  const poolTokenBalance = useAddressBalance(account, exchangeAddress)\n  const exchangeETHBalance = useAddressBalance(exchangeAddress, 'ETH')\n  const exchangeTokenBalance = useAddressBalance(exchangeAddress, outputCurrency)\n\n  const urlAddedTokens = {}\n  if (params.poolTokenAddress) {\n    urlAddedTokens[params.poolTokenAddress] = true\n  }\n\n  // input validation\n  useEffect(() => {\n    if (valueParsed && poolTokenBalance) {\n      if (valueParsed.gt(poolTokenBalance)) {\n        setInputError(t('insufficientBalance'))\n      } else {\n        setInputError(null)\n      }\n    }\n  }, [poolTokenBalance, t, valueParsed])\n\n  const exchange = useExchangeContract(exchangeAddress)\n\n  const ownershipPercentage =\n    poolTokenBalance && totalPoolTokens && !totalPoolTokens.isZero()\n      ? poolTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens)\n      : undefined\n  const ownershipPercentageFormatted = ownershipPercentage && amountFormatter(ownershipPercentage, 16, 4)\n\n  const ETHOwnShare =\n    exchangeETHBalance &&\n    ownershipPercentage &&\n    exchangeETHBalance.mul(ownershipPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n  const TokenOwnShare =\n    exchangeTokenBalance &&\n    ownershipPercentage &&\n    exchangeTokenBalance.mul(ownershipPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n\n  const ETHPer = exchangeETHBalance\n    ? exchangeETHBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n    : undefined\n  const tokenPer = exchangeTokenBalance\n    ? exchangeTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n    : undefined\n\n  const ethWithdrawn =\n    ETHPer && valueParsed && totalPoolTokens && !totalPoolTokens.isZero()\n      ? ETHPer.mul(valueParsed)\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n          .div(totalPoolTokens)\n      : undefined\n  const tokenWithdrawn =\n    tokenPer && valueParsed && totalPoolTokens && !totalPoolTokens.isZero()\n      ? tokenPer\n          .mul(valueParsed)\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n          .div(totalPoolTokens)\n      : undefined\n\n  const ethWithdrawnMin = ethWithdrawn ? calculateSlippageBounds(ethWithdrawn).minimum : undefined\n  const tokenWithdrawnMin = tokenWithdrawn ? calculateSlippageBounds(tokenWithdrawn).minimum : undefined\n\n  const fetchPoolTokens = useCallback(() => {\n    if (exchange) {\n      exchange.totalSupply().then(totalSupply => {\n        setTotalPoolTokens(totalSupply)\n      })\n    }\n  }, [exchange])\n  useEffect(() => {\n    fetchPoolTokens()\n    library.on('block', fetchPoolTokens)\n\n    return () => {\n      library.removeListener('block', fetchPoolTokens)\n    }\n  }, [fetchPoolTokens, library])\n\n  // BigNumber.js instance\n  const ethPrice = useETHPriceInUSD()\n\n  async function onRemoveLiquidity() {\n    // take ETH amount, multiplied by ETH rate and 2 for total tx size\n    let usdTransactionSize = ethPrice * (ethWithdrawn / 1e18) * 2\n    ReactGA.event({\n      category: 'Transaction',\n      action: 'Remove Liquidity',\n      label: outputCurrency,\n      value: usdTransactionSize\n    })\n\n    const deadline = Math.ceil(Date.now() / 1000) + DEADLINE_FROM_NOW\n\n    const estimatedGasLimit = await exchange.estimate.removeLiquidity(\n      valueParsed,\n      ethWithdrawnMin,\n      tokenWithdrawnMin,\n      deadline\n    )\n\n    exchange\n      .removeLiquidity(valueParsed, ethWithdrawnMin, tokenWithdrawnMin, deadline, {\n        gasLimit: calculateGasMargin(estimatedGasLimit, GAS_MARGIN)\n      })\n      .then(response => {\n        addTransaction(response)\n      })\n  }\n\n  const b = text => <BlueSpan>{text}</BlueSpan>\n\n  function renderTransactionDetails() {\n    return (\n      <div>\n        <div>\n          {t('youAreRemoving')} {b(`${amountFormatter(ethWithdrawn, 18, 4)} ETH`)} {t('and')}{' '}\n          {b(`${amountFormatter(tokenWithdrawn, decimals, Math.min(decimals, 4))} ${symbol}`)} {t('outPool')}\n        </div>\n        <LastSummaryText>\n          {t('youWillRemove')} {b(amountFormatter(valueParsed, 18, 4))} {t('liquidityTokens')}\n        </LastSummaryText>\n        <LastSummaryText>\n          {t('totalSupplyIs')} {b(amountFormatter(totalPoolTokens, 18, 4))}\n        </LastSummaryText>\n        <LastSummaryText>\n          {t('tokenWorth')} {b(amountFormatter(ETHPer.div(totalPoolTokens), 18, 4))} ETH {t('and')}{' '}\n          {b(amountFormatter(tokenPer.div(totalPoolTokens), decimals, Math.min(4, decimals)))} {symbol}\n        </LastSummaryText>\n      </div>\n    )\n  }\n\n  function renderSummary() {\n    let contextualInfo = ''\n    let isError = false\n    if (brokenTokenWarning) {\n      contextualInfo = t('brokenToken')\n      isError = true\n    } else if (inputError) {\n      contextualInfo = inputError\n      isError = true\n    } else if (!outputCurrency || outputCurrency === 'ETH') {\n      contextualInfo = t('selectTokenCont')\n    } else if (!valueParsed) {\n      contextualInfo = t('enterValueCont')\n    } else if (!account) {\n      contextualInfo = t('noWallet')\n      isError = true\n    }\n\n    return (\n      <ContextualInfo\n        key=\"context-info\"\n        openDetailsText={t('transactionDetails')}\n        closeDetailsText={t('hideDetails')}\n        contextualInfo={contextualInfo}\n        isError={isError}\n        renderTransactionDetails={renderTransactionDetails}\n      />\n    )\n  }\n\n  function formatBalance(value) {\n    return `Balance: ${value}`\n  }\n\n  const isActive = active && account\n  const isValid = inputError === null\n\n  const marketRate = getMarketRate(exchangeETHBalance, exchangeTokenBalance, decimals)\n\n  const newOutputDetected =\n    outputCurrency !== 'ETH' && outputCurrency && !INITIAL_TOKENS_CONTEXT[chainId].hasOwnProperty(outputCurrency)\n\n  const [showCustomTokenWarning, setShowCustomTokenWarning] = useState(false)\n\n  useEffect(() => {\n    if (newOutputDetected) {\n      setShowCustomTokenWarning(true)\n    } else {\n      setShowCustomTokenWarning(false)\n    }\n  }, [newOutputDetected])\n\n  return (\n    <>\n      {showCustomTokenWarning && (\n        <WarningCard\n          onDismiss={() => {\n            setShowCustomTokenWarning(false)\n          }}\n          urlAddedTokens={urlAddedTokens}\n          currency={outputCurrency}\n        />\n      )}\n      <CurrencyInputPanel\n        title={t('poolTokens')}\n        extraText={poolTokenBalance && formatBalance(amountFormatter(poolTokenBalance, 18, 4))}\n        extraTextClickHander={() => {\n          if (poolTokenBalance) {\n            const valueToSet = poolTokenBalance\n            if (valueToSet.gt(ethers.constants.Zero)) {\n              setValue(amountFormatter(valueToSet, 18, 18, false))\n            }\n          }\n        }}\n        urlAddedTokens={urlAddedTokens}\n        onCurrencySelected={setOutputCurrency}\n        onValueChange={setValue}\n        value={value}\n        errorMessage={inputError}\n        selectedTokenAddress={outputCurrency}\n      />\n      <OversizedPanel>\n        <DownArrowBackground>\n          <DownArrow active={isActive} alt=\"arrow\" />\n        </DownArrowBackground>\n      </OversizedPanel>\n      <CurrencyInputPanel\n        title={t('output')}\n        description={!!(ethWithdrawn && tokenWithdrawn) ? `(${t('estimated')})` : ''}\n        key=\"remove-liquidity-input\"\n        renderInput={() =>\n          !!(ethWithdrawn && tokenWithdrawn) ? (\n            <RemoveLiquidityOutput>\n              <RemoveLiquidityOutputText>\n                {`${amountFormatter(ethWithdrawn, 18, 4, false)} ETH`}\n              </RemoveLiquidityOutputText>\n              <RemoveLiquidityOutputPlus> + </RemoveLiquidityOutputPlus>\n              <RemoveLiquidityOutputText>\n                {`${amountFormatter(tokenWithdrawn, decimals, Math.min(4, decimals))} ${symbol}`}\n              </RemoveLiquidityOutputText>\n            </RemoveLiquidityOutput>\n          ) : (\n            <RemoveLiquidityOutput />\n          )\n        }\n        disableTokenSelect\n        disableUnlock\n      />\n      <OversizedPanel key=\"remove-liquidity-input-under\" hideBottom>\n        <SummaryPanel>\n          <ExchangeRateWrapper>\n            <ExchangeRate>{t('exchangeRate')}</ExchangeRate>\n            {marketRate ? <span>{`1 ETH = ${amountFormatter(marketRate, 18, 4)} ${symbol}`}</span> : ' - '}\n          </ExchangeRateWrapper>\n          <ExchangeRateWrapper>\n            <ExchangeRate>{t('currentPoolSize')}</ExchangeRate>\n            {exchangeETHBalance && exchangeTokenBalance && (decimals || decimals === 0) ? (\n              <span>{`${amountFormatter(exchangeETHBalance, 18, 4)} ETH + ${amountFormatter(\n                exchangeTokenBalance,\n                decimals,\n                Math.min(decimals, 4)\n              )} ${symbol}`}</span>\n            ) : (\n              ' - '\n            )}\n          </ExchangeRateWrapper>\n          <ExchangeRateWrapper>\n            <ExchangeRate>\n              {t('yourPoolShare')} ({ownershipPercentageFormatted && ownershipPercentageFormatted}%)\n            </ExchangeRate>\n            {ETHOwnShare && TokenOwnShare ? (\n              <span>\n                {`${amountFormatter(ETHOwnShare, 18, 4)} ETH + ${amountFormatter(\n                  TokenOwnShare,\n                  decimals,\n                  Math.min(decimals, 4)\n                )} ${symbol}`}\n              </span>\n            ) : (\n              ' - '\n            )}\n          </ExchangeRateWrapper>\n        </SummaryPanel>\n      </OversizedPanel>\n      {renderSummary()}\n      <Flex>\n        <Button disabled={!isValid} onClick={onRemoveLiquidity}>\n          {t('removeLiquidity')}\n        </Button>\n      </Flex>\n    </>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}