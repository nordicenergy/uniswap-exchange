{"ast":null,"code":"import _regeneratorRuntime from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject11(){var data=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: center;\\n  padding: 2rem;\\n\\n  button {\\n    max-width: 20rem;\\n  }\\n\"]);_templateObject11=function _templateObject11(){return data;};return data;}function _templateObject10(){var data=_taggedTemplateLiteral([\"\\n  flex: 1 1 auto;\\n  width: 0;\\n  color: \",\";\\n\"]);_templateObject10=function _templateObject10(){return data;};return data;}function _templateObject9(){var data=_taggedTemplateLiteral([\"\\n  \",\";\\n  align-items: center;\\n  color: \",\";\\n  font-size: 0.75rem;\\n  padding: 0.25rem 1rem 0;\\n\"]);_templateObject9=function _templateObject9(){return data;};return data;}function _templateObject8(){var data=_taggedTemplateLiteral([\"\\n  margin-top: 1rem;\\n\"]);_templateObject8=function _templateObject8(){return data;};return data;}function _templateObject7(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  padding: 1rem 0;\\n\"]);_templateObject7=function _templateObject7(){return data;};return data;}function _templateObject6(){var data=_taggedTemplateLiteral([\"\\n  font-size: 1.25rem;\\n  line-height: 1.5rem;\\n  padding: 1rem 0;\\n\"]);_templateObject6=function _templateObject6(){return data;};return data;}function _templateObject5(){var data=_taggedTemplateLiteral([\"\\n  font-size: 1.25rem;\\n  line-height: 1.5rem;\\n  padding: 1rem 0.75rem;\\n\"]);_templateObject5=function _templateObject5(){return data;};return data;}function _templateObject4(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  min-height: 3.5rem;\\n\"]);_templateObject4=function _templateObject4(){return data;};return data;}function _templateObject3(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  color: \",\";\\n  width: 0.625rem;\\n  height: 0.625rem;\\n  position: relative;\\n  padding: 0.875rem;\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  justify-content: center;\\n  align-items: center;\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  color: \",\";\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useState,useEffect,useCallback}from'react';import{useTranslation}from'react-i18next';import ReactGA from'react-ga';import{createBrowserHistory}from'history';import{ethers}from'ethers';import styled from'styled-components';import{useWeb3React,useExchangeContract}from'../../hooks';import{Button}from'../../theme';import CurrencyInputPanel from'../../components/CurrencyInputPanel';import ContextualInfo from'../../components/ContextualInfo';import OversizedPanel from'../../components/OversizedPanel';import ArrowDown from'../../assets/svg/SVGArrowDown';import{useTransactionAdder}from'../../contexts/Transactions';import{useTokenDetails}from'../../contexts/Tokens';import{useAddressBalance,useETHPriceInUSD}from'../../contexts/Balances';import{calculateGasMargin,amountFormatter}from'../../utils';// denominated in bips\nvar ALLOWED_SLIPPAGE=ethers.utils.bigNumberify(200);// denominated in seconds\nvar DEADLINE_FROM_NOW=60*15;// denominated in bips\nvar GAS_MARGIN=ethers.utils.bigNumberify(1000);var BlueSpan=styled.span(_templateObject(),function(_ref){var theme=_ref.theme;return theme.royalBlue;});var DownArrowBackground=styled.div(_templateObject2(),function(_ref2){var theme=_ref2.theme;return theme.flexRowNoWrap;});var DownArrow=styled(ArrowDown)(_templateObject3(),function(_ref3){var theme=_ref3.theme;return theme.flexRowNoWrap;},function(_ref4){var theme=_ref4.theme,active=_ref4.active;return active?theme.royalBlue:theme.doveGray;});var RemoveLiquidityOutput=styled.div(_templateObject4(),function(_ref5){var theme=_ref5.theme;return theme.flexRowNoWrap;});var RemoveLiquidityOutputText=styled.div(_templateObject5());var RemoveLiquidityOutputPlus=styled.div(_templateObject6());var SummaryPanel=styled.div(_templateObject7(),function(_ref6){var theme=_ref6.theme;return theme.flexColumnNoWrap;});var LastSummaryText=styled.div(_templateObject8());var ExchangeRateWrapper=styled.div(_templateObject9(),function(_ref7){var theme=_ref7.theme;return theme.flexRowNoWrap;},function(_ref8){var theme=_ref8.theme;return theme.doveGray;});var ExchangeRate=styled.span(_templateObject10(),function(_ref9){var theme=_ref9.theme;return theme.doveGray;});var Flex=styled.div(_templateObject11());function getExchangeRate(inputValue,inputDecimals,outputValue,outputDecimals){var invert=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;try{if(inputValue&&(inputDecimals||inputDecimals===0)&&outputValue&&(outputDecimals||outputDecimals===0)){var factor=ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18));if(invert){return inputValue.mul(factor).div(outputValue).mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals))).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals)));}else{return outputValue.mul(factor).div(inputValue).mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals))).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals)));}}}catch(_unused){}}function getMarketRate(reserveETH,reserveToken,decimals){var invert=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return getExchangeRate(reserveETH,18,reserveToken,decimals,invert);}function calculateSlippageBounds(value){if(value){var offset=value.mul(ALLOWED_SLIPPAGE).div(ethers.utils.bigNumberify(10000));var minimum=value.sub(offset);var maximum=value.add(offset);return{minimum:minimum.lt(ethers.constants.Zero)?ethers.constants.Zero:minimum,maximum:maximum.gt(ethers.constants.MaxUint256)?ethers.constants.MaxUint256:maximum};}else{return{};}}export default function RemoveLiquidity(_ref10){var params=_ref10.params;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useWeb3React=useWeb3React(),library=_useWeb3React.library,account=_useWeb3React.account,active=_useWeb3React.active;var addTransaction=useTransactionAdder();// clear url of query\nuseEffect(function(){var history=createBrowserHistory();history.push(window.location.pathname+'');},[]);var _useState=useState(params.poolTokenAddress),_useState2=_slicedToArray(_useState,2),outputCurrency=_useState2[0],setOutputCurrency=_useState2[1];var _useState3=useState(params.poolTokenAmount?params.poolTokenAmount:''),_useState4=_slicedToArray(_useState3,2),value=_useState4[0],setValue=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),inputError=_useState6[0],setInputError=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),valueParsed=_useState8[0],setValueParsed=_useState8[1];// parse value\nuseEffect(function(){try{var parsedValue=ethers.utils.parseUnits(value,18);setValueParsed(parsedValue);}catch(_unused2){if(value!==''){setInputError(t('inputNotValid'));}}return function(){setInputError();setValueParsed();};},[t,value]);var _useTokenDetails=useTokenDetails(outputCurrency),symbol=_useTokenDetails.symbol,decimals=_useTokenDetails.decimals,exchangeAddress=_useTokenDetails.exchangeAddress;var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),totalPoolTokens=_useState10[0],setTotalPoolTokens=_useState10[1];var poolTokenBalance=useAddressBalance(account,exchangeAddress);var exchangeETHBalance=useAddressBalance(exchangeAddress,'ETH');var exchangeTokenBalance=useAddressBalance(exchangeAddress,outputCurrency);// input validation\nuseEffect(function(){if(valueParsed&&poolTokenBalance){if(valueParsed.gt(poolTokenBalance)){setInputError(t('insufficientBalance'));}else{setInputError(null);}}},[poolTokenBalance,t,valueParsed]);var exchange=useExchangeContract(exchangeAddress);var ownershipPercentage=poolTokenBalance&&totalPoolTokens&&!totalPoolTokens.isZero()?poolTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens):undefined;var ownershipPercentageFormatted=ownershipPercentage&&amountFormatter(ownershipPercentage,16,4);var ETHOwnShare=exchangeETHBalance&&ownershipPercentage&&exchangeETHBalance.mul(ownershipPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)));var TokenOwnShare=exchangeTokenBalance&&ownershipPercentage&&exchangeTokenBalance.mul(ownershipPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)));var ETHPer=exchangeETHBalance&&totalPoolTokens&&!totalPoolTokens.isZero()?exchangeETHBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens):undefined;var tokenPer=exchangeTokenBalance&&totalPoolTokens&&!totalPoolTokens.isZero()?exchangeTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens):undefined;var ethWithdrawn=ETHPer&&valueParsed?ETHPer.mul(valueParsed).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))):undefined;var tokenWithdrawn=tokenPer&&valueParsed?tokenPer.mul(valueParsed).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))):undefined;var ethWithdrawnMin=ethWithdrawn?calculateSlippageBounds(ethWithdrawn).minimum:undefined;var tokenWithdrawnMin=tokenWithdrawn?calculateSlippageBounds(tokenWithdrawn).minimum:undefined;var fetchPoolTokens=useCallback(function(){if(exchange){exchange.totalSupply().then(function(totalSupply){setTotalPoolTokens(totalSupply);});}},[exchange]);useEffect(function(){fetchPoolTokens();library.on('block',fetchPoolTokens);return function(){library.removeListener('block',fetchPoolTokens);};},[fetchPoolTokens,library]);// BigNumber.js instance\nvar ethPrice=useETHPriceInUSD();function onRemoveLiquidity(){return _onRemoveLiquidity.apply(this,arguments);}function _onRemoveLiquidity(){_onRemoveLiquidity=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var usdTransactionSize,deadline,estimatedGasLimit;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// take ETH amount, multiplied by ETH rate and 2 for total tx size\nusdTransactionSize=ethPrice*(ethWithdrawn/1e18)*2;ReactGA.event({category:'Transaction',action:'Remove Liquidity',label:outputCurrency,value:usdTransactionSize});deadline=Math.ceil(Date.now()/1000)+DEADLINE_FROM_NOW;_context.next=5;return exchange.estimate.removeLiquidity(valueParsed,ethWithdrawnMin,tokenWithdrawnMin,deadline);case 5:estimatedGasLimit=_context.sent;exchange.removeLiquidity(valueParsed,ethWithdrawnMin,tokenWithdrawnMin,deadline,{gasLimit:calculateGasMargin(estimatedGasLimit,GAS_MARGIN)}).then(function(response){addTransaction(response);});case 7:case\"end\":return _context.stop();}}},_callee);}));return _onRemoveLiquidity.apply(this,arguments);}var b=function b(text){return React.createElement(BlueSpan,null,text);};function renderTransactionDetails(){return React.createElement(\"div\",null,React.createElement(\"div\",null,t('youAreRemoving'),\" \",b(\"\".concat(amountFormatter(ethWithdrawn,18,4),\" ETH\")),\" \",t('and'),' ',b(\"\".concat(amountFormatter(tokenWithdrawn,decimals,Math.min(decimals,4)),\" \").concat(symbol)),\" \",t('outPool')),React.createElement(LastSummaryText,null,t('youWillRemove'),\" \",b(amountFormatter(valueParsed,18,4)),\" \",t('liquidityTokens')),React.createElement(LastSummaryText,null,t('totalSupplyIs'),\" \",b(amountFormatter(totalPoolTokens,18,4))),React.createElement(LastSummaryText,null,t('tokenWorth'),\" \",b(amountFormatter(ETHPer,18,4)),\" ETH \",t('and'),' ',b(amountFormatter(tokenPer,decimals,Math.min(4,decimals))),\" \",symbol));}function renderSummary(){var contextualInfo='';var isError=false;if(inputError){contextualInfo=inputError;isError=true;}else if(!outputCurrency||outputCurrency==='ETH'){contextualInfo=t('selectTokenCont');}else if(!valueParsed){contextualInfo=t('enterValueCont');}else if(!account){contextualInfo=t('noWallet');isError=true;}return React.createElement(ContextualInfo,{key:\"context-info\",openDetailsText:t('transactionDetails'),closeDetailsText:t('hideDetails'),contextualInfo:contextualInfo,isError:isError,renderTransactionDetails:renderTransactionDetails});}function formatBalance(value){return\"Balance: \".concat(value);}var isActive=active&&account;var isValid=inputError===null;var marketRate=getMarketRate(exchangeETHBalance,exchangeTokenBalance,decimals);return React.createElement(React.Fragment,null,React.createElement(CurrencyInputPanel,{title:t('poolTokens'),extraText:poolTokenBalance&&formatBalance(amountFormatter(poolTokenBalance,18,4)),extraTextClickHander:function extraTextClickHander(){if(poolTokenBalance){var valueToSet=poolTokenBalance;if(valueToSet.gt(ethers.constants.Zero)){setValue(amountFormatter(valueToSet,18,18,false));}}},onCurrencySelected:setOutputCurrency,onValueChange:setValue,value:value,errorMessage:inputError,selectedTokenAddress:outputCurrency}),React.createElement(OversizedPanel,null,React.createElement(DownArrowBackground,null,React.createElement(DownArrow,{active:isActive,alt:\"arrow\"}))),React.createElement(CurrencyInputPanel,{title:t('output'),description:!!(ethWithdrawn&&tokenWithdrawn)?\"(\".concat(t('estimated'),\")\"):'',key:\"remove-liquidity-input\",renderInput:function renderInput(){return!!(ethWithdrawn&&tokenWithdrawn)?React.createElement(RemoveLiquidityOutput,null,React.createElement(RemoveLiquidityOutputText,null,\"\".concat(amountFormatter(ethWithdrawn,18,4,false),\" ETH\")),React.createElement(RemoveLiquidityOutputPlus,null,\" + \"),React.createElement(RemoveLiquidityOutputText,null,\"\".concat(amountFormatter(tokenWithdrawn,decimals,Math.min(4,decimals)),\" \").concat(symbol))):React.createElement(RemoveLiquidityOutput,null);},disableTokenSelect:true,disableUnlock:true}),React.createElement(OversizedPanel,{key:\"remove-liquidity-input-under\",hideBottom:true},React.createElement(SummaryPanel,null,React.createElement(ExchangeRateWrapper,null,React.createElement(ExchangeRate,null,t('exchangeRate')),marketRate?React.createElement(\"span\",null,\"1 ETH = \".concat(amountFormatter(marketRate,18,4),\" \").concat(symbol)):' - '),React.createElement(ExchangeRateWrapper,null,React.createElement(ExchangeRate,null,t('currentPoolSize')),exchangeETHBalance&&exchangeTokenBalance&&(decimals||decimals===0)?React.createElement(\"span\",null,\"\".concat(amountFormatter(exchangeETHBalance,18,4),\" ETH + \").concat(amountFormatter(exchangeTokenBalance,decimals,Math.min(decimals,4)),\" \").concat(symbol)):' - '),React.createElement(ExchangeRateWrapper,null,React.createElement(ExchangeRate,null,t('yourPoolShare'),\" (\",ownershipPercentageFormatted&&ownershipPercentageFormatted,\"%)\"),ETHOwnShare&&TokenOwnShare?React.createElement(\"span\",null,\"\".concat(amountFormatter(ETHOwnShare,18,4),\" ETH + \").concat(amountFormatter(TokenOwnShare,decimals,Math.min(decimals,4)),\" \").concat(symbol)):' - '))),renderSummary(),React.createElement(Flex,null,React.createElement(Button,{disabled:!isValid,onClick:onRemoveLiquidity},t('removeLiquidity'))));}","map":{"version":3,"sources":["/workspace/uniswap-exchange/src/pages/Pool/RemoveLiquidity.js"],"names":["React","useState","useEffect","useCallback","useTranslation","ReactGA","createBrowserHistory","ethers","styled","useWeb3React","useExchangeContract","Button","CurrencyInputPanel","ContextualInfo","OversizedPanel","ArrowDown","useTransactionAdder","useTokenDetails","useAddressBalance","useETHPriceInUSD","calculateGasMargin","amountFormatter","ALLOWED_SLIPPAGE","utils","bigNumberify","DEADLINE_FROM_NOW","GAS_MARGIN","BlueSpan","span","theme","royalBlue","DownArrowBackground","div","flexRowNoWrap","DownArrow","active","doveGray","RemoveLiquidityOutput","RemoveLiquidityOutputText","RemoveLiquidityOutputPlus","SummaryPanel","flexColumnNoWrap","LastSummaryText","ExchangeRateWrapper","ExchangeRate","Flex","getExchangeRate","inputValue","inputDecimals","outputValue","outputDecimals","invert","factor","pow","mul","getMarketRate","reserveETH","reserveToken","decimals","calculateSlippageBounds","value","offset","minimum","sub","maximum","add","lt","constants","Zero","gt","MaxUint256","RemoveLiquidity","params","t","library","account","addTransaction","history","push","window","location","pathname","poolTokenAddress","outputCurrency","setOutputCurrency","poolTokenAmount","setValue","inputError","setInputError","valueParsed","setValueParsed","parsedValue","parseUnits","symbol","exchangeAddress","totalPoolTokens","setTotalPoolTokens","poolTokenBalance","exchangeETHBalance","exchangeTokenBalance","exchange","ownershipPercentage","isZero","undefined","ownershipPercentageFormatted","ETHOwnShare","TokenOwnShare","ETHPer","tokenPer","ethWithdrawn","tokenWithdrawn","ethWithdrawnMin","tokenWithdrawnMin","fetchPoolTokens","totalSupply","then","on","removeListener","ethPrice","onRemoveLiquidity","usdTransactionSize","event","category","action","label","deadline","Math","ceil","Date","now","estimate","removeLiquidity","estimatedGasLimit","gasLimit","response","b","text","renderTransactionDetails","min","renderSummary","contextualInfo","isError","formatBalance","isActive","isValid","marketRate","valueToSet"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport ReactGA from 'react-ga'\nimport { createBrowserHistory } from 'history'\nimport { ethers } from 'ethers'\nimport styled from 'styled-components'\n\nimport { useWeb3React, useExchangeContract } from '../../hooks'\nimport { Button } from '../../theme'\nimport CurrencyInputPanel from '../../components/CurrencyInputPanel'\nimport ContextualInfo from '../../components/ContextualInfo'\nimport OversizedPanel from '../../components/OversizedPanel'\nimport ArrowDown from '../../assets/svg/SVGArrowDown'\nimport { useTransactionAdder } from '../../contexts/Transactions'\nimport { useTokenDetails } from '../../contexts/Tokens'\nimport { useAddressBalance, useETHPriceInUSD } from '../../contexts/Balances'\nimport { calculateGasMargin, amountFormatter } from '../../utils'\n\n// denominated in bips\nconst ALLOWED_SLIPPAGE = ethers.utils.bigNumberify(200)\n\n// denominated in seconds\nconst DEADLINE_FROM_NOW = 60 * 15\n\n// denominated in bips\nconst GAS_MARGIN = ethers.utils.bigNumberify(1000)\n\nconst BlueSpan = styled.span`\n  color: ${({ theme }) => theme.royalBlue};\n`\n\nconst DownArrowBackground = styled.div`\n  ${({ theme }) => theme.flexRowNoWrap}\n  justify-content: center;\n  align-items: center;\n`\n\nconst DownArrow = styled(ArrowDown)`\n  ${({ theme }) => theme.flexRowNoWrap}\n  color: ${({ theme, active }) => (active ? theme.royalBlue : theme.doveGray)};\n  width: 0.625rem;\n  height: 0.625rem;\n  position: relative;\n  padding: 0.875rem;\n`\n\nconst RemoveLiquidityOutput = styled.div`\n  ${({ theme }) => theme.flexRowNoWrap}\n  min-height: 3.5rem;\n`\n\nconst RemoveLiquidityOutputText = styled.div`\n  font-size: 1.25rem;\n  line-height: 1.5rem;\n  padding: 1rem 0.75rem;\n`\n\nconst RemoveLiquidityOutputPlus = styled.div`\n  font-size: 1.25rem;\n  line-height: 1.5rem;\n  padding: 1rem 0;\n`\n\nconst SummaryPanel = styled.div`\n  ${({ theme }) => theme.flexColumnNoWrap}\n  padding: 1rem 0;\n`\n\nconst LastSummaryText = styled.div`\n  margin-top: 1rem;\n`\n\nconst ExchangeRateWrapper = styled.div`\n  ${({ theme }) => theme.flexRowNoWrap};\n  align-items: center;\n  color: ${({ theme }) => theme.doveGray};\n  font-size: 0.75rem;\n  padding: 0.25rem 1rem 0;\n`\n\nconst ExchangeRate = styled.span`\n  flex: 1 1 auto;\n  width: 0;\n  color: ${({ theme }) => theme.doveGray};\n`\n\nconst Flex = styled.div`\n  display: flex;\n  justify-content: center;\n  padding: 2rem;\n\n  button {\n    max-width: 20rem;\n  }\n`\n\nfunction getExchangeRate(inputValue, inputDecimals, outputValue, outputDecimals, invert = false) {\n  try {\n    if (\n      inputValue &&\n      (inputDecimals || inputDecimals === 0) &&\n      outputValue &&\n      (outputDecimals || outputDecimals === 0)\n    ) {\n      const factor = ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))\n\n      if (invert) {\n        return inputValue\n          .mul(factor)\n          .div(outputValue)\n          .mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals)))\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals)))\n      } else {\n        return outputValue\n          .mul(factor)\n          .div(inputValue)\n          .mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals)))\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals)))\n      }\n    }\n  } catch {}\n}\n\nfunction getMarketRate(reserveETH, reserveToken, decimals, invert = false) {\n  return getExchangeRate(reserveETH, 18, reserveToken, decimals, invert)\n}\n\nfunction calculateSlippageBounds(value) {\n  if (value) {\n    const offset = value.mul(ALLOWED_SLIPPAGE).div(ethers.utils.bigNumberify(10000))\n    const minimum = value.sub(offset)\n    const maximum = value.add(offset)\n    return {\n      minimum: minimum.lt(ethers.constants.Zero) ? ethers.constants.Zero : minimum,\n      maximum: maximum.gt(ethers.constants.MaxUint256) ? ethers.constants.MaxUint256 : maximum\n    }\n  } else {\n    return {}\n  }\n}\n\nexport default function RemoveLiquidity({ params }) {\n  const { t } = useTranslation()\n  const { library, account, active } = useWeb3React()\n\n  const addTransaction = useTransactionAdder()\n\n  // clear url of query\n  useEffect(() => {\n    const history = createBrowserHistory()\n    history.push(window.location.pathname + '')\n  }, [])\n\n  const [outputCurrency, setOutputCurrency] = useState(params.poolTokenAddress)\n  const [value, setValue] = useState(params.poolTokenAmount ? params.poolTokenAmount : '')\n  const [inputError, setInputError] = useState()\n  const [valueParsed, setValueParsed] = useState()\n  // parse value\n  useEffect(() => {\n    try {\n      const parsedValue = ethers.utils.parseUnits(value, 18)\n      setValueParsed(parsedValue)\n    } catch {\n      if (value !== '') {\n        setInputError(t('inputNotValid'))\n      }\n    }\n\n    return () => {\n      setInputError()\n      setValueParsed()\n    }\n  }, [t, value])\n\n  const { symbol, decimals, exchangeAddress } = useTokenDetails(outputCurrency)\n\n  const [totalPoolTokens, setTotalPoolTokens] = useState()\n  const poolTokenBalance = useAddressBalance(account, exchangeAddress)\n  const exchangeETHBalance = useAddressBalance(exchangeAddress, 'ETH')\n  const exchangeTokenBalance = useAddressBalance(exchangeAddress, outputCurrency)\n\n  // input validation\n  useEffect(() => {\n    if (valueParsed && poolTokenBalance) {\n      if (valueParsed.gt(poolTokenBalance)) {\n        setInputError(t('insufficientBalance'))\n      } else {\n        setInputError(null)\n      }\n    }\n  }, [poolTokenBalance, t, valueParsed])\n\n  const exchange = useExchangeContract(exchangeAddress)\n\n  const ownershipPercentage =\n    poolTokenBalance && totalPoolTokens && !totalPoolTokens.isZero()\n      ? poolTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens)\n      : undefined\n  const ownershipPercentageFormatted = ownershipPercentage && amountFormatter(ownershipPercentage, 16, 4)\n\n  const ETHOwnShare =\n    exchangeETHBalance &&\n    ownershipPercentage &&\n    exchangeETHBalance.mul(ownershipPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n  const TokenOwnShare =\n    exchangeTokenBalance &&\n    ownershipPercentage &&\n    exchangeTokenBalance.mul(ownershipPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n\n  const ETHPer =\n    exchangeETHBalance && totalPoolTokens && !totalPoolTokens.isZero()\n      ? exchangeETHBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens)\n      : undefined\n  const tokenPer =\n    exchangeTokenBalance && totalPoolTokens && !totalPoolTokens.isZero()\n      ? exchangeTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens)\n      : undefined\n\n  const ethWithdrawn =\n    ETHPer && valueParsed\n      ? ETHPer.mul(valueParsed).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n      : undefined\n  const tokenWithdrawn =\n    tokenPer && valueParsed\n      ? tokenPer.mul(valueParsed).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n      : undefined\n\n  const ethWithdrawnMin = ethWithdrawn ? calculateSlippageBounds(ethWithdrawn).minimum : undefined\n  const tokenWithdrawnMin = tokenWithdrawn ? calculateSlippageBounds(tokenWithdrawn).minimum : undefined\n\n  const fetchPoolTokens = useCallback(() => {\n    if (exchange) {\n      exchange.totalSupply().then(totalSupply => {\n        setTotalPoolTokens(totalSupply)\n      })\n    }\n  }, [exchange])\n  useEffect(() => {\n    fetchPoolTokens()\n    library.on('block', fetchPoolTokens)\n\n    return () => {\n      library.removeListener('block', fetchPoolTokens)\n    }\n  }, [fetchPoolTokens, library])\n\n  // BigNumber.js instance\n  const ethPrice = useETHPriceInUSD()\n\n  async function onRemoveLiquidity() {\n    // take ETH amount, multiplied by ETH rate and 2 for total tx size\n    let usdTransactionSize = ethPrice * (ethWithdrawn / 1e18) * 2\n    ReactGA.event({\n      category: 'Transaction',\n      action: 'Remove Liquidity',\n      label: outputCurrency,\n      value: usdTransactionSize\n    })\n\n    const deadline = Math.ceil(Date.now() / 1000) + DEADLINE_FROM_NOW\n\n    const estimatedGasLimit = await exchange.estimate.removeLiquidity(\n      valueParsed,\n      ethWithdrawnMin,\n      tokenWithdrawnMin,\n      deadline\n    )\n\n    exchange\n      .removeLiquidity(valueParsed, ethWithdrawnMin, tokenWithdrawnMin, deadline, {\n        gasLimit: calculateGasMargin(estimatedGasLimit, GAS_MARGIN)\n      })\n      .then(response => {\n        addTransaction(response)\n      })\n  }\n\n  const b = text => <BlueSpan>{text}</BlueSpan>\n\n  function renderTransactionDetails() {\n    return (\n      <div>\n        <div>\n          {t('youAreRemoving')} {b(`${amountFormatter(ethWithdrawn, 18, 4)} ETH`)} {t('and')}{' '}\n          {b(`${amountFormatter(tokenWithdrawn, decimals, Math.min(decimals, 4))} ${symbol}`)} {t('outPool')}\n        </div>\n        <LastSummaryText>\n          {t('youWillRemove')} {b(amountFormatter(valueParsed, 18, 4))} {t('liquidityTokens')}\n        </LastSummaryText>\n        <LastSummaryText>\n          {t('totalSupplyIs')} {b(amountFormatter(totalPoolTokens, 18, 4))}\n        </LastSummaryText>\n        <LastSummaryText>\n          {t('tokenWorth')} {b(amountFormatter(ETHPer, 18, 4))} ETH {t('and')}{' '}\n          {b(amountFormatter(tokenPer, decimals, Math.min(4, decimals)))} {symbol}\n        </LastSummaryText>\n      </div>\n    )\n  }\n\n  function renderSummary() {\n    let contextualInfo = ''\n    let isError = false\n\n    if (inputError) {\n      contextualInfo = inputError\n      isError = true\n    } else if (!outputCurrency || outputCurrency === 'ETH') {\n      contextualInfo = t('selectTokenCont')\n    } else if (!valueParsed) {\n      contextualInfo = t('enterValueCont')\n    } else if (!account) {\n      contextualInfo = t('noWallet')\n      isError = true\n    }\n\n    return (\n      <ContextualInfo\n        key=\"context-info\"\n        openDetailsText={t('transactionDetails')}\n        closeDetailsText={t('hideDetails')}\n        contextualInfo={contextualInfo}\n        isError={isError}\n        renderTransactionDetails={renderTransactionDetails}\n      />\n    )\n  }\n\n  function formatBalance(value) {\n    return `Balance: ${value}`\n  }\n\n  const isActive = active && account\n  const isValid = inputError === null\n\n  const marketRate = getMarketRate(exchangeETHBalance, exchangeTokenBalance, decimals)\n\n  return (\n    <>\n      <CurrencyInputPanel\n        title={t('poolTokens')}\n        extraText={poolTokenBalance && formatBalance(amountFormatter(poolTokenBalance, 18, 4))}\n        extraTextClickHander={() => {\n          if (poolTokenBalance) {\n            const valueToSet = poolTokenBalance\n            if (valueToSet.gt(ethers.constants.Zero)) {\n              setValue(amountFormatter(valueToSet, 18, 18, false))\n            }\n          }\n        }}\n        onCurrencySelected={setOutputCurrency}\n        onValueChange={setValue}\n        value={value}\n        errorMessage={inputError}\n        selectedTokenAddress={outputCurrency}\n      />\n      <OversizedPanel>\n        <DownArrowBackground>\n          <DownArrow active={isActive} alt=\"arrow\" />\n        </DownArrowBackground>\n      </OversizedPanel>\n      <CurrencyInputPanel\n        title={t('output')}\n        description={!!(ethWithdrawn && tokenWithdrawn) ? `(${t('estimated')})` : ''}\n        key=\"remove-liquidity-input\"\n        renderInput={() =>\n          !!(ethWithdrawn && tokenWithdrawn) ? (\n            <RemoveLiquidityOutput>\n              <RemoveLiquidityOutputText>\n                {`${amountFormatter(ethWithdrawn, 18, 4, false)} ETH`}\n              </RemoveLiquidityOutputText>\n              <RemoveLiquidityOutputPlus> + </RemoveLiquidityOutputPlus>\n              <RemoveLiquidityOutputText>\n                {`${amountFormatter(tokenWithdrawn, decimals, Math.min(4, decimals))} ${symbol}`}\n              </RemoveLiquidityOutputText>\n            </RemoveLiquidityOutput>\n          ) : (\n            <RemoveLiquidityOutput />\n          )\n        }\n        disableTokenSelect\n        disableUnlock\n      />\n      <OversizedPanel key=\"remove-liquidity-input-under\" hideBottom>\n        <SummaryPanel>\n          <ExchangeRateWrapper>\n            <ExchangeRate>{t('exchangeRate')}</ExchangeRate>\n            {marketRate ? <span>{`1 ETH = ${amountFormatter(marketRate, 18, 4)} ${symbol}`}</span> : ' - '}\n          </ExchangeRateWrapper>\n          <ExchangeRateWrapper>\n            <ExchangeRate>{t('currentPoolSize')}</ExchangeRate>\n            {exchangeETHBalance && exchangeTokenBalance && (decimals || decimals === 0) ? (\n              <span>{`${amountFormatter(exchangeETHBalance, 18, 4)} ETH + ${amountFormatter(\n                exchangeTokenBalance,\n                decimals,\n                Math.min(decimals, 4)\n              )} ${symbol}`}</span>\n            ) : (\n              ' - '\n            )}\n          </ExchangeRateWrapper>\n          <ExchangeRateWrapper>\n            <ExchangeRate>\n              {t('yourPoolShare')} ({ownershipPercentageFormatted && ownershipPercentageFormatted}%)\n            </ExchangeRate>\n            {ETHOwnShare && TokenOwnShare ? (\n              <span>\n                {`${amountFormatter(ETHOwnShare, 18, 4)} ETH + ${amountFormatter(\n                  TokenOwnShare,\n                  decimals,\n                  Math.min(decimals, 4)\n                )} ${symbol}`}\n              </span>\n            ) : (\n              ' - '\n            )}\n          </ExchangeRateWrapper>\n        </SummaryPanel>\n      </OversizedPanel>\n      {renderSummary()}\n      <Flex>\n        <Button disabled={!isValid} onClick={onRemoveLiquidity}>\n          {t('removeLiquidity')}\n        </Button>\n      </Flex>\n    </>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}