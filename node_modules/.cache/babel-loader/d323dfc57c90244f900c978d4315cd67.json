{"ast":null,"code":"import _regeneratorRuntime from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/workspace/uniswap-exchange/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject11(){var data=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: center;\\n  padding: 2rem;\\n\\n  button {\\n    max-width: 20rem;\\n  }\\n\"]);_templateObject11=function _templateObject11(){return data;};return data;}function _templateObject10(){var data=_taggedTemplateLiteral([\"\\n  flex: 1 1 auto;\\n  width: 0;\\n  color: \",\";\\n\"]);_templateObject10=function _templateObject10(){return data;};return data;}function _templateObject9(){var data=_taggedTemplateLiteral([\"\\n  \",\";\\n  align-items: center;\\n  color: \",\";\\n  font-size: 0.75rem;\\n  padding: 0.25rem 1rem 0;\\n\"]);_templateObject9=function _templateObject9(){return data;};return data;}function _templateObject8(){var data=_taggedTemplateLiteral([\"\\n  margin-top: 1rem;\\n\"]);_templateObject8=function _templateObject8(){return data;};return data;}function _templateObject7(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  padding: 1rem 0;\\n\"]);_templateObject7=function _templateObject7(){return data;};return data;}function _templateObject6(){var data=_taggedTemplateLiteral([\"\\n  font-size: 1.25rem;\\n  line-height: 1.5rem;\\n  padding: 1rem 0;\\n\"]);_templateObject6=function _templateObject6(){return data;};return data;}function _templateObject5(){var data=_taggedTemplateLiteral([\"\\n  font-size: 1.25rem;\\n  line-height: 1.5rem;\\n  padding: 1rem 0.75rem;\\n\"]);_templateObject5=function _templateObject5(){return data;};return data;}function _templateObject4(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  min-height: 3.5rem;\\n\"]);_templateObject4=function _templateObject4(){return data;};return data;}function _templateObject3(){var data=_taggedTemplateLiteral([\"\\n  width: 0.625rem;\\n  height: 0.625rem;\\n  position: relative;\\n  padding: 0.875rem;\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n  \",\"\\n  justify-content: center;\\n  align-items: center;\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  color: \",\";\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useState,useEffect,useCallback}from'react';import{useTranslation}from'react-i18next';import ReactGA from'react-ga';import{useWeb3Context}from'web3-react';import{ethers}from'ethers';import styled from'styled-components';import{Button}from'../../theme';import CurrencyInputPanel from'../../components/CurrencyInputPanel';import ContextualInfo from'../../components/ContextualInfo';import OversizedPanel from'../../components/OversizedPanel';import ArrowDownBlue from\"../../assets/images/arrow-down-blue.svg\";import ArrowDownGrey from\"../../assets/images/arrow-down-grey.svg\";import{useExchangeContract}from'../../hooks';import{useTransactionAdder}from'../../contexts/Transactions';import{useTokenDetails}from'../../contexts/Tokens';import{useAddressBalance}from'../../contexts/Balances';import{calculateGasMargin,amountFormatter}from'../../utils';// denominated in bips\nvar ALLOWED_SLIPPAGE=ethers.utils.bigNumberify(200);// denominated in seconds\nvar DEADLINE_FROM_NOW=60*15;// denominated in bips\nvar GAS_MARGIN=ethers.utils.bigNumberify(1000);var BlueSpan=styled.span(_templateObject(),function(_ref){var theme=_ref.theme;return theme.royalBlue;});var DownArrowBackground=styled.div(_templateObject2(),function(_ref2){var theme=_ref2.theme;return theme.flexRowNoWrap;});var DownArrow=styled.img(_templateObject3());var RemoveLiquidityOutput=styled.div(_templateObject4(),function(_ref3){var theme=_ref3.theme;return theme.flexRowNoWrap;});var RemoveLiquidityOutputText=styled.div(_templateObject5());var RemoveLiquidityOutputPlus=styled.div(_templateObject6());var SummaryPanel=styled.div(_templateObject7(),function(_ref4){var theme=_ref4.theme;return theme.flexColumnNoWrap;});var LastSummaryText=styled.div(_templateObject8());var ExchangeRateWrapper=styled.div(_templateObject9(),function(_ref5){var theme=_ref5.theme;return theme.flexRowNoWrap;},function(_ref6){var theme=_ref6.theme;return theme.doveGray;});var ExchangeRate=styled.span(_templateObject10(),function(_ref7){var theme=_ref7.theme;return theme.chaliceGray;});var Flex=styled.div(_templateObject11());function getExchangeRate(inputValue,inputDecimals,outputValue,outputDecimals){var invert=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;try{if(inputValue&&(inputDecimals||inputDecimals===0)&&outputValue&&(outputDecimals||outputDecimals===0)){var factor=ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18));if(invert){return inputValue.mul(factor).div(outputValue).mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals))).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals)));}else{return outputValue.mul(factor).div(inputValue).mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals))).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals)));}}}catch(_unused){}}function getMarketRate(reserveETH,reserveToken,decimals){var invert=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return getExchangeRate(reserveETH,18,reserveToken,decimals,invert);}function calculateSlippageBounds(value){if(value){var offset=value.mul(ALLOWED_SLIPPAGE).div(ethers.utils.bigNumberify(10000));var minimum=value.sub(offset);var maximum=value.add(offset);return{minimum:minimum.lt(ethers.constants.Zero)?ethers.constants.Zero:minimum,maximum:maximum.gt(ethers.constants.MaxUint256)?ethers.constants.MaxUint256:maximum};}else{return{};}}export default function RemoveLiquidity(){var _useWeb3Context=useWeb3Context(),library=_useWeb3Context.library,account=_useWeb3Context.account,active=_useWeb3Context.active;var _useTranslation=useTranslation(),t=_useTranslation.t;var addTransaction=useTransactionAdder();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),outputCurrency=_useState2[0],setOutputCurrency=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),value=_useState4[0],setValue=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),inputError=_useState6[0],setInputError=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),valueParsed=_useState8[0],setValueParsed=_useState8[1];// parse value\nuseEffect(function(){try{var parsedValue=ethers.utils.parseUnits(value,18);setValueParsed(parsedValue);}catch(_unused2){if(value!==''){setInputError(t('inputNotValid'));}}return function(){setInputError();setValueParsed();};},[t,value]);var _useTokenDetails=useTokenDetails(outputCurrency),symbol=_useTokenDetails.symbol,decimals=_useTokenDetails.decimals,exchangeAddress=_useTokenDetails.exchangeAddress;var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),totalPoolTokens=_useState10[0],setTotalPoolTokens=_useState10[1];var poolTokenBalance=useAddressBalance(account,exchangeAddress);var exchangeETHBalance=useAddressBalance(exchangeAddress,'ETH');var exchangeTokenBalance=useAddressBalance(exchangeAddress,outputCurrency);// input validation\nuseEffect(function(){if(valueParsed&&poolTokenBalance){if(valueParsed.gt(poolTokenBalance)){setInputError(t('insufficientBalance'));}else{setInputError(null);}}},[poolTokenBalance,t,valueParsed]);var exchange=useExchangeContract(exchangeAddress);var ownershipPercentage=poolTokenBalance&&totalPoolTokens&&!totalPoolTokens.isZero()?poolTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens):undefined;var ownershipPercentageFormatted=ownershipPercentage&&amountFormatter(ownershipPercentage,16,4);var ETHOwnShare=exchangeETHBalance&&ownershipPercentage&&exchangeETHBalance.mul(ownershipPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)));var TokenOwnShare=exchangeTokenBalance&&ownershipPercentage&&exchangeTokenBalance.mul(ownershipPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)));var ETHPer=exchangeETHBalance&&totalPoolTokens&&!totalPoolTokens.isZero()?exchangeETHBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens):undefined;var tokenPer=exchangeTokenBalance&&totalPoolTokens&&!totalPoolTokens.isZero()?exchangeTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens):undefined;var ethWithdrawn=ETHPer&&valueParsed?ETHPer.mul(valueParsed).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))):undefined;var tokenWithdrawn=tokenPer&&valueParsed?tokenPer.mul(valueParsed).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))):undefined;var ethWithdrawnMin=ethWithdrawn?calculateSlippageBounds(ethWithdrawn).minimum:undefined;var tokenWithdrawnMin=tokenWithdrawn?calculateSlippageBounds(tokenWithdrawn).minimum:undefined;var fetchPoolTokens=useCallback(function(){if(exchange){exchange.totalSupply().then(function(totalSupply){setTotalPoolTokens(totalSupply);});}},[exchange]);useEffect(function(){fetchPoolTokens();library.on('block',fetchPoolTokens);return function(){library.removeListener('block',fetchPoolTokens);};},[fetchPoolTokens,library]);function onRemoveLiquidity(){return _onRemoveLiquidity.apply(this,arguments);}function _onRemoveLiquidity(){_onRemoveLiquidity=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var deadline,estimatedGasLimit;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:ReactGA.event({category:'Pool',action:'RemoveLiquidity'});deadline=Math.ceil(Date.now()/1000)+DEADLINE_FROM_NOW;_context.next=4;return exchange.estimate.removeLiquidity(valueParsed,ethWithdrawnMin,tokenWithdrawnMin,deadline);case 4:estimatedGasLimit=_context.sent;exchange.removeLiquidity(valueParsed,ethWithdrawnMin,tokenWithdrawnMin,deadline,{gasLimit:calculateGasMargin(estimatedGasLimit,GAS_MARGIN)}).then(function(response){addTransaction(response);});case 6:case\"end\":return _context.stop();}}},_callee);}));return _onRemoveLiquidity.apply(this,arguments);}var b=function b(text){return React.createElement(BlueSpan,null,text);};function renderTransactionDetails(){ReactGA.event({category:'TransactionDetail',action:'Open'});return React.createElement(\"div\",null,React.createElement(\"div\",null,t('youAreRemoving'),\" \",b(\"\".concat(amountFormatter(ethWithdrawn,18,4),\" ETH\")),\" \",t('and'),' ',b(\"\".concat(amountFormatter(tokenWithdrawn,decimals,Math.min(decimals,4)),\" \").concat(symbol)),\" \",t('outPool')),React.createElement(LastSummaryText,null,t('youWillRemove'),\" \",b(amountFormatter(valueParsed,18,4)),\" \",t('liquidityTokens')),React.createElement(LastSummaryText,null,t('totalSupplyIs'),\" \",b(amountFormatter(totalPoolTokens,18,4))),React.createElement(LastSummaryText,null,t('tokenWorth'),\" \",b(amountFormatter(ETHPer,18,4)),\" ETH \",t('and'),' ',b(amountFormatter(tokenPer,decimals,Math.min(4,decimals))),\" \",symbol));}function renderSummary(){var contextualInfo='';var isError=false;if(inputError){contextualInfo=inputError;isError=true;}else if(!outputCurrency||outputCurrency==='ETH'){contextualInfo=t('selectTokenCont');}else if(!valueParsed){contextualInfo=t('enterValueCont');}else if(!account){contextualInfo=t('noWallet');isError=true;}return React.createElement(ContextualInfo,{key:\"context-info\",openDetailsText:t('transactionDetails'),closeDetailsText:t('hideDetails'),contextualInfo:contextualInfo,isError:isError,renderTransactionDetails:renderTransactionDetails});}function formatBalance(value){return\"Balance: \".concat(value);}var isActive=active&&account;var isValid=inputError===null;var marketRate=getMarketRate(exchangeETHBalance,exchangeTokenBalance,decimals);return React.createElement(React.Fragment,null,React.createElement(CurrencyInputPanel,{title:t('poolTokens'),extraText:poolTokenBalance&&formatBalance(amountFormatter(poolTokenBalance,18,4)),extraTextClickHander:function extraTextClickHander(){if(poolTokenBalance){var valueToSet=poolTokenBalance;if(valueToSet.gt(ethers.constants.Zero)){setValue(amountFormatter(valueToSet,18,18,false));}}},onCurrencySelected:setOutputCurrency,onValueChange:setValue,value:value,errorMessage:inputError,selectedTokenAddress:outputCurrency}),React.createElement(OversizedPanel,null,React.createElement(DownArrowBackground,null,React.createElement(DownArrow,{src:isActive?ArrowDownBlue:ArrowDownGrey,alt:\"arrow\"}))),React.createElement(CurrencyInputPanel,{title:t('output'),description:!!(ethWithdrawn&&tokenWithdrawn)?\"(\".concat(t('estimated'),\")\"):'',key:\"remove-liquidity-input\",renderInput:function renderInput(){return!!(ethWithdrawn&&tokenWithdrawn)?React.createElement(RemoveLiquidityOutput,null,React.createElement(RemoveLiquidityOutputText,null,\"\".concat(amountFormatter(ethWithdrawn,18,4,false),\" ETH\")),React.createElement(RemoveLiquidityOutputPlus,null,\" + \"),React.createElement(RemoveLiquidityOutputText,null,\"\".concat(amountFormatter(tokenWithdrawn,decimals,Math.min(4,decimals)),\" \").concat(symbol))):React.createElement(RemoveLiquidityOutput,null);},disableTokenSelect:true,disableUnlock:true}),React.createElement(OversizedPanel,{key:\"remove-liquidity-input-under\",hideBottom:true},React.createElement(SummaryPanel,null,React.createElement(ExchangeRateWrapper,null,React.createElement(ExchangeRate,null,t('exchangeRate')),marketRate?React.createElement(\"span\",null,\"1 ETH = \".concat(amountFormatter(marketRate,18,4),\" \").concat(symbol)):' - '),React.createElement(ExchangeRateWrapper,null,React.createElement(ExchangeRate,null,t('currentPoolSize')),exchangeETHBalance&&exchangeTokenBalance&&decimals?React.createElement(\"span\",null,\"\".concat(amountFormatter(exchangeETHBalance,18,4),\" ETH + \").concat(amountFormatter(exchangeTokenBalance,decimals,Math.min(decimals,4)),\" \").concat(symbol)):' - '),React.createElement(ExchangeRateWrapper,null,React.createElement(ExchangeRate,null,t('yourPoolShare'),\" (\",ownershipPercentageFormatted&&ownershipPercentageFormatted,\"%)\"),ETHOwnShare&&TokenOwnShare?React.createElement(\"span\",null,\"\".concat(amountFormatter(ETHOwnShare,18,4),\" ETH + \").concat(amountFormatter(TokenOwnShare,decimals,Math.min(decimals,4)),\" \").concat(symbol)):' - '))),renderSummary(),React.createElement(Flex,null,React.createElement(Button,{disabled:!isValid,onClick:onRemoveLiquidity},t('removeLiquidity'))));}","map":{"version":3,"sources":["/workspace/uniswap-exchange/src/pages/Pool/RemoveLiquidity.js"],"names":["React","useState","useEffect","useCallback","useTranslation","ReactGA","useWeb3Context","ethers","styled","Button","CurrencyInputPanel","ContextualInfo","OversizedPanel","useExchangeContract","useTransactionAdder","useTokenDetails","useAddressBalance","calculateGasMargin","amountFormatter","ALLOWED_SLIPPAGE","utils","bigNumberify","DEADLINE_FROM_NOW","GAS_MARGIN","BlueSpan","span","theme","royalBlue","DownArrowBackground","div","flexRowNoWrap","DownArrow","img","RemoveLiquidityOutput","RemoveLiquidityOutputText","RemoveLiquidityOutputPlus","SummaryPanel","flexColumnNoWrap","LastSummaryText","ExchangeRateWrapper","doveGray","ExchangeRate","chaliceGray","Flex","getExchangeRate","inputValue","inputDecimals","outputValue","outputDecimals","invert","factor","pow","mul","getMarketRate","reserveETH","reserveToken","decimals","calculateSlippageBounds","value","offset","minimum","sub","maximum","add","lt","constants","Zero","gt","MaxUint256","RemoveLiquidity","library","account","active","t","addTransaction","outputCurrency","setOutputCurrency","setValue","inputError","setInputError","valueParsed","setValueParsed","parsedValue","parseUnits","symbol","exchangeAddress","totalPoolTokens","setTotalPoolTokens","poolTokenBalance","exchangeETHBalance","exchangeTokenBalance","exchange","ownershipPercentage","isZero","undefined","ownershipPercentageFormatted","ETHOwnShare","TokenOwnShare","ETHPer","tokenPer","ethWithdrawn","tokenWithdrawn","ethWithdrawnMin","tokenWithdrawnMin","fetchPoolTokens","totalSupply","then","on","removeListener","onRemoveLiquidity","event","category","action","deadline","Math","ceil","Date","now","estimate","removeLiquidity","estimatedGasLimit","gasLimit","response","b","text","renderTransactionDetails","min","renderSummary","contextualInfo","isError","formatBalance","isActive","isValid","marketRate","valueToSet","ArrowDownBlue","ArrowDownGrey"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport ReactGA from 'react-ga'\nimport { useWeb3Context } from 'web3-react'\nimport { ethers } from 'ethers'\nimport styled from 'styled-components'\n\nimport { Button } from '../../theme'\nimport CurrencyInputPanel from '../../components/CurrencyInputPanel'\nimport ContextualInfo from '../../components/ContextualInfo'\nimport OversizedPanel from '../../components/OversizedPanel'\nimport ArrowDownBlue from '../../assets/images/arrow-down-blue.svg'\nimport ArrowDownGrey from '../../assets/images/arrow-down-grey.svg'\nimport { useExchangeContract } from '../../hooks'\nimport { useTransactionAdder } from '../../contexts/Transactions'\nimport { useTokenDetails } from '../../contexts/Tokens'\nimport { useAddressBalance } from '../../contexts/Balances'\nimport { calculateGasMargin, amountFormatter } from '../../utils'\n\n// denominated in bips\nconst ALLOWED_SLIPPAGE = ethers.utils.bigNumberify(200)\n\n// denominated in seconds\nconst DEADLINE_FROM_NOW = 60 * 15\n\n// denominated in bips\nconst GAS_MARGIN = ethers.utils.bigNumberify(1000)\n\nconst BlueSpan = styled.span`\n  color: ${({ theme }) => theme.royalBlue};\n`\n\nconst DownArrowBackground = styled.div`\n  ${({ theme }) => theme.flexRowNoWrap}\n  justify-content: center;\n  align-items: center;\n`\n\nconst DownArrow = styled.img`\n  width: 0.625rem;\n  height: 0.625rem;\n  position: relative;\n  padding: 0.875rem;\n`\n\nconst RemoveLiquidityOutput = styled.div`\n  ${({ theme }) => theme.flexRowNoWrap}\n  min-height: 3.5rem;\n`\n\nconst RemoveLiquidityOutputText = styled.div`\n  font-size: 1.25rem;\n  line-height: 1.5rem;\n  padding: 1rem 0.75rem;\n`\n\nconst RemoveLiquidityOutputPlus = styled.div`\n  font-size: 1.25rem;\n  line-height: 1.5rem;\n  padding: 1rem 0;\n`\n\nconst SummaryPanel = styled.div`\n  ${({ theme }) => theme.flexColumnNoWrap}\n  padding: 1rem 0;\n`\n\nconst LastSummaryText = styled.div`\n  margin-top: 1rem;\n`\n\nconst ExchangeRateWrapper = styled.div`\n  ${({ theme }) => theme.flexRowNoWrap};\n  align-items: center;\n  color: ${({ theme }) => theme.doveGray};\n  font-size: 0.75rem;\n  padding: 0.25rem 1rem 0;\n`\n\nconst ExchangeRate = styled.span`\n  flex: 1 1 auto;\n  width: 0;\n  color: ${({ theme }) => theme.chaliceGray};\n`\n\nconst Flex = styled.div`\n  display: flex;\n  justify-content: center;\n  padding: 2rem;\n\n  button {\n    max-width: 20rem;\n  }\n`\n\nfunction getExchangeRate(inputValue, inputDecimals, outputValue, outputDecimals, invert = false) {\n  try {\n    if (\n      inputValue &&\n      (inputDecimals || inputDecimals === 0) &&\n      outputValue &&\n      (outputDecimals || outputDecimals === 0)\n    ) {\n      const factor = ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))\n\n      if (invert) {\n        return inputValue\n          .mul(factor)\n          .div(outputValue)\n          .mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals)))\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals)))\n      } else {\n        return outputValue\n          .mul(factor)\n          .div(inputValue)\n          .mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(inputDecimals)))\n          .div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(outputDecimals)))\n      }\n    }\n  } catch {}\n}\n\nfunction getMarketRate(reserveETH, reserveToken, decimals, invert = false) {\n  return getExchangeRate(reserveETH, 18, reserveToken, decimals, invert)\n}\n\nfunction calculateSlippageBounds(value) {\n  if (value) {\n    const offset = value.mul(ALLOWED_SLIPPAGE).div(ethers.utils.bigNumberify(10000))\n    const minimum = value.sub(offset)\n    const maximum = value.add(offset)\n    return {\n      minimum: minimum.lt(ethers.constants.Zero) ? ethers.constants.Zero : minimum,\n      maximum: maximum.gt(ethers.constants.MaxUint256) ? ethers.constants.MaxUint256 : maximum\n    }\n  } else {\n    return {}\n  }\n}\n\nexport default function RemoveLiquidity() {\n  const { library, account, active } = useWeb3Context()\n  const { t } = useTranslation()\n\n  const addTransaction = useTransactionAdder()\n\n  const [outputCurrency, setOutputCurrency] = useState('')\n  const [value, setValue] = useState('')\n  const [inputError, setInputError] = useState()\n  const [valueParsed, setValueParsed] = useState()\n  // parse value\n  useEffect(() => {\n    try {\n      const parsedValue = ethers.utils.parseUnits(value, 18)\n      setValueParsed(parsedValue)\n    } catch {\n      if (value !== '') {\n        setInputError(t('inputNotValid'))\n      }\n    }\n\n    return () => {\n      setInputError()\n      setValueParsed()\n    }\n  }, [t, value])\n\n  const { symbol, decimals, exchangeAddress } = useTokenDetails(outputCurrency)\n\n  const [totalPoolTokens, setTotalPoolTokens] = useState()\n  const poolTokenBalance = useAddressBalance(account, exchangeAddress)\n  const exchangeETHBalance = useAddressBalance(exchangeAddress, 'ETH')\n  const exchangeTokenBalance = useAddressBalance(exchangeAddress, outputCurrency)\n\n  // input validation\n  useEffect(() => {\n    if (valueParsed && poolTokenBalance) {\n      if (valueParsed.gt(poolTokenBalance)) {\n        setInputError(t('insufficientBalance'))\n      } else {\n        setInputError(null)\n      }\n    }\n  }, [poolTokenBalance, t, valueParsed])\n\n  const exchange = useExchangeContract(exchangeAddress)\n\n  const ownershipPercentage =\n    poolTokenBalance && totalPoolTokens && !totalPoolTokens.isZero()\n      ? poolTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens)\n      : undefined\n  const ownershipPercentageFormatted = ownershipPercentage && amountFormatter(ownershipPercentage, 16, 4)\n\n  const ETHOwnShare =\n    exchangeETHBalance &&\n    ownershipPercentage &&\n    exchangeETHBalance.mul(ownershipPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n  const TokenOwnShare =\n    exchangeTokenBalance &&\n    ownershipPercentage &&\n    exchangeTokenBalance.mul(ownershipPercentage).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n\n  const ETHPer =\n    exchangeETHBalance && totalPoolTokens && !totalPoolTokens.isZero()\n      ? exchangeETHBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens)\n      : undefined\n  const tokenPer =\n    exchangeTokenBalance && totalPoolTokens && !totalPoolTokens.isZero()\n      ? exchangeTokenBalance.mul(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18))).div(totalPoolTokens)\n      : undefined\n\n  const ethWithdrawn =\n    ETHPer && valueParsed\n      ? ETHPer.mul(valueParsed).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n      : undefined\n  const tokenWithdrawn =\n    tokenPer && valueParsed\n      ? tokenPer.mul(valueParsed).div(ethers.utils.bigNumberify(10).pow(ethers.utils.bigNumberify(18)))\n      : undefined\n\n  const ethWithdrawnMin = ethWithdrawn ? calculateSlippageBounds(ethWithdrawn).minimum : undefined\n  const tokenWithdrawnMin = tokenWithdrawn ? calculateSlippageBounds(tokenWithdrawn).minimum : undefined\n\n  const fetchPoolTokens = useCallback(() => {\n    if (exchange) {\n      exchange.totalSupply().then(totalSupply => {\n        setTotalPoolTokens(totalSupply)\n      })\n    }\n  }, [exchange])\n  useEffect(() => {\n    fetchPoolTokens()\n    library.on('block', fetchPoolTokens)\n\n    return () => {\n      library.removeListener('block', fetchPoolTokens)\n    }\n  }, [fetchPoolTokens, library])\n\n  async function onRemoveLiquidity() {\n    ReactGA.event({\n      category: 'Pool',\n      action: 'RemoveLiquidity'\n    })\n\n    const deadline = Math.ceil(Date.now() / 1000) + DEADLINE_FROM_NOW\n\n    const estimatedGasLimit = await exchange.estimate.removeLiquidity(\n      valueParsed,\n      ethWithdrawnMin,\n      tokenWithdrawnMin,\n      deadline\n    )\n\n    exchange\n      .removeLiquidity(valueParsed, ethWithdrawnMin, tokenWithdrawnMin, deadline, {\n        gasLimit: calculateGasMargin(estimatedGasLimit, GAS_MARGIN)\n      })\n      .then(response => {\n        addTransaction(response)\n      })\n  }\n\n  const b = text => <BlueSpan>{text}</BlueSpan>\n\n  function renderTransactionDetails() {\n    ReactGA.event({\n      category: 'TransactionDetail',\n      action: 'Open'\n    })\n\n    return (\n      <div>\n        <div>\n          {t('youAreRemoving')} {b(`${amountFormatter(ethWithdrawn, 18, 4)} ETH`)} {t('and')}{' '}\n          {b(`${amountFormatter(tokenWithdrawn, decimals, Math.min(decimals, 4))} ${symbol}`)} {t('outPool')}\n        </div>\n        <LastSummaryText>\n          {t('youWillRemove')} {b(amountFormatter(valueParsed, 18, 4))} {t('liquidityTokens')}\n        </LastSummaryText>\n        <LastSummaryText>\n          {t('totalSupplyIs')} {b(amountFormatter(totalPoolTokens, 18, 4))}\n        </LastSummaryText>\n        <LastSummaryText>\n          {t('tokenWorth')} {b(amountFormatter(ETHPer, 18, 4))} ETH {t('and')}{' '}\n          {b(amountFormatter(tokenPer, decimals, Math.min(4, decimals)))} {symbol}\n        </LastSummaryText>\n      </div>\n    )\n  }\n\n  function renderSummary() {\n    let contextualInfo = ''\n    let isError = false\n\n    if (inputError) {\n      contextualInfo = inputError\n      isError = true\n    } else if (!outputCurrency || outputCurrency === 'ETH') {\n      contextualInfo = t('selectTokenCont')\n    } else if (!valueParsed) {\n      contextualInfo = t('enterValueCont')\n    } else if (!account) {\n      contextualInfo = t('noWallet')\n      isError = true\n    }\n\n    return (\n      <ContextualInfo\n        key=\"context-info\"\n        openDetailsText={t('transactionDetails')}\n        closeDetailsText={t('hideDetails')}\n        contextualInfo={contextualInfo}\n        isError={isError}\n        renderTransactionDetails={renderTransactionDetails}\n      />\n    )\n  }\n\n  function formatBalance(value) {\n    return `Balance: ${value}`\n  }\n\n  const isActive = active && account\n  const isValid = inputError === null\n\n  const marketRate = getMarketRate(exchangeETHBalance, exchangeTokenBalance, decimals)\n\n  return (\n    <>\n      <CurrencyInputPanel\n        title={t('poolTokens')}\n        extraText={poolTokenBalance && formatBalance(amountFormatter(poolTokenBalance, 18, 4))}\n        extraTextClickHander={() => {\n          if (poolTokenBalance) {\n            const valueToSet = poolTokenBalance\n            if (valueToSet.gt(ethers.constants.Zero)) {\n              setValue(amountFormatter(valueToSet, 18, 18, false))\n            }\n          }\n        }}\n        onCurrencySelected={setOutputCurrency}\n        onValueChange={setValue}\n        value={value}\n        errorMessage={inputError}\n        selectedTokenAddress={outputCurrency}\n      />\n      <OversizedPanel>\n        <DownArrowBackground>\n          <DownArrow src={isActive ? ArrowDownBlue : ArrowDownGrey} alt=\"arrow\" />\n        </DownArrowBackground>\n      </OversizedPanel>\n      <CurrencyInputPanel\n        title={t('output')}\n        description={!!(ethWithdrawn && tokenWithdrawn) ? `(${t('estimated')})` : ''}\n        key=\"remove-liquidity-input\"\n        renderInput={() =>\n          !!(ethWithdrawn && tokenWithdrawn) ? (\n            <RemoveLiquidityOutput>\n              <RemoveLiquidityOutputText>\n                {`${amountFormatter(ethWithdrawn, 18, 4, false)} ETH`}\n              </RemoveLiquidityOutputText>\n              <RemoveLiquidityOutputPlus> + </RemoveLiquidityOutputPlus>\n              <RemoveLiquidityOutputText>\n                {`${amountFormatter(tokenWithdrawn, decimals, Math.min(4, decimals))} ${symbol}`}\n              </RemoveLiquidityOutputText>\n            </RemoveLiquidityOutput>\n          ) : (\n            <RemoveLiquidityOutput />\n          )\n        }\n        disableTokenSelect\n        disableUnlock\n      />\n      <OversizedPanel key=\"remove-liquidity-input-under\" hideBottom>\n        <SummaryPanel>\n          <ExchangeRateWrapper>\n            <ExchangeRate>{t('exchangeRate')}</ExchangeRate>\n            {marketRate ? <span>{`1 ETH = ${amountFormatter(marketRate, 18, 4)} ${symbol}`}</span> : ' - '}\n          </ExchangeRateWrapper>\n          <ExchangeRateWrapper>\n            <ExchangeRate>{t('currentPoolSize')}</ExchangeRate>\n            {exchangeETHBalance && exchangeTokenBalance && decimals ? (\n              <span>{`${amountFormatter(exchangeETHBalance, 18, 4)} ETH + ${amountFormatter(\n                exchangeTokenBalance,\n                decimals,\n                Math.min(decimals, 4)\n              )} ${symbol}`}</span>\n            ) : (\n              ' - '\n            )}\n          </ExchangeRateWrapper>\n          <ExchangeRateWrapper>\n            <ExchangeRate>\n              {t('yourPoolShare')} ({ownershipPercentageFormatted && ownershipPercentageFormatted}%)\n            </ExchangeRate>\n            {ETHOwnShare && TokenOwnShare ? (\n              <span>\n                {`${amountFormatter(ETHOwnShare, 18, 4)} ETH + ${amountFormatter(\n                  TokenOwnShare,\n                  decimals,\n                  Math.min(decimals, 4)\n                )} ${symbol}`}\n              </span>\n            ) : (\n              ' - '\n            )}\n          </ExchangeRateWrapper>\n        </SummaryPanel>\n      </OversizedPanel>\n      {renderSummary()}\n      <Flex>\n        <Button disabled={!isValid} onClick={onRemoveLiquidity}>\n          {t('removeLiquidity')}\n        </Button>\n      </Flex>\n    </>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}